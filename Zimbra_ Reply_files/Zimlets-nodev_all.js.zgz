if(!window.com_zimbra_url){
com_zimbra_url={}
}
a=com_zimbra_url;
a.zimletLabel="URL Links";
a.description="Highlight Web URLs for linking in email messages.";
a.youTubeTitle="Videos from this email";
a.youTubeTitleMax="Showing {0} videos from this email";
a.youTubeClickToToggle="Click to play or hide video";
a.goToUrl="Go to URL";
a.newCalendar="Create New Calendar";
if(!window.com_zimbra_email){
com_zimbra_email={}
}
a=com_zimbra_email;
a.zimletLabel="Email Contact Details";
a.description="Highlights and previews associated contact details for an email address.";
a.search="Search";
a.findEmailBySender="Find Emails From Sender";
a.findEmails="Find Emails...";
a.newEmail="New Email";
a.newIM="New IM";
a.newContact="New Contact";
a.newFilter="New Filter";
a.goToUrl="Go to URL";
a.addToFilter="Add to Filter";
a.preferencesSaved="Preferences Saved";
a.emailZimletPreferences="Email Zimlet Preferences";
a.label="Email";
a.tooltip="Shows Email Zimlet's preferences";
a.VERYSMALL="Very Small";
a.SMALL="Small";
a.MEDIUM="Medium";
a.LARGE="Large";
a.XL="XL";
a["2XL"]="2XL";
a.selectToolTipSize="Please select tool-tip's size: ";
a.rightClickForMoreOptions="Right click for more options";
a.contact="Contact";
a.close="Close";
a.slideTooltip="Email Profile";
a.slideMailTooltip="New Email";
a.slideCalendarTooltip="New Appointment";
a.loading="Loading...";
a.copy="Copy";
a.msg_available="Available";
a.msg_unavailable="Unavailable";
a.msg_busy="Busy";
a.msg_away="Away";
a.msg_dnd="Do not disturb";
a.msg_onthephone="On the phone";
a.msg_vacation="Vacation";
a.msg_unknown="Unknown";
if(!window.com_zimbra_date){
com_zimbra_date={}
}
a=com_zimbra_date;
a.label="Date";
a.description="Highlights dates, previews associated appointments and creates a link to the calendar.";
a.viewDay="Day";
a.appointmentNewTitle="New Appointment";
a.searchForMessages="Search for mail messages";
a.boundaryTrue="true";
a.boundaryFalse="false";
a["format.boundary"]="true";
a["format1.pattern"]="(today|tonight|this morning)";
a["format1.rule"]="now";
a["format2.pattern"]="(tomorrow night|tomorrow morning|tomorrow)";
a["format2.rule"]="now +1 day";
a["format3.pattern"]="(last night|yesterday morning|yesterday)";
a["format3.rule"]="now -1 day";
a["format4.pattern"]="(this|next) {dayname}";
a["format4.rule"]="now +1 {dayname}";
a["format5.pattern"]="last {dayname}";
a["format5.rule"]="now -1 {dayname}";
a["format6.pattern"]="{weekord} {dayname} (of|in) {monthname}";
a["format6.rule"]="now date=1 +1 {monthname} week={weekord},{dayname}";
a["format7.pattern"]="{weekord} {dayname}";
a["format7.rule"]="now week={weekord},{dayname}";
a["format8.pattern"]="{datenum}(st|nd|rd|th)? (of|in) {monthname}";
a["format8.rule"]="now month={monthname},{datenum}";
a["format9.pattern"]="{monthname} {datenum}(st|nd|rd|th)?.? {timenum}.?(am|pm)";
a["format9.rule"]="now month={monthname},{datenum}";
a["format10.pattern"]="{datenum}(st|nd|rd|th)? {monthname} {timenum}.?(am|pm)";
a["format10.rule"]="now month={monthname},{datenum}";
a["format11.pattern"]="{monthname} {datenum}(st|nd|rd|th).? {militarytimenum} (hrs|hours)";
a["format11.rule"]="now month={monthname},{datenum}";
a["format12.pattern"]="{datenum}(st|nd|rd|th).? {monthname}.? {militarytimenum} (hrs|hours)";
a["format12.rule"]="now month={monthname},{datenum}";
a["format13.pattern"]="{monthname} {datenum}(st|nd|rd|th).? {yearnum}";
a["format13.rule"]="now year={yearnum},{monthname},{datenum}";
a["format14.pattern"]="{dayname}.? {datenum} {monthname} {yearnum}";
a["format14.rule"]="now year={yearnum},{monthname},{datenum}";
a["format15.pattern"]="{dayname}.? {monthname}  {datenum}";
a["format15.rule"]="now month={monthname},{datenum}";
a["format16.pattern"]="{monthname} {datenum}(st|nd|rd|th)?";
a["format16.rule"]="now month={monthname},{datenum}";
a["format17.pattern"]="{datenum} {monthname}.? {yearnum}";
a["format17.rule"]="now year={yearnum},{monthname},{datenum}";
a["format18.pattern"]="{monthnum}/{datenum}/{yearnum}";
a["format18.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format19.pattern"]="{yearnum}-{monthnum}-{datenum}";
a["format19.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format20.pattern"]="{monthname} {yearnum}";
a["format20.rule"]="now year={yearnum},{monthname},1";
a["format21.pattern"]="{dayname}";
a["format21.rule"]="now +1 {dayname}";
a["format22.pattern"]="{datenum}(st|nd|rd|th)? {monthname}.? {yearnum}";
a["format22.rule"]="now year={yearnum},{monthname},{datenum}";
a["format23.pattern"]="Thanksgiving";
a["format23.rule"]="now month=November week=fourth,Thursday";
a["format24.pattern"]="Christmas Eve";
a["format24.rule"]="now month=December,24";
a["format25.pattern"]="Christmas";
a["format25.rule"]="now month=December,25";
a["format26.pattern"]="New Year'?s Eve";
a["format26.rule"]="now month=December,31";
a["format27.pattern"]="New Year'?s Day";
a["format27.rule"]="now +1 year month=January,1";
a["format28.pattern"]="###";
if(!window.com_zimbra_webex){
com_zimbra_webex={}
}
a=com_zimbra_webex;
a.label="WebEx";
a.description="Easily schedule, start or join WebEx meetings.";
a.WebExZimlet_insertWebExDetails="Insert WebEx details";
a.WebExZimlet_insertWebExDetailsAndSendAppointment="Insert WebEx details and send appointment";
a.WebExZimlet_label="WebEx";
a.WebExZimlet_toolTip="Easily schedule, start, or join WebEx meetings";
a.WebExZimlet_rightClickForOptions="Please <b>right-click</b> for preferences and other options.";
a.WebExZimlet_quickMeeting="Start a Quick meeting";
a.WebExZimlet_startJoinExistingMeeting="Start or join an existing meeting";
a.WebExZimlet_manageAccounts="Manage Accounts";
a.WebExZimlet_preferences="Preferences";
a.WebExZimlet_selectDefaultTimeZone="Select default Timezone:";
a.WebExZimlet_appendMeetingInfoToSubOrLoc="Append meeting information to subject or location fields:";
a.WebExZimlet_appendToSubject="Append <b>below</b> meeting information to subject field";
a.WebExZimlet_appendToLocation="Append <b>below</b> meeting information to location field";
a.WebExZimlet_informationToAppend="Information to append:";
a.WebExZimlet_appendWebExUrl="Append WebEx URL to";
a.WebExZimlet_appendMeetingPwd="Append meeting password to";
a.WebExZimlet_appendToolFreeNumber="Append Toll-Free conference number to";
a.WebExZimlet_appendTollConfNumber="Append Toll conference number to";
a.WebExZimlet_appendPhonePasscode="Append Phone Passcode to";
a.WebExZimlet_PrefSaved="Saved WebEx Preferences";
a.WebExZimlet_none="None";
a.WebExZimlet_subject="Subject";
a.WebExZimlet_location="Location";
a.WebExZimlet_subjectAndLocation="Subject & Location";
a.WebExZimlet_accountNumber="WebEx Account {0}:";
a.WebExZimlet_accountSettings="Account Settings:";
a.WebExZimlet_userName="WebEx Username:*";
a.WebExZimlet_password="WebEx Password:*";
a.WebExZimlet_companyId="WebEx Company Id:*";
a.WebExZimlet_altHosts="Alternative Host(s)";
a.WebExZimlet_companyIdExample="<br/>Company Id is the first part of the company-specific WebEx URL. <br/>For example: <b>vmware</b> in http://<b>vmware</b>.webex.com/";
a.WebExZimlet_useThisAccountFor="Use this WebEx account for:";
a.WebExZimlet_associateCalendarHdr="Auto-associate a Calendar to a WebEx account:";
a.WebExZimlet_meetingPwd="WebEx Meeting Password:";
a.WebExZimlet_optional="(optional)";
a.WebExZimlet_validateWebExAccntNumber="Validate Account {0}";
a.WebExZimlet_teleConfSettings="Teleconference Settings:";
a.WebExZimlet_tollFreeNumber="Toll-Free Phone Number:";
a.WebExZimlet_tollNumber="Toll-Phone Number:";
a.WebExZimlet_webExUrl="WebEx URL:";
a.WebExZimlet_otherPhoneNumbers="Other Phone Numbers:";
a.WebExZimlet_phonePasscode="Phone passcode:";
a.WebExZimlet_digitsOnly="(digits only)";
a.WebExZimlet_passwordNotRequired="(Password is not required for this meeting.)";
a.WebExZimlet_account1UsedAsDefaultForUnAssociatedCal="Note: Account 1 settings are used for all un-associated Calendars";
a.WebExZimlet_testFailed="Test failed. This WebEx account is not valid.";
a.WebExZimlet_testPassed="Test succeeded. This is a valid WebEx account.";
a.WebExZimlet_errorInWebExXml="Error parsing WebEx XML response or malformed XML.";
a.WebExZimlet_accountNumberNotSetup="WebEx <b>Account {0}</b> is not setup.";
a.WebExZimlet_pleaseWait="Please wait...";
a.WebExZimlet_allCalendars="All Calendars";
a.WebExZimlet_selectAccntToUse="Select WebEx Account";
a.WebExZimlet_webExAccntToUse="WebEx Account:";
a.WebExZimlet_enterYourName="[Enter your name]";
a.WebExZimlet_email="Email:";
a.WebExZimlet_enterYourEmail="[Enter your email]";
a.WebExZimlet_notConfigured="Not configured";
a.WebExZimlet_accntNumberAndName="Account {0} ({1})";
a.WebExZimlet_getAccounts="Account options:";
a.WebExZimlet_help="help";
a.WebExZimlet_startQuickWebExMeeting="Start Quick WebEx Meeting";
a.WebExZimlet_addAttendees="Add Attendee(s):";
a.WebExZimlet_quickMeetingSubject="Quick WebEx Meeting (Please join now)";
a.WebExZimlet_quickMeetingLocation="Quick WebEx Meeting (Please join now)";
a.WebExZimlet_startOrJoinWebExMeeting="Start or Join WebEx Meeting";
a.WebExZimlet_host="Host";
a.WebExZimlet_startTime="Start Time";
a.WebExZimlet_action="Action";
a.WebExZimlet_meetingName="Meeting Name";
a.WebExZimlet_meetingsList="WebEx Meetings List:";
a.WebExZimlet_startJoin="Start/Join";
a.WebExZimlet_fromNowOn="From now on";
a.WebExZimlet_today="Today";
a.WebExZimlet_tomorrow="Tomorrow";
a.WebExZimlet_next7days="Next 7 days";
a.WebExZimlet_savesThisApptAsWebEx="Save as WebEx";
a.WebExZimlet_saveAsWebEx="Save as WebEx";
a.WebExZimlet_successfullyCreatedWebEx="Successfully created WebEx appointment";
a.WebExZimlet_unableToCreateMeeting="Unable to create WebEx meeting";
a.WebExZimlet_noWebExAccount="No WebEx Account(s) have been configured.<br/>Right-click on the Zimlet and Select 'Manage Accounts' to configure.";
a.WebExZimlet_webExError="WebEx Error";
a.WebExZimlet_failureReason="Failure Reason:";
a.WebExZimlet_webExDidntReturnMeetingKey="WebEx did not return meeting key, perhaps, meeting didn't get created on the WebEx server.";
a.WebExZimlet_unableToGetMeetingInfo="Unable to get WebEx meetings information";
a.WebExZimlet_unableToGetJoinOrHostURL="Unable to get WebEx Join/Host Meeting URL";
a.WebExZimlet_couldNotGetJoinMeetingUrl="Could not get Join-Meeting-URL from WebEx";
a.WebExZimlet_unableToDeleteWebExAppt="Unable to Delete WebEx meeting";
a.WebExZimlet_unableToCreateOrModifyMeeting="Unable to create/modify WebEx meeting";
a.WebExZimlet_invalidAlternateHost="Invalid alternative Host.<br/>Alternative Hosts are used to to allow other hosts to schedule meetings on your behalf. To use this feature, this must be configured in your WebEx Profile. <br/><br/>To grant permission for an alternative host:<br/>1. Login to your WebEx account.<br/>2. Browse to Setup > My Profile > Session Options > Scheduling permission.<br/>3. Enter Alternative Hosts.<br/>4. Save your profile.";
a.WebExZimlet_setupAlternateHost="Alternative Hosts are used to to allow other hosts to schedule meetings on your behalf. To use this feature, this must be configured in your WebEx Profile. <br/><br/>To grant permission for an alternative host:<br/>1. Login to your WebEx account.<br/>2. Go to Setup > My Profile > Session Options > Scheduling permission.<br/>3. Enter Alternative Hosts.<br/>4. Save your profile.";
a.WebExZimlet_userPwdCIdRequired="WebEx Username, Password & Company Id are required.";
a.WebExZimlet_couldNotRegisterAttendees="Could not register attendees";
a.cannotContinueInvalidEmails="Cannot continue. Following invalid email(s) found";
a.modifyAlertNotice="WebEx meeting has been successfully created. <br><br>Please Note:<br> If you modify this meeting (other than its body content), you will have to recreate WebEx meeting";
a.WebExZimlet_meetingWasDeleted="WebEx meeting was deleted";
a.WebExZimlet_entireSeriesWillBeDeleted="WebEx Appointment found.<br/> For a recurring appointment, entire series will be deleted on WebEx server.<br/> Do you want to continue?";
a.WebExZimlet_modifyApptAvoidDuplicateInfoWarning="Modifying WebEx Appointment.<br/> Please make sure to remove older WebEx data from body, subject and location fields in order to avoid inserting multiple WebEx information. <br/>Do you want to continue?";
a.WebExZimlet_teleconferenceDetails="Teleconference Details:";
a.WebExZimlet_webExDetails="WebEx  Details:";
if(!window.com_zimbra_ymemoticons){
com_zimbra_ymemoticons={}
}
a=com_zimbra_ymemoticons;
a.label="Yahoo! Emoticons";
a.description="Displays Yahoo! Emoticons images in email messages.";
a.yahooEmoticons="Yahoo! Emoticons";
a.temporarilyDisableInMail="Temporarily disable in Mail";
a.preferences="Preferences";
if(!window.com_zimbra_srchhighlighter){
com_zimbra_srchhighlighter={}
}
a=com_zimbra_srchhighlighter;
a.label="Search Highlighter";
a.description="After a mail search, this Zimlet highlights Search terms with yellow color.";
a.SearchHighlighterZimlet_MenuLabel="Clear Search Highlights";
a.SearchHighlighterZimlet_ZimletError="Search Highlighter Zimlet Error:";
if(!window.com_zimbra_phone){
com_zimbra_phone={}
}
a=com_zimbra_phone;
a.label="Phone";
a.description="Highlights phone numbers to enable Skype calls.";
a.search="Search";
a.addToContacts="Add To Contacts";
a.call="Call";
a.localPhoneRegEx="(\\+?1?)(-?\\s?\\)?\\.?)(\\(?)\\d{3}(-?\\s?\\)?\\.?)+\\d{3}(-?\\s?\\.?)\\d{4}";
a.countryCode="1";
if(!window.com_zimbra_attachmail){
com_zimbra_attachmail={}
}
a=com_zimbra_attachmail;
a.label="Email Attacher";
a.description="Attach email messages when composing a new message.";
a.AttachMailZimlet_panel_label="Email Attacher";
a.AttachMailZimlet_panel_tooltip='Adds an "Attach Mail" tab to the compose toolbar "Add Attachment" dialog.';
a.AttachMailZimlet_tab_label="Mail";
a.AttachMailZimlet_tab_button_search="Search";
a.AttachMailZimlet_tab_button_view="View Message";
if(!window.com_zimbra_attachcontacts){
com_zimbra_attachcontacts={}
}
a=com_zimbra_attachcontacts;
a.label="Attach Contacts";
a.description="Allows Attaching contacts when composing a new message.";
a.ACZ_tab_label="Contacts";
a.ACZ_tab_button_search="Search";
a.ACZ_NoContactsFound="No contacts found.";
a.ACZ_Send="Forward";
a.ACZ_SendContact="Forward Contact";
a.ACZ_SendContactsAsAttachments="Send Contacts as email attachments";
a.ACZ_more="({0} more)";
AjxTemplate.register("com_zimbra_email.templates.Email1#Frame",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div id='UnknownPersonSlide_Frame' style='background:white;display:block;height:100%;overflow:auto;padding:10px;'><table width='100%'><tr><td valign='top' width='65'><div id=\"";
e[o++]=s.photoParentId;
e[o++]='"></div></td><td><div id="';
e[o++]=s.textDivId;
e[o++]="\" style='margin-left:10px;'></div></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"Frame"}
,true);
AjxPackage.define("com_zimbra_email.templates.Email1");
AjxTemplate.register("com_zimbra_email.templates.Email1",AjxTemplate.getTemplate("com_zimbra_email.templates.Email1#Frame"),AjxTemplate.getParams("com_zimbra_email.templates.Email1#Frame"));
AjxTemplate.register("com_zimbra_email.templates.Email1#ContactDetails",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
if(s.fullName){
e[o++]="<div><label id='UnknownPersonSlide_NameAnchorId' class='FakeAnchor' style='font-size:15px;font-weight:bold;'>";
e[o++]=AjxStringUtil.htmlEncode(s.fullName);
e[o++]="</label></div>"
}
e[o++]="<table style='margin-bottom:.5em;'><tr id='row_Presence'><td><div id='img_Presence'></div></td><td><label id='text_Presence'></label></td></tr></table>";
if(s.jobTitle){
e[o++]="<div><label >";
e[o++]=AjxStringUtil.htmlEncode(s.jobTitle);
e[o++]="</label></div>"
}
if(s.email){
e[o++]="<div><label  id='UnknownPersonSlide_EmailAnchorId' class='FakeAnchor'>";
e[o++]=AjxStringUtil.htmlEncode(s.email);
e[o++]="</label></div>"
}
if(s.mobilePhone){
e[o++]="<div><label id='UnknownPersonSlide_mobilePhoneAnchorId' class='FakeAnchor'>";
e[o++]=AjxStringUtil.htmlEncode(s.mobilePhone);
e[o++]=" (";
e[o++]=ZmMsg.cell;
e[o++]=")</label></div>"
}
if(s.workPhone){
e[o++]="<div><label id='UnknownPersonSlide_workPhoneAnchorId' class='FakeAnchor'>";
e[o++]=AjxStringUtil.htmlEncode(s.workPhone);
e[o++]=" (";
e[o++]=ZmMsg.work;
e[o++]=")</label></div>"
}
if(s.address){
e[o++]="<div><label>";
e[o++]=AjxStringUtil.htmlEncode(s.address);
e[o++]=" (";
e[o++]=ZmMsg.work;
e[o++]=")</label></div>"
}
if(s.imURI){
e[o++]="<div><label> ";
e[o++]=s.imURI;
e[o++]=" (";
e[o++]=ZmMsg.imShort;
e[o++]=")</label></div>"
}
return n?e.length:e.join("")
}
,{
id:"ContactDetails"}
,true);
function com_zimbra_email_handlerObject(){
this.isPrimaryEmailTooltip=true;
this._isBubble={};
this._bubbleClassName="addrBubble";
this._bubbleParams={};
this._internalId=Dwt.getNextId();
DwtControl.ALL_BY_ID[this._internalId]=this
}
com_zimbra_email_handlerObject.prototype=new ZmZimletBase();
com_zimbra_email_handlerObject.prototype.constructor=com_zimbra_email_handlerObject;
var EmailTooltipZimlet=com_zimbra_email_handlerObject;
EmailTooltipZimlet.IM_NEW_IM="im new im";
EmailTooltipZimlet.IM_NEW_BUDDY="im new buddy";
EmailTooltipZimlet.NEW_FILTER="__new__";
EmailTooltipZimlet.MAILTO_RE=/^mailto:[\x27\x22]?([^@?&\x22\x27]+@[^@?&]+\.[^@?&\x22\x27]+)[\x27\x22]?/;
EmailTooltipZimlet.tooltipWidth=280;
EmailTooltipZimlet.prototype.init=function(){
if(appCtxt.get(ZmSetting.CONTACTS_ENABLED)){
AjxDispatcher.require(["ContactsCore","Contacts"]);
if(appCtxt.get(ZmSetting.IM_ENABLED)){
this._presenceCache=[]
}}
this._prefDialog=new EmailToolTipPrefDialog(this);
this._subscriberZimlets=[];
this._presenceProvider=null;
this._preLoadImgs();
this._convModeCount=0;
this._presenceCache=[]
};
EmailTooltipZimlet.prototype.doubleClicked=function(){
this.singleClicked()
};
EmailTooltipZimlet.prototype.singleClicked=function(){
this._prefDialog.popup()
};
EmailTooltipZimlet.prototype._getRoster=function(){
if(!this._roster&&appCtxt.get(ZmSetting.IM_ENABLED)&&!(!appCtxt.get(ZmSetting.IM_PREF_AUTO_LOGIN)&&!appCtxt.getApp(ZmApp.IM).hasRoster())){
this._roster=AjxDispatcher.run("GetRoster");
var e=this._roster.getRosterItemList();
e.addChangeListener(new AjxListener(this,this._rosterChangeListener))
}
return this._roster
};
EmailTooltipZimlet.prototype._rosterChangeListener=function(d){
if(d.event!=ZmEvent.E_MODIFY){
return
}
var l=d.getDetail("fields");
var n=ZmRosterItem.F_PRESENCE in l;
if(n){
var t=d.getItems();
var r={};
for(var h=t.length;
--h>=0;
){
var u=t[h];
r[u.getAddress()]=u
}
var e=this._presenceCache;
for(var h=e.length;
--h>=0;
){
var o=e[h];
var u=r[o.im_addr];
if(u){
var s=document.getElementById(o.img_id);
if(s&&u.getPresence().getShow()==ZmRosterPresence.SHOW_ONLINE){
AjxImg.setImage(s,u.getPresence().getIcon(true),true)
}else{}}}}};
EmailTooltipZimlet.prototype.onConvStart=function(){
if(this._convModeCount==0){
this._clearBubbles()
}
this._convModeCount++
};
EmailTooltipZimlet.prototype.onConvEnd=function(){
this._convModeCount--
};
EmailTooltipZimlet.prototype.onFindMsgObjects=function(){
if(this._convModeCount==0){
this._clearBubbles()
}};
EmailTooltipZimlet.prototype._clearBubbles=function(){
if(appCtxt.get(ZmSetting.USE_ADDR_BUBBLES)){
this._bubbleList=new ZmAddressBubbleList();
this._bubbleList.addSelectionListener(new AjxListener(this,this._bubbleSelectionListener));
this._bubbleList.addActionListener(new AjxListener(this,this._bubbleActionListener));
this._bubbleParams={}
}};
EmailTooltipZimlet.prototype.generateSpan=function(n,r,o,t,e,d){
d=d||{};
if(d.addrBubbles){
this._isBubble[t]=true;
var l=o.isGroup&&o.canExpand&&appCtxt.get("EXPAND_DL_ENABLED");
if(l&&!this._aclv){
var h={
dataClass:appCtxt.getAutocompleter(),matchValue:ZmAutocomplete.AC_VALUE_FULL,options:{
addrBubbles:true,massDLComplete:true}
,selectionCallback:this._dlAddrSelected.bind(this),contextId:this.name};
this._aclv=new ZmAutocompleteListView(h)
}
var s={
parent:appCtxt.getShell(),parentId:this._internalId,addrObj:o,id:t,canExpand:l,email:this._getAddress(o),separator:AjxEmailAddress.SEPARATOR};
ZmAddressInputField.BUBBLE_OBJ_ID[t]=this._internalId;
this._bubbleParams[t]=s;
n[r++]="<span id='"+t+"'>";
n[r++]="</span>";
return r
}else{
return ZmObjectHandler.prototype.generateSpan.apply(this,arguments)
}};
EmailTooltipZimlet.prototype.onMsgView=function(){
this._createBubbles()
};
EmailTooltipZimlet.prototype.onConvView=function(){
this._createBubbles()
};
EmailTooltipZimlet.prototype._createBubbles=function(){
for(var o in this._bubbleParams){
if(!document.getElementById(o)){
continue
}
var t=this._bubbleParams[o];
var e=new ZmAddressBubble(t);
e.replaceElement(o);
if(this._bubbleList){
this._bubbleList.add(e)
}}};
EmailTooltipZimlet.prototype._bubbleSelectionListener=function(t){
var e=t.item;
if(e&&t.detail===DwtEvent.ONDBLCLICK){
this._composeListener(t,e.address)
}};
EmailTooltipZimlet.prototype._bubbleActionListener=function(t){
var e=t.item;
var o=this.getActionMenu(e.addrObj);
if(o){
this._actionBubble=e;
o.popup(0,t.docX,t.docY)
}};
EmailTooltipZimlet.prototype._menuPopdownListener=function(){
if(!appCtxt.get(ZmSetting.USE_ADDR_BUBBLES)){
return
}
if(this._actionBubble){
this._actionBubble.setClassName(this._bubbleClassName)
}
AjxTimedAction.scheduleAction(new AjxTimedAction(this,function(){
this._actionBubble=null;
if(this._bubbleList){
this._bubbleList.clearRightSelection()
}}
),10)
};
EmailTooltipZimlet.prototype.getClassName=function(o,e,t){
return(this._isBubble[t])?this._bubbleClassName:ZmObjectHandler.prototype.getClassName.apply(this,arguments)
};
EmailTooltipZimlet.prototype.getHoveredClassName=function(o,e,t){
return(this._isBubble[t])?this._bubbleClassName:ZmObjectHandler.prototype.getHoveredClassName.apply(this,arguments)
};
EmailTooltipZimlet.prototype.getActiveClassName=function(o,e,t){
return(this._isBubble[t])?this._bubbleClassName:ZmObjectHandler.prototype.getActiveClassName.apply(this,arguments)
};
EmailTooltipZimlet.prototype._getHtmlContent=function(n,l,o,e,t,u){
if(o instanceof AjxEmailAddress){
var e=window.parentAppCtxt||window.appCtxt;
var h=e.getApp(ZmApp.CONTACTS);
var s=h&&h.getContactByEmail(o.address);
var r=this._getBuddy(s,o.address);
if(h&&!s&&s!==null){
var d=new AjxCallback(this,this._handleResponseGetContact,[n,l,o,t,u]);
h.getContactByEmail(o.address,d)
}
return this._updateHtmlContent(n,l,o,s,r,t,u)
}else{
n[l++]=AjxStringUtil.htmlEncode(o);
return l
}};
EmailTooltipZimlet.prototype._updateHtmlContent=function(s,m,n,r,d,t,f){
var h;
var o=d&&d.getPresence();
if(o&&o.getShow()==ZmRosterPresence.SHOW_ONLINE){
var l=Dwt.getNextId();
h=[AjxStringUtil.htmlEncode(d.getDisplayName()),AjxImg.getImageHtml(o.getIcon(true),"display:inline; padding-left:13px","id="+l)].join("");
var e={
contact:r,buddy:d,im_addr:d.getAddress(),img_id:l};
this._presenceCache.push(e);
if(this._presenceCache.length>50){
this._presenceCache.splice(0,1)
}
this._getRoster()
}else{
h=AjxStringUtil.htmlEncode(n.toString(f&&f.shortAddress))
}
var u=t&&document.getElementById(t);
if(u){
u.innerHTML=h
}else{
s[m++]=h;
return m
}};
EmailTooltipZimlet.prototype._handleResponseGetContact=function(s,t,h,r,n,e){
if(e){
var o=this._getBuddy(e,h.address);
this._updateHtmlContent(s,t,h,e,o,r,n)
}};
EmailTooltipZimlet.prototype._getBuddy=function(e,t){
if(appCtxt.isChildWindow){
return
}
var o;
if(appCtxt.get(ZmSetting.IM_ENABLED)&&!(!appCtxt.get(ZmSetting.IM_PREF_AUTO_LOGIN)&&!appCtxt.getApp(ZmApp.IM).hasRoster())){
o=e&&e.getBuddy();
if(!o){
o=AjxDispatcher.run("GetRoster").getRosterItem(t)
}}
return o
};
EmailTooltipZimlet.prototype.hoverOut=function(e,t,n,o){
if(!this.tooltip){
return
}
if(o&&this._bubbleParams[o]){
return
}
this._hoverOver=false;
this.tooltip._poppedUp=false;
setTimeout(AjxCallback.simpleClosure(this.popDownIfMouseNotOnSlide,this),700)
};
EmailTooltipZimlet.prototype.popDownIfMouseNotOnSlide=function(){
if(this._hoverOver){
return
}else{
if(this.slideShow&&this.slideShow.isMouseOverTooltip){
return
}else{
if(this.tooltip){
this.tooltip._poppedUp=true;
this.tooltip.popdown()
}}}};
EmailTooltipZimlet.prototype.popdown=function(){
this._hoverOver=false;
if(this.tooltip){
this.tooltip._poppedUp=true;
this.tooltip.popdown()
}};
EmailTooltipZimlet.prototype.addSubscriberZimlet=function(e,o,t){
this._subscriberZimlets.push(e);
if(o){
this.primarySubscriberZimlet=e
}
if(t&&t.presenceCallback&&!this._presenceProvider){
this._presenceProvider=t.presenceCallback
}};
EmailTooltipZimlet.prototype.hoverOver=function(t,n,e,h,s){
var o=DwtShell.getShell(window);
var r=o.getToolTip();
r.setContent('<div id="zimletTooltipDiv"/>',true);
this.x=e;
this.y=h;
if(!this.toolTipPoppedUp(s,t,n,document.getElementById("zimletTooltipDiv"))){
r.popup(e,h,true,new AjxCallback(this,this.hoverOut,t,n,s))
}};
EmailTooltipZimlet.prototype.toolTipPoppedUp=function(o,n,t,e){
var r=appCtxt.getToolTipMgr().getToolTip(ZmToolTipMgr.PERSON,{
address:n}
);
if(r){
var s=document.getElementById("zimletTooltipDiv");
if(s){
s.innerHTML=r
}
return false
}
return true
};
EmailTooltipZimlet.prototype.onHoverOverEmailInList=function(t,n,o){
if(!t||!t.address){
return false
}
var e=n?n.docX:this.x;
var s=n?n.docY:this.y;
this.noRightClick=o;
return this.handleHover(t,null,e,s)
};
EmailTooltipZimlet.prototype.handleHover=function(t,o,e,r,s,n){
if(n&&this._bubbleParams[n]){
return false
}
this._hoverOver=true;
this._initializeProps(t,o,e,r,s);
appCtxt.notifyZimlets("onEmailHoverOver",[this],{
waitUntilLoaded:true}
);
if(this.primarySubscriberZimlet){
this.primarySubscriberZimlet.showTooltip();
return true
}
this._unknownPersonSlide=new UnknownPersonSlide();
this._unknownPersonSlide.onEmailHoverOver(this);
this._unknownPersonSlide.showTooltip();
return true
};
EmailTooltipZimlet.prototype._initializeProps=function(t,e,h,r,l){
if(!this.seriesAnimation){
this.seriesAnimation=new SeriesAnimation()
}
this.seriesAnimation.reset();
var o=DwtShell.getShell(window);
var d=o.getToolTip();
d.setContent('<div id="zimletTooltipDiv"></div>',true);
this.x=h;
this.y=r;
this.tooltip=d;
Dwt.setHandler(d._div,DwtEvent.ONMOUSEOUT,AjxCallback.simpleClosure(this.hoverOut,this));
var s=(t instanceof AjxEmailAddress)?t.address:t;
var n=this.isMailToLink(s);
if(n){
s=(this.parseMailToLink(s)).to||s
}
this.emailAddress=s;
this.fullName=(t instanceof AjxEmailAddress)?t.name:"";
this.canvas=document.getElementById("zimletTooltipDiv");
this.slideShow=new EmailToolTipSlideShow(this,this.canvas);
this.contextMenu=this.getActionMenu(t,l,e,false)
};
EmailTooltipZimlet.prototype._preLoadImgs=function(){
this._busyImg=new Image();
this._busyImg.src=this.getResource("img/EmailZimlet_busy.gif");
this._unknownPersonImg=new Image();
this._unknownPersonImg.src=this.getResource("img/UnknownPerson_dataNotFound.jpg")
};
EmailTooltipZimlet.prototype.showBusyImg=function(e,t,s){
var n=s?this.y+s:this.y;
var o=t?this.x+t:this.x;
this._busyImg.style.top=n;
this._busyImg.style.left=o;
this._busyImg.style.display="block";
this._busyImg.style.position="absolute";
this._busyImg.style.zIndex="500";
this._busyImgTimer=setTimeout(AjxCallback.simpleClosure(this._handleNoImg,this,e),4000)
};
EmailTooltipZimlet.prototype.showLoadingAtId=function(e,o){
var t=document.getElementById(o);
t.innerHTML=["<br/><br/><label style='color:gray'>",ZmMsg.loading,"</label>"].join("");
this._busyImgTimer=setTimeout(AjxCallback.simpleClosure(this._handleNoImgAtId,this,e,o),4000)
};
EmailTooltipZimlet.prototype._handleNoImgAtId=function(e,t){
clearTimeout(this._busyImgTimer);
if(e){
e.run()
}};
EmailTooltipZimlet.prototype._handleNoImg=function(e){
clearTimeout(this._busyImgTimer);
this._busyImg.style.zIndex="100";
this._busyImg.style.display="none";
if(e){
e.run()
}};
EmailTooltipZimlet.prototype.hideBusyImg=function(){
clearTimeout(this._busyImgTimer);
this._busyImg.style.zIndex="100";
this._busyImg.style.display="none"
};
EmailTooltipZimlet.prototype.createFilterMenu=function(e){
if(this._filterMenu){
return
}
this._newFilterMenuItem=e.getOp("ADDTOFILTER");
this._filterMenu=new ZmPopupMenu(e);
this._newFilterMenuItem.setMenu(this._filterMenu);
this._rules=AjxDispatcher.run("GetFilterRules");
this._rules.addChangeListener(new AjxListener(this,this._rulesChangeListener));
this._resetFilterMenu()
};
EmailTooltipZimlet.prototype.createSearchMenu=function(t){
if(this._searchMenu){
return
}
var e=[ZmOperation.SEARCH,ZmOperation.SEARCH_TO];
var n={};
n[ZmOperation.SEARCH]={
textKey:"findEmailFromRecipient"};
n[ZmOperation.SEARCH_TO]={
textKey:"findEmailToRecipient"};
this._searchMenu=new ZmActionMenu({
parent:t,menuItems:e,overrides:n}
);
var o=t.getOp("SEARCHEMAILS");
o.setMenu(this._searchMenu)
};
EmailTooltipZimlet.prototype._resetFilterMenu=function(){
var e=this._filterMenu.getItems();
while(e.length>0){
this._filterMenu.removeChild(e[0])
}
this._rules.loadRules(false,new AjxCallback(this,this._populateFiltersMenu))
};
EmailTooltipZimlet.prototype._populateFiltersMenu=function(t){
var o=t.getResponse();
var n=this._filterMenu;
var s=new DwtMenuItem({
parent:n}
);
s.setText(this.getMessage("newFilter"));
s.setImage("Plus");
s.setData(Dwt.KEY_OBJECT,EmailTooltipZimlet.NEW_FILTER);
s.addSelectionListener(new AjxListener(this,this._filterItemSelectionListener));
if(o.size()){
n.createSeparator()
}
for(var e=0;
e<o.size();
e++){
this._addFilter(n,o.get(e))
}};
EmailTooltipZimlet.prototype._rulesChangeListener=function(e){
if(e.type!=ZmEvent.S_FILTER){
return
}
if(!e.handled){
this._resetFilterMenu();
e.handled=true
}};
EmailTooltipZimlet.prototype._filterItemSelectionListener=function(t){
var e=t.item;
var o=true;
var s=e.getData(Dwt.KEY_OBJECT);
if(s==EmailTooltipZimlet.NEW_FILTER){
o=false;
s=new ZmFilterRule();
s.addAction(ZmFilterRule.A_KEEP)
}else{
s=this._rules.getRuleByName(s.name)||s
}
var r=this._getAddress(this._actionObject);
if(AjxUtil.isString(r)&&this.isMailToLink(r)){
r=(this.parseMailToLink(r)).to||r
}
var n=ZmFilterRule.C_ADDRESS_VALUE[ZmFilterRule.C_FROM];
s.addCondition(ZmFilterRule.TEST_ADDRESS,ZmFilterRule.OP_IS,r,n);
appCtxt.getFilterRuleDialog().popup(s,o)
};
EmailTooltipZimlet.prototype._addFilter=function(n,o,t){
var e=new DwtMenuItem({
parent:n,index:t}
);
e.setText(AjxStringUtil.clipByLength(o.name,20));
e.setData(Dwt.KEY_OBJECT,o);
e.addSelectionListener(new AjxListener(this,this._filterItemSelectionListener))
};
EmailTooltipZimlet.prototype.getActionMenu=function(n,u,t){
var l=ZmZimletBase.prototype.getActionMenu.call(this,n,u,t);
var s=appCtxt.isChildWindow;
if(!s&&appCtxt.get(ZmSetting.FILTERS_ENABLED)&&l.getOp("ADDTOFILTER")){
this.createFilterMenu(l)
}
if(!s&&appCtxt.get(ZmSetting.SEARCH_ENABLED)&&l.getOp("SEARCHEMAILS")){
this.createSearchMenu(l)
}
var h=this._getAddress(n);
if(this.isMailToLink(h)){
h=(this.parseMailToLink(h)).to||h
}
if(!(appCtxt.get(ZmSetting.CONTACTS_ENABLED)||appCtxt.isOffline)){
if(l.getOp("NEWCONTACT")){
l.removeOp("NEWCONTACT")
}}
var e=l.getOp("NEWIM");
if(e){
if(s||!appCtxt.get(ZmSetting.IM_ENABLED)){
l.removeOp("NEWIM")
}else{
var o=n instanceof AjxEmailAddress?n:new AjxEmailAddress(n);
ZmImApp.updateImMenuItemByAddress(e,o)
}}
if(l.getOp("SEARCHEMAILS")&&(s||!appCtxt.get(ZmSetting.SEARCH_ENABLED))){
ZmOperation.removeOperation(l,"SEARCHEMAILS",l._menuItems)
}else{
if(n&&n.type){
if(l.getOp("SEARCHEMAILS")){
if(n.type=="FROM"){
ZmOperation.setOperation(this._searchMenu,ZmOperation.SEARCH,ZmOperation.SEARCH,ZmMsg.findEmailFromSender);
ZmOperation.setOperation(this._searchMenu,ZmOperation.SEARCH_TO,ZmOperation.SEARCH_TO,ZmMsg.findEmailToSender)
}else{
ZmOperation.setOperation(this._searchMenu,ZmOperation.SEARCH,ZmOperation.SEARCH,ZmMsg.findEmailFromRecipient);
ZmOperation.setOperation(this._searchMenu,ZmOperation.SEARCH_TO,ZmOperation.SEARCH_TO,ZmMsg.findEmailToRecipient)
}
this._searchMenu.addSelectionListener("SEARCH",new AjxListener(this,this.menuItemSelected,["SEARCH",n]));
this._searchMenu.addSelectionListener("SEARCH_TO",new AjxListener(this,this.menuItemSelected,["SEARCH_TO",n]))
}}}
if(l.getOp("ADDTOFILTER")&&(s||!appCtxt.get(ZmSetting.FILTERS_ENABLED))){
ZmOperation.removeOperation(l,"ADDTOFILTER",l._menuItems)
}
var d=appCtxt.getApp(ZmApp.CONTACTS);
var r=d&&d.getContactByEmail(h);
var m=l.getOp("NEWCONTACT");
if(m){
m.setVisible(true)
}
if(r){
if(r.isDistributionList()&&m){
m.setVisible(false)
}
ZmOperation.setOperation(l,"NEWCONTACT",ZmOperation.EDIT_CONTACT)
}else{
if(d&&!r&&r!==null){
if(l.getOp("NEWCONTACT")){
l.getOp("NEWCONTACT").setText(ZmMsg.loading)
}
var f=new AjxCallback(this,this._handleResponseGetContact1,[l]);
d.getContactByEmail(h,f)
}else{
ZmOperation.setOperation(l,"NEWCONTACT",ZmOperation.NEW_CONTACT,ZmMsg.AB_ADD_CONTACT)
}}
if(!l.isListenerRegistered(DwtEvent.POPDOWN)){
l.addPopdownListener(new AjxListener(this,this._menuPopdownListener))
}
return l
};
EmailTooltipZimlet.prototype._handleResponseGetContact1=function(n,e){
var t=e?ZmOperation.EDIT_CONTACT:ZmOperation.NEW_CONTACT;
var o=e?null:ZmMsg.AB_ADD_CONTACT;
ZmOperation.setOperation(n,"NEWCONTACT",t,o)
};
EmailTooltipZimlet.prototype.isMailToLink=function(e){
return(!!(e.search(/mailto/i)!=-1))
};
EmailTooltipZimlet.prototype.parseMailToLink=function(o){
var t={};
var e=o.match(/\bsubject=([^&]+)/i);
t.subject=e?decodeURIComponent(e[1]):null;
e=o.match(/\bto\:([^&]+)/);
if(!e){
e=o.match(/\bmailto\:([^\?]+)/i)
}
t.to=e?decodeURIComponent(e[1]):null;
e=o.match(/\bbody=([^&]+)/i);
t.body=e?decodeURIComponent(e[1]):null;
return t
};
EmailTooltipZimlet.prototype.clicked=function(o,s,e,n){
var t=o&&o.id;
if(t&&this._bubbleParams[t]){
return
}
if(this.tooltip){
this.tooltip.popdown()
}
this._actionObject=s;
this._composeListener(n,this._getAddress(s))
};
EmailTooltipZimlet.prototype.menuItemSelected=function(o,t,e){
switch(o){
case"SEARCH":this._searchListener();
break;
case"SEARCH_TO":this._searchToListener();
break;
case"SEARCHBUILDER":this._browseListener();
break;
case"NEWEMAIL":this._composeListener(e);
break;
case"NEWIM":this._newImListener(e);
break;
case"NEWCONTACT":this._contactListener(true);
break;
case"ADDTOFILTER":this._filterListener();
break;
case"GOTOURL":this._goToUrlListener();
break
}};
EmailTooltipZimlet.prototype._getYahooHint=function(){
var t=[];
var e=0;
t[e++]="<center><table border=0><tr><td valign=top><div class='ImgWebSearch'></div></td><td>";
t[e++]=ZmMsg.leftClickYahoohint;
t[e++]="<div class='TooltipHint'>";
t[e++]=ZmMsg.rightClickHint;
t[e++]="</div></td></tr></table></center>";
return t.join("")
};
EmailTooltipZimlet.prototype._getAddress=function(e){
return e.isAjxEmailAddress?e.address:e
};
EmailTooltipZimlet.prototype._contactListener=function(t){
this.popdown();
var e=new AjxCallback(this,this._handleLoadContact,[t]);
AjxDispatcher.require(["ContactsCore","Contacts"],false,e,null,true)
};
EmailTooltipZimlet.prototype._newImListener=function(e){
ZmImApp.getImMenuItemListener().handleEvent(e)
};
EmailTooltipZimlet.prototype._getActionedContact=function(t){
var e;
var o=this._actionObject;
if(this._actionObject){
if(this._actionObject.toString()=="ZmContact"){
e=this._actionObject
}else{
if(AjxUtil.isString(this._actionObject)){
o=this._getAddress(this._actionObject);
if(this.isMailToLink(o)){
o=(this.parseMailToLink(o)).to||o
}
e=AjxDispatcher.run("GetContacts").getContactByEmail(o)
}else{
e=AjxDispatcher.run("GetContacts").getContactByEmail(this._actionObject.address)
}}}
if(e==null&&t){
e=new ZmContact(null);
e.initFromEmail(o)
}
return e
};
EmailTooltipZimlet.prototype._handleLoadContact=function(t){
var e=this._getActionedContact(true);
if(window.parentAppCtxt){
var o=window.parentAppCtxt.getApp(ZmApp.CONTACTS);
o.getContactController().show(e,t)
}else{
AjxDispatcher.run("GetContactController").show(e,t)
}};
EmailTooltipZimlet.prototype._composeListener=function(t,r){
this.popdown();
var n=this._actionObject;
r=r?this._getAddress(r):(n?this._getAddress(n):"");
var s={};
var e=(!appCtxt.get(ZmSetting.NEW_WINDOW_COMPOSE)&&t&&t.shiftKey)||(appCtxt.get(ZmSetting.NEW_WINDOW_COMPOSE)&&t&&!t.shiftKey);
if(this.isMailToLink(r)){
var o=this.parseMailToLink(r);
s.toOverride=o.to;
s.subjOverride=o.subject;
s.extraBodyText=o.body;
r=o.to||r
}
s.action=ZmOperation.NEW_MESSAGE;
s.inNewWindow=e;
if(!s.toOverride){
s.toOverride=r+AjxEmailAddress.SEPARATOR
}
if(n&&n.isAjxEmailAddress&&n.address==r){
s.toOverride=n
}
AjxDispatcher.run("Compose",s)
};
EmailTooltipZimlet.prototype._browseListener=function(){
var e=this._getAddress(this._actionObject);
if(this.isMailToLink(e)){
e=(this.parseMailToLink(e)).to||e
}
appCtxt.getSearchController().fromBrowse(e)
};
EmailTooltipZimlet.prototype._searchListener=function(){
var e=this._getAddress(this._actionObject);
if(this.isMailToLink(e)){
e=(this.parseMailToLink(e)).to||e
}
appCtxt.getSearchController().fromSearch(this._getAddress(e))
};
EmailTooltipZimlet.prototype._searchToListener=function(){
var e=this._getAddress(this._actionObject);
if(this.isMailToLink(e)){
e=(this.parseMailToLink(e)).to||e
}
appCtxt.getSearchController().toSearch(this._getAddress(e))
};
EmailTooltipZimlet.prototype._filterListener=function(){
var e=new AjxCallback(this,this._handleLoadFilter);
AjxDispatcher.require(["PreferencesCore","Preferences"],false,e,null,true)
};
EmailTooltipZimlet.prototype._handleLoadFilter=function(){
appCtxt.getAppViewMgr().popView(true,ZmId.VIEW_LOADING);
var t=new ZmFilterRule();
var o=this._getAddress(this._actionObject);
if(AjxUtil.isString(o)&&this.isMailToLink(o)){
o=(this.parseMailToLink(o)).to||o
}
var e=ZmFilterRule.C_ADDRESS_VALUE[ZmFilterRule.C_FROM];
t.addCondition(ZmFilterRule.TEST_ADDRESS,ZmFilterRule.OP_IS,o,e);
t.addAction(ZmFilterRule.A_KEEP);
appCtxt.getFilterRuleDialog().popup(t)
};
EmailTooltipZimlet.prototype._goToUrlListener=function(){
var n=this._getAddress(this._actionObject);
if(AjxUtil.isString(n)&&this.isMailToLink(n)){
n=(this.parseMailToLink(n)).to||n
}
var o=n.split("@");
if(o.length){
var t=o[o.length-1];
var e=t.split(".");
this._actionUrl="http://"+((e.length<=2)?"www."+t:t)
}
if(this._actionUrl){
window.open(this._actionUrl,"_blank")
}else{
this.displayStatusMessage(ZmMsg.errorCreateUrl)
}};
EmailTooltipZimlet.prototype._phoneListener=function(e){
if(!e){
return
}
appCtxt.notifyZimlets("onPhoneClicked",[e],{
waitUntilLoaded:true}
)
};
EmailTooltipZimlet.prototype._imListener=function(e){
if(!e){
return
}};
EmailTooltipZimlet.prototype.animateOpacity=function(h,s,e,t){
this.changeOpac(s,document.getElementById(h).style);
var o=Math.round(t/100);
var r=0;
var n=document.getElementById(h).style;
if(s>e){
for(i=s;
i>=e;
i--){
setTimeout(AjxCallback.simpleClosure(this.changeOpac,this,i,n),(r*o));
r++
}}else{
if(s<e){
for(i=s;
i<=e;
i++){
setTimeout(AjxCallback.simpleClosure(this.changeOpac,this,i,n),(r*o));
r++
}}}};
EmailTooltipZimlet.prototype.changeOpac=function(e,t){
t.opacity=(e/100);
t.MozOpacity=(e/100);
t.KhtmlOpacity=(e/100);
t.zoom=1;
t.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+e+")"
};
EmailTooltipZimlet.prototype.openCenteredWindow=function(o){
this.popdown();
var n=800;
var e=600;
var h=parseInt((screen.availWidth/2)-(n/2));
var r=parseInt((screen.availHeight/2)-(e/2));
var t="width="+n+",height="+e+",status,resizable,left="+h+",top="+r+"screenX="+h+",screenY="+r;
var s=window.open(o,"subWind",t);
if(!s){
this._showWarningMsg(ZmMsg.popupBlocker)
}};
EmailTooltipZimlet.prototype.expandBubble=function(o,t){
var e=document.getElementById(o);
if(e){
var n=Dwt.getLocation(e);
n.y+=Dwt.getSize(e).y+2;
this._aclv.expandDL({
email:t,loc:n}
)
}};
EmailTooltipZimlet.prototype._dlAddrSelected=function(e,t){
this._composeListener(t,e)
};
EmailToolTipSlideShow.mainDivId="EmailZimlet_slidesMainDiv";
EmailToolTipSlideShow.navDivId="EmailZimlet_slidesNavDiv";
EmailToolTipSlideShow.navTableRowId="EmailZimlet_slidesNavTableRow";
function EmailToolTipSlideShow(e,t){
this.slidesIconAndSlideMap=[];
this.numberOfSlides=0;
this.emailZimlet=e;
this.canvas=t;
this._createFrame(t);
this.mainDiv=document.getElementById(EmailToolTipSlideShow.mainDivId);
this.navDiv=document.getElementById(EmailToolTipSlideShow.navDivId);
this.navTableRow=document.getElementById(EmailToolTipSlideShow.navTableRowId);
this.currentSelectCellId=null;
this.currentSlideId=null;
this.navDiv.onclick=AjxCallback.simpleClosure(this._handleClick,this);
t.onmouseover=AjxCallback.simpleClosure(this.handleMouseOver,this);
t.onmouseout=AjxCallback.simpleClosure(this.handleMouseOut,this);
this.mainDiv.style.width=EmailTooltipZimlet.tooltipWidth+"px";
this.navDiv.style.width=EmailTooltipZimlet.tooltipWidth+"px"
}
EmailToolTipSlideShow.prototype._createFrame=function(e){
e.innerHTML=["<div id='",EmailToolTipSlideShow.mainDivId,"'></div>","<div id='",EmailToolTipSlideShow.navDivId,"'>","<div class='horizsep'></div>","<table width=100%><tr id='",EmailToolTipSlideShow.navTableRowId,"'>","</tr></table></div>"].join("")
};
EmailToolTipSlideShow.prototype._handleClick=function(o){
if(!o){
var o=window.event
}
var t;
if(o.target){
t=o.target
}else{
if(o.srcElement){
t=o.srcElement
}}
if(t.nodeType==3){
t=t.parentNode
}
if(t.id){
if(this.slidesIconAndSlideMap[t.id]){
this.slidesIconAndSlideMap[t.id].select()
}}};
EmailToolTipSlideShow.prototype.addSlide=function(e,t){
e.slideShow=this;
if(!t){
t=this.numberOfSlides
}
this.slidesIconAndSlideMap[e.iconDivId]=e;
var o=document.createElement("div");
o.id=e.id;
o.style.display="none";
this.mainDiv.appendChild(o);
o.innerHTML=e.html;
this._insertSlideIcon(e);
this.numberOfSlides++
};
EmailToolTipSlideShow.prototype._insertSlideIcon=function(e){
var r=e.iconName;
var n=e.iconDivId;
var t=e.selectCellId;
var o=e.name;
var s=this.navTableRow.insertCell(0);
this._insertIconHtml(s,t,o,n,r)
};
EmailToolTipSlideShow.prototype._insertIconHtml=function(n,e,t,o,s){
n.align="center";
n.id=e;
n.innerHTML=["<div title='",t,"' id='",o,"' class='Img",s,"' style='cursor:pointer;'></div>"].join("")
};
EmailToolTipSlideShow.prototype.handleMouseOver=function(){
this.isMouseOverTooltip=true
};
EmailToolTipSlideShow.prototype.handleMouseOut=function(){
this.isMouseOverTooltip=false;
this.emailZimlet.hoverOut()
};
function EmailToolTipSlide(o,n,s,e,t){
this.html=o;
this.visible=n;
this.iconName=s;
this.id=Dwt.getNextId();
this.iconDivId=Dwt.getNextId();
this.selectCellId=Dwt.getNextId();
this.slideShow=null;
this.canvasElement=null;
this._selectCallback=e;
this.name=t
}
EmailToolTipSlide.prototype.select=function(){
if(this.slideShow.currentSlideId){
document.getElementById(this.slideShow.currentSlideId).style.display="none"
}
document.getElementById(this.id).style.display="block";
this.slideShow.currentSlideId=this.id;
if(this.slideShow.currentSelectCellId){
document.getElementById(this.slideShow.currentSelectCellId).style.background=""
}
document.getElementById(this.selectCellId).style.display="none";
this.slideShow.currentSelectCellId=this.selectCellId;
if(this._selectCallback){
this._selectCallback.run()
}};
EmailToolTipSlide.prototype.setCanvasElement=function(e){
this.canvasElement=e
};
EmailToolTipSlide.prototype.setInfoMessage=function(e){
this._appendMsg2Slide(e,"EmailToolTipSlideMsgColor")
};
EmailToolTipSlide.prototype.setErrorMessage=function(e){
this._appendMsg2Slide(e,"EmailToolTipSlideErrorColor")
};
EmailToolTipSlide.prototype._appendMsg2Slide=function(o,e){
var t=["<div class='EmailToolTipSlideText ",e,"'>",o,"</div>"].join("");
if(this.canvasElement){
this.canvasElement.innerHTML=t
}};
EmailToolTipSlide.prototype.clearSlideMessage=function(t,e){
if(this.canvasElement){
this.canvasElement.innerHTML=""
}};
function EmailToolTipPrefDialog(e){
this.zimlet=e;
this.emailZimlet_tooltipArea=this.zimlet.getUserProperty("emailZimlet_tooltipArea");
if(!this.emailZimlet_tooltipArea){
this.emailZimlet_tooltipArea=EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_MEDIUM]
}
this.updateEmailTooltipSize()
}
EmailToolTipPrefDialog.SIZE_VERYSMALL="VERYSMALL";
EmailToolTipPrefDialog.SIZE_SMALL="SMALL";
EmailToolTipPrefDialog.SIZE_MEDIUM="MEDIUM";
EmailToolTipPrefDialog.SIZE_LARGE="LARGE";
EmailToolTipPrefDialog.SIZE_XL="XL";
EmailToolTipPrefDialog.DIMENSIONS=[];
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_VERYSMALL]="220px x 130px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_SMALL]="230px x 140px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_MEDIUM]="280px x 150px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_LARGE]="260px x 200px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_XL]="270px x 210px";
EmailToolTipPrefDialog.prototype.updateEmailTooltipSize=function(){
var e=this.emailZimlet_tooltipArea.replace(/px/ig,"");
var t=e.split(" x ");
EmailTooltipZimlet.tooltipWidth=t[0];
EmailTooltipZimlet.tooltipHeight=t[1]
};
function SeriesAnimation(){
this._objsToAnimate=[];
this._objIdAndAnimationTypeMap=[]
}
SeriesAnimation.prototype.startAnimation=function(){
this._animateNextItem()
};
SeriesAnimation.prototype.reset=function(){
this._objsToAnimate=[];
this._objIdAndAnimationTypeMap=[]
};
SeriesAnimation.prototype.addFadeIn=function(e,t){
this._addObjs({
objId:e,aType:"FADEIN",endingOpac:t,millisecs:null}
)
};
SeriesAnimation.prototype.addPause=function(e){
this._addObjs({
objId:"__PAUSE__",aType:"PAUSE",endingOpac:null,millisecs:e}
)
};
SeriesAnimation.prototype.addFadeOut=function(e,t){
this._addObjs({
objId:e,aType:"FADEOUT",endingOpac:t,millisecs:null}
)
};
SeriesAnimation.prototype.addslideUp=function(t,e){
this._addObjs({
objId:t,aType:"SLIDEUP",endHeightPercent:e}
)
};
SeriesAnimation.prototype.addslideDown=function(t,e){
this._addObjs({
objId:t,aType:"SLIDEDOWN",endHeightPercent:e}
)
};
SeriesAnimation.prototype.addZoomIn=function(o,e,n,t){
this._addObjs({
objId:o,aType:"ZOOMIN",objWidth:e,objHeight:n,zoomByThisPixels:t}
)
};
SeriesAnimation.prototype._addObjs=function(n){
var o=n.objId;
var e=n.aType;
var t=o+Dwt.getNextId();
this._objIdAndAnimationTypeMap[t]=n;
this._objsToAnimate.push(t)
};
SeriesAnimation.prototype._animate=function(s){
var n=s.objId;
var t=s.aType;
if(n.indexOf("__PAUSE__")==-1&&!document.getElementById(n)){
this.reset();
return
}
if(n.indexOf("__PAUSE__")==-1){
document.getElementById(n).style.display="block"
}
if(t=="FADEOUT"){
var r=s.endingOpac?s.endingOpac:0;
this._animateOpacity(n,100,r,500)
}else{
if(t=="PAUSE"){
this._animatePause(s.millisecs)
}else{
if(t=="FADEIN"){
var r=s.endingOpac?s.endingOpac:100;
this._animateOpacity(n,0,r,500)
}else{
if(t=="SLIDEUP"){
var o=s.endHeightPercent?s.endHeightPercent:100;
this._animateSliding(n,o,t,500)
}else{
if(t=="SLIDEDOWN"){
var o=s.endHeightPercent?s.endHeightPercent:0;
this._animateSliding(n,o,t,500)
}else{
if(t=="ZOOMIN"){
var e=s.zoomByThisPixels?s.zoomByThisPixels:0;
this._animateZoomIn(s)
}}}}}}};
SeriesAnimation.prototype._animateZoomIn=function(h){
var n=document.getElementById(h.objId);
var r=n.style;
var o=h.objWidth;
var e=h.objHeight;
var t=h.zoomByThisPixels;
var s=2;
var l=0;
for(i=0;
i<t;
i++){
if(i==t-1){
setTimeout(AjxCallback.simpleClosure(this._zoomInItem,this,r,(o+i),(e+i),true),(l*s))
}else{
setTimeout(AjxCallback.simpleClosure(this._zoomInItem,this,r,(o+i),(e+i),false),(l*s))
}
l++
}};
SeriesAnimation.prototype._zoomInItem=function(n,o,e,t){
n.width=o;
n.height=e;
if(t){
this._animateNextItem()
}};
SeriesAnimation.prototype._animateSliding=function(o,t,e,n){
var s=Math.round(n/100);
var l=0;
var r=document.getElementById(o).style;
var h=Math.round(document.getElementById(o).offsetHeight);
if(e=="SLIDEUP"){
for(i=h;
i<=t;
i++){
if(i==t){
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,true),(l*s))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,false),(l*s))
}
l++
}}else{
if(e=="SLIDEDOWN"){
for(i=h;
i>=t;
i--){
if(i==t){
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,true),(l*s))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,false),(l*s))
}
l++
}}}};
SeriesAnimation.prototype._animateOpacity=function(l,s,e,t){
var h=document.getElementById(l);
if(!h){
this.reset();
return
}
this._changeOpac(s,h.style);
var o=Math.round(t/100);
var r=0;
var n=h.style;
if(s>e){
for(i=s;
i>=e;
i--){
if(i==e){
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,true),(r*o))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,false),(r*o))
}
r++
}}else{
if(s<e){
for(i=s;
i<=e;
i++){
if(i==e){
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,true),(r*o))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,false),(r*o))
}
r++
}}}};
SeriesAnimation.prototype._changeHeight=function(e,o,t){
o.height=e;
if(t){
this._animateNextItem()
}};
SeriesAnimation.prototype._changeOpac=function(t,o,e){
if(!o){
return
}
o.opacity=(t/100);
o.MozOpacity=(t/100);
o.KhtmlOpacity=(t/100);
o.zoom=1;
o.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")";
if(e){
this._animateNextItem()
}};
SeriesAnimation.prototype._animateNextItem=function(){
if(this._objsToAnimate.length==0){
return
}
var e=this._objsToAnimate[0];
var t=this._objIdAndAnimationTypeMap[e];
this._objsToAnimate.splice(0,1);
this._animate(t)
};
SeriesAnimation.prototype._animatePause=function(e){
setTimeout(AjxCallback.simpleClosure(this._animateNextItem,this),e)
};
function UnknownPersonSlide(){}
UnknownPersonSlide.PHOTO_ID="unkownPerson_photoBG";
UnknownPersonSlide.PHOTO_PARENT_ID="unkownPerson_photoBGDiv";
UnknownPersonSlide.TEXT_DIV_ID="unkownPerson_TextDiv";
UnknownPersonSlide.DOMAIN="";
UnknownPersonSlide.WIDTH=65;
UnknownPersonSlide.HEIGHT=80;
UnknownPersonSlide.prototype.onEmailHoverOver=function(e){
e.addSubscriberZimlet(this,false);
this.emailZimlet=e;
this._alwaysSetTooltipToSmall();
this._presenceCache=this.emailZimlet._presenceCache
};
UnknownPersonSlide.prototype._alwaysSetTooltipToSmall=function(){
var t=EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_VERYSMALL];
var e=t.replace(/px/ig,"");
var o=e.split(" x ");
this._tooltipWidth=o[0];
this._tooltipHeight=o[1]
};
UnknownPersonSlide.prototype.showTooltip=function(){
if(appCtxt.get(ZmSetting.CALENDAR_ENABLED)){
this._setCalendarFrame()
}
if(appCtxt.get(ZmSetting.MAIL_ENABLED)){
this._setMailFrame()
}
this._setContactFrame();
this.emailZimlet.tooltip.popup(this.emailZimlet.x,this.emailZimlet.y,true,null);
this._slide.select()
};
UnknownPersonSlide.prototype._setContactFrame=function(){
this.emailZimlet.hideBusyImg();
var t=this._getTooltipBGHtml();
var e=new AjxCallback(this,this._handleContactSlideSelect);
this._slide=new EmailToolTipSlide(t,true,"UnknownPerson_contact",e,this.emailZimlet.getMessage("slideTooltip"));
this.emailZimlet.slideShow.addSlide(this._slide);
this._mainDiv=document.getElementById(UnknownPersonSlide.TEXT_DIV_ID);
this._slide.setCanvasElement(this._mainDiv)
};
UnknownPersonSlide.prototype._setMailFrame=function(){
var t=new AjxCallback(this,this._handleMailSlideSelect);
var e=new EmailToolTipSlide(null,true,"Mail_icon",t,this.emailZimlet.getMessage("slideMailTooltip"));
this.emailZimlet.slideShow.addSlide(e)
};
UnknownPersonSlide.prototype._setCalendarFrame=function(){
var t=new AjxCallback(this,this._handleCalendarSlideSelect);
var e=new EmailToolTipSlide(null,true,"Calendar_icon",t,this.emailZimlet.getMessage("slideCalendarTooltip"));
this.emailZimlet.slideShow.addSlide(e)
};
UnknownPersonSlide.prototype._setPresence=function(){};
UnknownPersonSlide.prototype._handleImgLoadFailure=function(){
var e=new Image();
e.onload=AjxCallback.simpleClosure(this._handleImageLoad,this,e);
e.id=UnknownPersonSlide.PHOTO_ID;
e.src=this.emailZimlet.getResource("img/UnknownPerson_dataNotFound.jpg")
};
UnknownPersonSlide.prototype._handleImageLoad=function(e){
this.emailZimlet.hideBusyImg();
var t=document.getElementById(UnknownPersonSlide.PHOTO_PARENT_ID);
if(!t){
return
}
t.innerHTML="";
t.style.textAlign="center";
t.appendChild(e);
if(this.emailZimlet.emailAddress.indexOf(UnknownPersonSlide.DOMAIN)!=-1){
e.onclick=AjxCallback.simpleClosure(this._handleProfileImageClick,this);
e.style.cursor="pointer";
e.style.maxHeight=UnknownPersonSlide.HEIGHT+"px";
e.style.maxWidth=UnknownPersonSlide.WIDTH+"px"
}
if(AjxEnv.isIE){
e.height=UnknownPersonSlide.HEIGHT
}};
UnknownPersonSlide.prototype._handleProfileImageClick=function(){};
UnknownPersonSlide.prototype._handleAllClicks=function(o){
var n;
this.emailZimlet.popdown();
if(AjxEnv.isIE){
o=window.event
}
if(o.which){
n=(o.which==3)
}else{
if(o.button){
n=(o.button==2)
}}
if(n){
DwtUiEvent.setBehaviour(o,true,false);
this.emailZimlet.contextMenu.popup(100,this.emailZimlet.x,this.emailZimlet.y);
return
}
var t=DwtShell.mouseEvent;
t.setFromDhtmlEvent(o);
var e=t.target;
if(e.id=="UnknownPersonSlide_EmailAnchorId"){
this.emailZimlet._composeListener(null,this.emailZimlet.emailAddress)
}else{
if(e.id=="UnknownPersonSlide_NameAnchorId"){
this.emailZimlet._contactListener(true)
}else{
if(e.id=="UnknownPersonSlide_mobilePhoneAnchorId"&&appCtxt.getSettings()._hasVoiceFeature()){
this.emailZimlet._phoneListener(this.attribs&&this.attribs.mobilePhone)
}else{
if(e.id=="UnknownPersonSlide_workPhoneAnchorId"&&appCtxt.getSettings()._hasVoiceFeature()){
this.emailZimlet._phoneListener(this.attribs&&this.attribs.workPhone)
}else{
if(e.id=="UnknownPersonSlide_imAnchorId"&&appCtxt.getSettings()._hasVoiceFeature()){
ZmZimbraMail.unloadHackCallback();
location.href=this.imURI;
this.emailZimlet._imListener(this.imURI);
return false
}}}}}};
UnknownPersonSlide.prototype._handleRightClick=function(t){
var e;
if(!t){
var t=window.event
}
if(t.which){
e=(t.which==3)
}else{
if(t.button){
e=(t.button==2)
}}
if(!e){
return
}
this.emailZimlet.popdown();
DwtUiEvent.setBehaviour(t,true,false);
this.emailZimlet.contextMenu.popup(100,this.emailZimlet.x,this.emailZimlet.y)
};
UnknownPersonSlide.prototype._handleContactSlideSelect=function(){
if(this._slide.loaded){
return
}
this._slide.loaded=true;
this._getContactDetailsAndShowTooltip()
};
UnknownPersonSlide.prototype._handleMailSlideSelect=function(){
this.emailZimlet.popdown();
this.emailZimlet._composeListener(null,this.emailZimlet.emailAddress)
};
UnknownPersonSlide.prototype._handleCalendarSlideSelect=function(){
this.emailZimlet.popdown();
var e=new ZmAppt();
var t=this.emailZimlet._getActionedContact()||new AjxEmailAddress(this.emailZimlet.emailAddress);
e.setAttendees(t,ZmCalBaseItem.PERSON);
AjxDispatcher.run("GetCalController").newAppointment(e,null,null,null)
};
UnknownPersonSlide.prototype._getContactDetailsAndShowTooltip=function(){
this._slide.setInfoMessage(this.emailZimlet.getMessage("loading"));
var t=AjxDispatcher.run("GetContacts");
var e=t?t.getContactByEmail(this.emailZimlet.emailAddress):null;
if(e||!appCtxt.get(ZmSetting.GAL_ENABLED)){
this._handleContactDetails(null,e)
}else{
var r,n,o;
r={
SearchGalRequest:{
_jsns:"urn:zimbraAccount"}};
n=r.SearchGalRequest;
n.type="account";
n.name=this.emailZimlet.emailAddress;
n.offset=0;
n.limit=3;
var s=new AjxCallback(this,this._handleContactDetails);
appCtxt.getAppController().sendRequest({
jsonObj:r,asyncMode:true,callback:s,noBusyOverlay:true}
)
}};
UnknownPersonSlide.prototype._handleContactDetails=function(t,e){
var o=null;
var d=null;
if(t){
var s=t.getResponse();
var n=s.SearchGalResponse;
var l=n.cn;
if(l&&l[0]){
d=l[0].id;
o=l[0]._attrs
}}
o=o||e&&e.attr||{};
o.fullName=this.emailZimlet.fullName||o.fullName||e&&e._fileAs;
this._presentity=o.email=this.emailZimlet.emailAddress||o.email;
var h=e&&e.getImageUrl(UnknownPersonSlide.WIDTH);
this._setProfileImage(h);
this._setContactDetails(o);
this._popupToolTip();
this._setPresenceUI()
};
UnknownPersonSlide.prototype._getPresence=function(){
var e=new Date();
var t=this._presenceCache[this._presentity]&&this._presenceCache[this._presentity].timestamp||0;
if(e-t<5000){
return this._presenceCache[this._presentity]
}
if(this.emailZimlet._presenceProvider){
this.emailZimlet._presenceProvider(this._presentity,this._handlePresence.bind(this))
}
return null
};
UnknownPersonSlide.prototype._handlePresence=function(t){
if(!t){
return
}
var e=this._presenceCache[this._presentity];
if(!e){
e=this._presenceCache[this._presentity]={}
}
e.presenceStatus=t.presenceStatus;
e.notes=t.notes;
e.timestamp=new Date();
this._setPresenceUI()
};
UnknownPersonSlide.prototype._popupToolTip=function(){
this.emailZimlet.tooltip.popup(this.emailZimlet.x,this.emailZimlet.y,true,null)
};
UnknownPersonSlide.prototype._getTooltipBGHtml=function(e){
var o=";";
var n=";";
if(AjxEnv.isIE){
var o="width:100%;";
var n="left:3%;"
}
var t={
photoParentId:UnknownPersonSlide.PHOTO_PARENT_ID,textDivId:UnknownPersonSlide.TEXT_DIV_ID,width:o,left:n};
return AjxTemplate.expand("com_zimbra_email.templates.Email1#Frame",t)
};
UnknownPersonSlide.prototype._setContactDetails=function(h){
if(h.workState||h.workCity||h.workStreet||h.workPostalCode){
var e=h.workState||"";
var o=h.workCity||"";
var l=h.workStreet||"";
var d=h.workPostalCode||"";
var r=[l," ",o," ",e," ",d].join("");
h.address=AjxStringUtil.trim(r)
}
var s=h.imAddress||h.imAddress1||h.imAddress2||h.imAddress3;
if(s){
imParts=s.split(":");
if(imParts.length==2){
var t=imParts[0];
s=s.split(":")[1];
if(t&&t=="other"){
t="im"
}else{
if(t&&t=="aol"){
t="aim"
}}
s="<a  id='UnknownPersonSlide_imAnchorId' href='"+t+":"+AjxStringUtil.htmlEncode(s.substring(2))+"'>"+AjxStringUtil.htmlEncode(s.substring(2))+"</a>";
this.imURI=h.imURI=s
}}
if(!this.emailZimlet.noRightClick){
h.rightClickForMoreOptions=false
}
this.attribs=h;
h=this._formatTexts(h);
var n=AjxTemplate.expand("com_zimbra_email.templates.Email1#ContactDetails",h);
document.getElementById(UnknownPersonSlide.TEXT_DIV_ID).innerHTML=n;
document.getElementById("UnknownPersonSlide_Frame").onmouseup=AjxCallback.simpleClosure(this._handleAllClicks,this);
this._removeCustomAttrs(h)
};
UnknownPersonSlide.prototype._removeCustomAttrs=function(e){
if(e.rightClickForMoreOptions){
delete e.rightClickForMoreOptions
}
if(e.formattedEmail){
delete e.formattedEmail
}
if(e.address){
delete e.address
}
if(e.presence){
delete e.presence
}
if(e.imURI){
delete e.imURI
}};
UnknownPersonSlide.prototype._formatTexts=function(t){
var e=t.email?t.email:"";
t.formattedEmail=e;
if(e.length>25){
var o=e.split("@");
var n=o[0];
var r=o[1];
if(n.length>25){
n=n.substring(0,24)+".."
}
t.formattedEmail=[n," @",r].join("")
}
var s=t.fullName?t.fullName:"";
if(s==e){
t.fullName=""
}
return t
};
UnknownPersonSlide.prototype._setProfileImage=function(n){
var o=document.getElementById(UnknownPersonSlide.PHOTO_PARENT_ID);
o.width=o.style.width=UnknownPersonSlide.WIDTH;
o.height=o.style.height=UnknownPersonSlide.HEIGHT;
if(this.emailZimlet.emailAddress.indexOf(UnknownPersonSlide.DOMAIN)==-1||!n){
this._handleImgLoadFailure();
return
}
var t=new Image();
t.src=n;
t.onload=AjxCallback.simpleClosure(this._handleImageLoad,this,t);
var e=new AjxCallback(this,this._handleImgLoadFailure);
this.emailZimlet.showLoadingAtId(e,UnknownPersonSlide.PHOTO_PARENT_ID)
};
UnknownPersonSlide.prototype._isKnownPresenceCode=function(o){
if(!this._presenceCodes){
var e=["dnd","vacation","on-the-phone","busy","unavailable","away","available","unknown"];
this._presenceCodes={};
for(var t=0;
t<e.length;
t++){
this._presenceCodes[e[t]]=true
}}
return this._presenceCodes[o]
};
UnknownPersonSlide.prototype._setPresenceUI=function(){
var o=this._getPresence();
var n=o&&o.presenceStatus;
var s=document.getElementById("row_Presence");
var r=document.getElementById("img_Presence");
var t=document.getElementById("text_Presence");
if(!s||!r||!t){
return
}
if(n){
if(!this._isKnownPresenceCode(n)){
n="unknown"
}
s.style.display="";
var e=n.split("-").join("");
r.className="Img_"+e;
if(o.notes){
t.innerHTML=o.notes
}else{
t.innerHTML=this.emailZimlet.getMessage("msg_"+e)
}}else{
s.style.display="none"
}
return
};
function Com_Zimbra_Url(){}
Com_Zimbra_Url.prototype=new ZmZimletBase();
Com_Zimbra_Url.prototype.constructor=Com_Zimbra_Url;
Com_Zimbra_Url.prototype.init=function(){
this._disablePreview=this.getBoolConfig("disablePreview",true);
this._youtubePreview=this.getBoolConfig("youtubePreview",true);
this._alexaId=this.getConfig("alexaThumbnailId");
if(this._alexaId){
this._alexaId=AjxStringUtil.trim(this._alexaId);
this._alexaKey=AjxStringUtil.trim(this.getConfig("alexaThumbnailKey"))
}
Com_Zimbra_Url.REGEXES=[];
var e=this.getConfig("ZIMLET_CONFIG_REGEX_VALUE");
if(e){
var t=new RegExp(e,"gi");
if(t){
Com_Zimbra_Url.REGEXES.push(t)
}}
if(/^\s*true\s*$/i.test(this.getConfig("supportUNC"))){
e=this.getConfig("ZIMLET_UNC_REGEX_VALUE");
var t=new RegExp(e,"gi");
if(t){
Com_Zimbra_Url.REGEXES.push(t)
}}};
Com_Zimbra_Url.THUMB_URL="http://images.websnapr.com/?url=";
Com_Zimbra_Url.THUMB_SIZE='width="200" height="150"';
Com_Zimbra_Url.IGNORE=AjxUtil.arrayAsHash([".",",",";","!","*",":","?",")","]","}"]);
Com_Zimbra_Url.prototype.match=function(u,h){
for(var n=0;
n<Com_Zimbra_Url.REGEXES.length;
n++){
var d=Com_Zimbra_Url.REGEXES[n];
d.lastIndex=h;
var t=d.exec(u);
if(!t){
continue
}
var e=t[0];
var l=e.charAt(e.length-1);
while(e.length&&Com_Zimbra_Url.IGNORE[l]){
if(l==")"){
var r=0;
var s=0;
for(var o in e){
if(e[o]=="("){
r++
}else{
if(e[o]==")"){
s++
}}}
if(r==s){
break
}}
e=e.substring(0,e.length-1);
l=e.charAt(e.length-1)
}
t[0]=e;
return t
}};
Com_Zimbra_Url.prototype._getHtmlContent=function(r,d,s,e){
var h=s.replace(/\"/g,'"').replace(/^\s+|\s+$/g,"");
if(h.substr(0,4)=="www."){
h="http://"+h
}
if(h.indexOf("\\\\")==0){
s.isUNC=true;
h="file://"+h
}
h=h.replace(/\\/g,"/");
var l="<a target='_blank' href='"+h;
if(h.split(/[\?#]/)[0]==(""+window.location).split(/[\?#]/)[0]){
var n=h.substr(h.indexOf("?"));
if(n){
var o=AjxStringUtil.parseQueryString(h);
if(o){
var t=o.app;
if(t&&t.length>0){
t=t.toUpperCase();
if(appCtxt.getApp(ZmApp[t])){
l="<a href='javascript:top.appCtxt.getAppController().activateApp(top.ZmApp."+t+", null, null);"
}}}}}
r[d++]=l;
r[d++]="'>";
r[d++]=AjxStringUtil.htmlEncode(s);
r[d++]="</a>";
return d
};
Com_Zimbra_Url.prototype.toolTipPoppedUp=function(n,s,o,t){
var e=s.replace(/^\s+|\s+$/g,"");
if(/^\s*true\s*$/i.test(this.getConfig("stripUrls"))){
e=e.replace(/[?#].*$/,"")
}
if(e.indexOf("\\\\")==0){
e="file:"+e
}
e=e.replace(/\\/g,"/");
if(this._disablePreview||e.indexOf("file://")==0){
this._showUrlThumbnail(e,t)
}else{
if(this._alexaId){
this._showAlexaThumbnail(e,t)
}else{
(new Image()).src=this.getResource("blank_pixel.gif");
this._showFreeThumbnail(e,t)
}}};
Com_Zimbra_Url.prototype.clicked=function(){
var e=DwtShell.getShell(window).getToolTip();
if(e){
e.popdown()
}
return true
};
Com_Zimbra_Url.prototype._showUrlThumbnail=function(t,e){
e.innerHTML="<b>URL:</b> "+AjxStringUtil.htmlEncode(decodeURI(t))
};
Com_Zimbra_Url.prototype._showFreeThumbnail=function(t,e){
var n=[];
var o=0;
n[o++]="<img src='";
n[o++]=this.getResource("blank_pixel.gif");
n[o++]="' ";
n[o++]=Com_Zimbra_Url.THUMB_SIZE;
n[o++]=" style='background: url(";
n[o++]='"';
n[o++]=Com_Zimbra_Url.THUMB_URL;
n[o++]=t;
n[o++]='"';
n[o++]=")'/>";
e.innerHTML=n.join("")
};
Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE={};
Com_Zimbra_Url.ALEXA_CACHE_EXPIRES=10*60*1000;
Com_Zimbra_Url.prototype._showAlexaThumbnail=function(e,o){
o.innerHTML=["<table style='width: 200px; height: 150px; border-collapse: collapse' cellspacing='0' cellpadding='0'><tr><td align='center'>",ZmMsg.fetchingAlexaThumbnail,"</td></tr></table>"].join("");
var r=Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE[e];
if(r){
var f=new Date().getTime()-r.timestamp;
if(f<Com_Zimbra_Url.ALEXA_CACHE_EXPIRES){
var l=["<img src='",r.img,"' />"].join("");
o.firstChild.rows[0].cells[0].innerHTML=l;
return
}else{
delete Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE[e]
}}
var t=new Date(),s=Com_Zimbra_Url.zeroPad;
var d=s(t.getUTCFullYear(),4)+"-"+s(t.getUTCMonth()+1,2)+"-"+s(t.getUTCDate(),2)+"T"+s(t.getUTCHours(),2)+":"+s(t.getUTCMinutes(),2)+":"+s(t.getUTCSeconds(),2)+".000Z";
var n=this._computeAlexaSignature(d);
var u={
Service:"AlexaSiteThumbnail",Action:"Thumbnail",AWSAccessKeyId:this._alexaId,Timestamp:d,Signature:n,Size:"Large",Url:e};
var m=[];
for(var h in u){
m.push(h+"="+AjxStringUtil.urlComponentEncode(u[h]))
}
m="http://ast.amazonaws.com/xino/?"+m.join("&");
this.sendRequest(null,m,null,new AjxCallback(this,this._alexaDataIn,[o,e,m]),true)
};
Com_Zimbra_Url.prototype._computeAlexaSignature=function(e){
return AjxSHA1.b64_hmac_sha1(this._alexaKey,"AlexaSiteThumbnailThumbnail"+e)+"="
};
Com_Zimbra_Url.prototype._alexaDataIn=function(n,o,h,e){
var t=AjxXmlDoc.createFromDom(e.xml);
var r=t.toJSObject(true,false,true);
r=r.Response;
if(r.ResponseStatus.StatusCode=="Success"){
if(r.ThumbnailResult.Thumbnail.Exists=="true"){
var s=["<img src='",r.ThumbnailResult.Thumbnail,"' />"].join("");
n.firstChild.rows[0].cells[0].innerHTML=s;
Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE[o]={
img:r.ThumbnailResult.Thumbnail,timestamp:new Date().getTime()}
}else{
this._showFreeThumbnail(o,n)
}}else{
this._showFreeThumbnail(o,n)
}};
Com_Zimbra_Url.zeroPad=function(o,t){
var e=""+o;
while(e.length<t){
e="0"+e
}
return e
};
Com_Zimbra_Url.YOUTUBE_LINK_PATTERN1="youtube.com/watch?";
Com_Zimbra_Url.YOUTUBE_LINK_PATTERN2="youtube.com/v/";
Com_Zimbra_Url.YOUTUBE_LINK_PATTERN3="youtu.be/";
Com_Zimbra_Url.YOUTUBE_FEED="http://gdata.youtube.com/feeds/api/videos/@ID?alt=jsonc&v=2";
Com_Zimbra_Url.YOUTUBE_EMBED_URL="www.youtube.com/embed/";
Com_Zimbra_Url.YOUTUBE_DEFAULT_THUMBNAIL="http://img.youtube.com/vi/@ID.jpg";
Com_Zimbra_Url.PROTOCOL=location.protocol;
Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS=5;
Com_Zimbra_Url.prototype._getYouTubeFeed=function(){
for(var t in this._youTubeHash){
var e=Com_Zimbra_Url.YOUTUBE_FEED;
e=e.replace("@ID",t);
e=ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(e);
var o={
url:e,callback:new AjxCallback(this,this._parseYouTubeFeed,[t])};
AjxLoader.load(o)
}};
Com_Zimbra_Url.prototype._parseYouTubeFeed=function(youTubeId,req){
if(req.status!=200){
var thumbnail=Com_Zimbra_Url.YOUTUBE_DEFAULT_THUMBNAIL.replace("@ID",youTubeId);
var title="";
this._youTubeHash[youTubeId]={
thumbnail:thumbnail,title:title};
this._buildYouTubeImageHtml(youTubeId)
}else{
var json=eval("("+req.responseText+")");
var thumbnail=json.data.thumbnail.sqDefault;
var title=json.data.title;
this._youTubeHash[youTubeId]={
thumbnail:thumbnail,title:title};
this._buildYouTubeImageHtml(youTubeId)
}};
Com_Zimbra_Url.prototype.getYouTubeId=function(o){
var n=null;
var t=o.indexOf(Com_Zimbra_Url.YOUTUBE_LINK_PATTERN1);
if(t!=-1){
var e=AjxStringUtil.parseQueryString(o);
if(e&&e.v){
n=e.v
}}else{
t=o.indexOf(Com_Zimbra_Url.YOUTUBE_LINK_PATTERN2);
if(t!=-1){
n=AjxStringUtil.trim(o.substring(t+Com_Zimbra_Url.YOUTUBE_LINK_PATTERN2.length))
}else{
t=o.indexOf(Com_Zimbra_Url.YOUTUBE_LINK_PATTERN3);
if(t!=-1){
n=AjxStringUtil.trim(o.substring(t+Com_Zimbra_Url.YOUTUBE_LINK_PATTERN3.length))
}}}
return n
};
Com_Zimbra_Url.prototype._showYouTubeVideo=function(o,n){
if(!o||!n){
return
}
var t=document.getElementById("youtube-video_"+this._viewId+"_"+n);
var e=document.getElementById("youtube-iframe_"+this._viewId+"_"+n);
if(t){
if(!Dwt.getVisible(t)){
t.innerHTML="<br/>"+this._showYouTubeEmbed(o,n);
Dwt.setVisible(t,true);
this._setYouTubeOpacity(o,n,true)
}else{
if(e&&e.src==Com_Zimbra_Url.PROTOCOL+"//www.youtube.com/embed/"+o){
Dwt.setVisible(t,false);
this._setYouTubeOpacity(o,n,false)
}else{
t.innerHTML="<br/>"+this._showYouTubeEmbed(o,n);
this._setYouTubeOpacity(o,n,true)
}}}};
Com_Zimbra_Url.prototype._showYouTubeEmbed=function(e,t){
return'<iframe id="youtube-iframe_'+this._viewId+"_"+t+'" class="youtube-player" type="text/html"width="640" height="385"src="'+Com_Zimbra_Url.PROTOCOL+"//"+Com_Zimbra_Url.YOUTUBE_EMBED_URL+e+'?autoplay=1&rel=0" frameborder="0"></iframe>'
};
Com_Zimbra_Url.prototype._showYouTubeThumbnail=function(e){
return"<div class='thumb-wrapper'><div class='play'></div><img src='"+this._youTubeHash[e].thumbnail+"' border='2'></div>"
};
Com_Zimbra_Url.prototype._getAllYouTubeLinks=function(l){
if(!l){
return null
}
var r=l.match(/(\b(((http | https)\:\/\/)?(www\.)?((youtube\.com\/watch\?v=)|(youtube\.com\/watch\?.*\&v=)|(youtube\.com\/v\/)|(youtu\.be\/))((-)?[0-9a-zA-Z_-]+)?(&\w+=\w+)*)\b)/gi);
var o={};
var t=0;
if(r){
for(var n=0;
n<r.length;
n++){
var e=this.getYouTubeId(r[n]);
if(!o.hasOwnProperty(e)){
o[e]=r[n];
t++
}}
if(t>Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS){
var s={};
var d=1;
for(var h in o){
if(d>Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS){
this._youTubeHitMax=true;
return s
}
s[h]=true;
d++
}
return s
}
return o
}
return null
};
Com_Zimbra_Url.prototype._buildYouTubeImageHtml=function(n){
if(!this._youTubeHash||!n||document.getElementById("YOUTUBE_"+n+"_"+this._viewId+"_"+this._msgId)){
return
}
var t=this._showYouTubeThumbnail(n);
var o=document.createElement("div");
o.className="youTubeImagePreview";
o.innerHTML=t;
o.id="YOUTUBE_"+n+"_"+this._viewId+"_"+this._msgId;
this._youTubeCtrlHash[this._msgId].getHtmlElement().appendChild(o);
this._youTubeCtrlHash[this._msgId].setData(o.id,{
youTubeId:n,msgId:this._msgId}
);
var s=document.getElementById("youtube_"+this._viewId+"_"+this._msgId);
var e=document.getElementById("youtube-video_"+this._viewId+"_"+this._msgId);
if(s&&e){
s.insertBefore(this._youTubeCtrlHash[this._msgId].getHtmlElement(),e);
Dwt.setVisible(s,true)
}};
Com_Zimbra_Url.prototype._onYouTubeClickListener=function(e){
if(e&&e.target&&e.target.parentNode&&e.target.parentNode.parentNode){
var n=e.target.parentNode.parentNode.id.replace("YOUTUBE_","");
n=n.replace("_"+this._viewId,"");
var t=n.substring(0,11);
var o=n.substring(12);
if(t&&o){
this._showYouTubeVideo(t,o)
}}};
Com_Zimbra_Url.prototype._onYouTubeMouseOver=function(e){
if(e&&e.target&&e.target.tagName.toLowerCase()=="img"){
e.target.style.border="2px solid white"
}};
Com_Zimbra_Url.prototype._onYouTubeMouseOut=function(e){
if(e&&e.target&&e.target.tagName.toLowerCase()=="img"){
e.target.style.border="2px solid"
}};
Com_Zimbra_Url.prototype._setYouTubeOpacity=function(o,n,t){
var e=document.getElementById("YOUTUBE_"+o+"_"+this._viewId+"_"+n);
if(e&&e.firstChild&&t){
e=e.firstChild;
e.style.opacity=0.4;
e.style.filter="alpha(opacity=40)";
for(var s in this._youTubeHash){
if(s!=o){
e=document.getElementById("YOUTUBE_"+s+"_"+this._viewId+"_"+n);
if(e&&e.firstChild){
e.firstChild.style.opacity="";
e.firstChild.style.filter=""
}}}}else{
if(e&&e.firstChild){
e=e.firstChild;
e.style.opacity="";
e.style.filter=""
}}};
Com_Zimbra_Url.prototype.onConvView=function(o,e,t){
this._isConv=true;
this.renderYouTube(o,t)
};
Com_Zimbra_Url.prototype.onMsgView=function(o,e,t){
this._isConv=false;
this.renderYouTube(o,t)
};
Com_Zimbra_Url.prototype.renderYouTube=function(o,r){
if(!this._youtubePreview||appCtxt.isChildWindow){
return
}
this._youTubeHitMax=false;
this._youTubeHash={};
this._youTubeCtrlHash={};
var m=r?r.getContent():"";
this._youTubeHash=m&&this._getAllYouTubeLinks(m);
if(!this._youTubeHash){
return
}
this._msgId=o.id;
this._viewId=appCtxt.getCurrentViewId();
var h=appCtxt.getCurrentView().getItemView();
var s=this._isConv?(h._msgViews&&h._msgViews[this._msgId]&&h._msgViews[this._msgId]._msgBodyDivId):h._msgBodyDivId;
var t=document.getElementById(s);
if(t){
var e=document.createElement("DIV");
e.className="video-panel";
e.id="youtube_"+this._viewId+"_"+this._msgId;
e.style.display="none";
var l=this.getMessage("youTubeTitle");
if(this._youTubeHitMax){
l=this.getMessage("youTubeTitleMax").replace("{0}",Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS)
}
e.innerHTML="<h3 class='user_font_"+appCtxt.get(ZmSetting.FONT_NAME)+"'>"+l+"</h3>";
var u=document.createElement("div");
u.style.padding="5px";
t.appendChild(u);
t.appendChild(e);
var d=document.createElement("div");
d.id="youtube-video_"+this._viewId+"_"+this._msgId;
d.style.display="none";
d.className="movie-player";
e.appendChild(d);
this._getYouTubeFeed();
var n=new DwtControl({
parent:appCtxt.getShell()}
);
n.addListener(DwtEvent.ONMOUSEDOWN,this._onYouTubeClickListener.bind(this));
n.addListener(DwtEvent.ONMOUSEOVER,this._onYouTubeMouseOver.bind(this));
n.addListener(DwtEvent.ONMOUSEOUT,this._onYouTubeMouseOut.bind(this));
n.reparentHtmlElement(d);
this._youTubeCtrlHash[this._msgId]=n
}};
Com_Zimbra_Url.CALENDAR_URL_EXTENSION="ics";
Com_Zimbra_Url.prototype.getActionMenu=function(n,t,e){
var o=AjxStringUtil.parseURL(n),r=o.fileName,s=r?r.substring(r.lastIndexOf(".")+1):"";
if(!appCtxt.get(ZmApp.SETTING[ZmId.APP_CALENDAR])||s!=Com_Zimbra_Url.CALENDAR_URL_EXTENSION){
return false
}
if(this._zimletContext._contentActionMenu instanceof AjxCallback){
this._zimletContext._contentActionMenu=this._zimletContext._contentActionMenu.run()
}
Com_Zimbra_Url._actionObject=n;
Com_Zimbra_Url._actionSpan=t;
Com_Zimbra_Url._actionContext=e;
return this._zimletContext._contentActionMenu
};
Com_Zimbra_Url.prototype.menuItemSelected=function(t,e){
switch(t){
case"NEWCAL":this._newCalListener(e);
break;
case"GOTOURL":this._goToUrlListener();
break
}};
Com_Zimbra_Url.prototype._goToUrlListener=function(){
window.open(Com_Zimbra_Url._actionObject,"_blank")
};
Com_Zimbra_Url.prototype.getMainWindow=function(e){
return appCtxt.isChildWindow?window.opener:window
};
Com_Zimbra_Url.prototype._newCalListener=function(o){
AjxDispatcher.require(["CalendarCore","Calendar"]);
var e=appCtxt.getOverviewController();
var s=e.getTreeController(ZmOrganizer.CALENDAR);
var n={
url:Com_Zimbra_Url._actionObject};
s._newListener(o);
var t=appCtxt.getNewCalendarDialog();
t.setICalData(n)
};
Com_Zimbra_Date=function(e){
if(arguments.length==1){
this._generateRegex(e)
}};
Com_Zimbra_Date.prototype=new ZmZimletBase();
Com_Zimbra_Date.prototype.constructor=Com_Zimbra_Date;
Com_Zimbra_Date.prototype.TYPE=ZmObjectManager.DATE;
Com_Zimbra_Date.validate=function(e,n,t){
if(e<1||e>31){
return false
}
if(n<0||n>11){
return false
}
if((n==3||n==5||n==8||n==10)&&e==31){
return false
}
if(t&&n==1){
var o=(t%4==0&&(t%100!=0||t%400==0));
if(e>29||(e==29&&!o)){
return false
}}
return true
};
Com_Zimbra_Date.prototype.getCurrentDate=function(e){
var t=this[ZmObjectManager.ATTR_CURRENT_DATE];
return t?t:new Date()
};
Com_Zimbra_Date.prototype.init=function(){
Com_Zimbra_Date.prototype._zimletContext=this._zimletContext;
Com_Zimbra_Date.prototype._className="Object";
this._initDateObjectHandlers()
};
Com_Zimbra_Date.prototype.getActionMenu=function(o,t,e){
if(this._zimletContext._contentActionMenu instanceof AjxCallback){
this._zimletContext._contentActionMenu=this._zimletContext._contentActionMenu.run()
}
Com_Zimbra_Date._actionObject=o;
Com_Zimbra_Date._actionSpan=t;
Com_Zimbra_Date._actionContext=e;
return this._zimletContext._contentActionMenu
};
Com_Zimbra_Date.prototype.menuItemSelected=function(e){
switch(e){
case"DAYVIEW":this.showDayView(Com_Zimbra_Date._actionContext.date);
break;
case"NEWAPPT":this._newApptListener();
break;
case"SEARCHMAIL":this._searchMailListener();
break
}};
Com_Zimbra_Date.prototype.toolTipPoppedUp=function(o,n,t,e){
var s=this.getAppInMainWindow(ZmApp.CALENDAR);
if(!s){
return
}
e.innerHTML=s.getDateToolTip(t?t.date:new Date())
};
Com_Zimbra_Date.prototype.getMainWindow=function(e){
return appCtxt.isChildWindow?window.opener:window
};
Com_Zimbra_Date.prototype.getAppInMainWindow=function(o){
var t=this.getMainWindow();
if(!t){
return null
}
var e=t.appCtxt;
if(!e){
return null
}
return e.getApp(o)
};
Com_Zimbra_Date.prototype.clicked=function(o,n,t,e){
this.showDayView(t.date)
};
Com_Zimbra_Date.prototype.showDayView=function(e){
var t=this.getAppInMainWindow(ZmApp.CALENDAR);
if(!t){
return
}
t.showDayView(e);
if(appCtxt.isChildWindow){
window.opener.focus()
}};
Com_Zimbra_Date.prototype.match=function(g,f){
if(!Com_Zimbra_Date.PATTERNS){
return null
}
var r,t,d,p,n,s;
for(s=0;
s<Com_Zimbra_Date.REGEXES.length;
s++){
p=Com_Zimbra_Date.REGEXES[s];
p.lastIndex=f;
n=p.exec(g);
if(n&&n[0]&&(!r||n[0].length>r[0].length)){
r=n;
d=Com_Zimbra_Date.RULES[s];
t=p.mapping;
break
}}
if(!r){
return null
}
try{
var h,u;
for(s in t){
h=t[s];
u=r[s];
d=d.replace(new RegExp("\\{"+h+"\\}","gi"),u)
}
var o=new Date(this.getCurrentDate().getTime());
r.context={
rule:d,date:AjxDateUtil.calculate(d,o),monthOnly:0,valid:true};
return r
}
catch(l){
if(window.console&&window.console.log){
console.log(l)
}
return null
}};
Com_Zimbra_Date.prototype._initDateObjectHandlers=function(){
if(!appCtxt.get(ZmSetting.CALENDAR_ENABLED)){
return
}
Com_Zimbra_Date.MAPPINGS={
datenum:"(3[0-1]|0[1-9]|[1-9]|[1-2][0-9])",dayname:"("+AjxDateUtil.S_DAYNAME+")",weekord:"("+AjxDateUtil.S_WEEKORD+")",monthnum:"(0[1-9]|[1-9]|1[0-2])",monthname:"("+AjxDateUtil.S_MONTHNAME+")",yearnum:"(\\d{2}|[1-9]\\d{2,3})",fullyearnum:"(\\d{4})",number:"(\\d+)",timenum:"(1[0-2]:?[0-5][0-9]|[1-9]:?[0-5][0-9]|1[0-2]|[1-9])",militarytimenum:"(2[0-3]:?[0-5][0-9]|[0-1][0-9]:?[0-5][0-9])"};
Com_Zimbra_Date.PATTERNS=[];
Com_Zimbra_Date.RULES=[];
Com_Zimbra_Date.REGEXES=[];
var o,s;
for(o=1;
s=this.getMessage("format"+o+".pattern");
o++){
if(s.match(/^\?\?\?+/)){
break
}
if(s.match(/^###+/)){
break
}
if(s.match(/^#/)){
continue
}
Com_Zimbra_Date.PATTERNS.push(s);
Com_Zimbra_Date.RULES.push(this.getMessage("format"+o+".rule"))
}
for(o=0;
o<Com_Zimbra_Date.DEFAULT_FORMATS.length;
o++){
Com_Zimbra_Date.PATTERNS.push(Com_Zimbra_Date.DEFAULT_FORMATS[o]);
Com_Zimbra_Date.RULES.push(Com_Zimbra_Date.DEFAULT_FORMATS[++o])
}
var t=this.getMessage("boundaryTrue");
var r,n;
var e=this.getMessage("format.boundary")||t;
for(o=0;
o<Com_Zimbra_Date.PATTERNS.length;
o++){
s=Com_Zimbra_Date.PATTERNS[o];
s=s.replace(/\s+/g,"\\s+");
s=s.replace(/\(([^\)]+)\)/g,"(?:$1)");
Com_Zimbra_Date.__replaceKeyword_group=1;
Com_Zimbra_Date.__replaceKeyword_mapping={};
s=s.replace(/\{([a-z]+)\}/g,Com_Zimbra_Date.__replaceKeyword);
r=this.getMessage("format"+(o+1)+".boundary");
if((r!=""&&r==t)||e==t){
s="\\b"+s+"\\b"
}
n=new RegExp(s,"gi");
n.mapping=Com_Zimbra_Date.__replaceKeyword_mapping;
Com_Zimbra_Date.REGEXES.push(n)
}
ZmObjectManager.registerHandler(this,ZmObjectManager.DATE,this._zimletContext.priority)
};
Com_Zimbra_Date.prototype._newApptListener=function(){
var t=this.getMainWindow();
if(!t){
return
}
var e=new t.AjxCallback(this,this._handleLoadNewAppt);
t.AjxDispatcher.require(["CalendarCore","Calendar","CalendarAppt"],false,e,null,true)
};
Com_Zimbra_Date.prototype._handleLoadNewAppt=function(){
var e=this.getMainWindow();
if(!e){
return null
}
e.appCtxt.getAppViewMgr().popView(true,ZmId.VIEW_LOADING);
e.AjxDispatcher.run("GetCalController").newAppointmentHelper(Com_Zimbra_Date._actionContext.date);
if(appCtxt.isChildWindow){
window.opener.focus()
}};
Com_Zimbra_Date.prototype._searchMailListener=function(){
var e=this.getMainWindow(ZmApp.CALENDAR);
if(!e){
return
}
e.appCtxt.getSearchController().dateSearch(Com_Zimbra_Date._actionContext.date);
if(appCtxt.isChildWindow){
window.opener.focus()
}};
Com_Zimbra_Date.__replaceKeyword_mapping=null;
Com_Zimbra_Date.__replaceKeyword_group=-1;
Com_Zimbra_Date.__replaceKeyword=function(e,t){
var n=Com_Zimbra_Date.MAPPINGS;
t=t.toLowerCase();
if(!n[t]){
return e
}
var o=Com_Zimbra_Date.__replaceKeyword_mapping;
var s=Com_Zimbra_Date.__replaceKeyword_group++;
o[s++]=t;
return n[t]
};
Com_Zimbra_Date.DEFAULT_FORMATS=["Dante Mateo Comfort","2011-03-01T17:26:00Z","Brooke Ellen Henrikson","2009-10-17T10:20:00Z","Nicholas Mateo Damon","2008-07-18T17:35:00Z","Shyar Parag Shah","2008-07-16T04:51:00Z","Diego Isaac Comfort","2006-12-08T20:05:00Z","Nila Dharmaraj","2006-03-19T16:30:00Z","Nikhil Dharmaraj","2001-08-22T20:00:00Z"];
function Com_Zimbra_Phone(){}
Com_Zimbra_Phone.prototype=new ZmZimletBase();
Com_Zimbra_Phone.prototype.constructor=Com_Zimbra_Phone;
Com_Zimbra_Phone.PEOPLE_SEARCH_TOOLBAR_ID="phone";
Com_Zimbra_Phone.prototype._getHtmlContent=function(n,e,t,o){
var s=Com_Zimbra_Phone.getCallToLink(t);
n[e++]=['<a href="',s,'" onclick="window.top.Com_Zimbra_Phone.unsetOnbeforeunload()">',AjxStringUtil.htmlEncode(t),"</a>"].join("");
return e
};
Com_Zimbra_Phone.prototype.toolTipPoppedUp=function(n,s,t,e){
var o={
contentObjText:s,callStr:this.getMessage("call")};
e.innerHTML=AjxTemplate.expand("com_zimbra_phone.templates.Phone#Tooltip",o)
};
Com_Zimbra_Phone.prototype.menuItemSelected=function(e){
switch(e){
case"SEARCH":this._searchListener();
break;
case"ADDCONTACT":this._contactListener();
break;
case"CALL":this._callListener();
break
}};
Com_Zimbra_Phone.prototype.onPeopleSearchShow=function(n,e,s){
n._clearText(s+"-phone");
var o=e&&e.getAttr(ZmContact.F_workPhone);
if(o){
var t=new DwtText({
parent:appCtxt.getShell(),parentElement:s+"-phone",index:0,id:"NewCall",className:"FakeAnchor"}
);
t.isLinkText=true;
t.setText(o);
t.addListener(DwtEvent.ONMOUSEDOWN,new AjxListener(this,this._peopleSearchItemListener));
t.addListener(DwtEvent.ONMOUSEOVER,new AjxListener(this,n.peopleItemMouseOverListener));
t.addListener(DwtEvent.ONMOUSEOUT,new AjxListener(this,n.peopleItemMouseOutListener))
}};
Com_Zimbra_Phone.prototype._peopleSearchItemListener=function(o){
var t=o.target.innerHTML;
var e=Com_Zimbra_Phone.getCallToLink(t);
Com_Zimbra_Phone.unsetOnbeforeunload();
window.location=e
};
Com_Zimbra_Phone.prototype._searchListener=function(){
appCtxt.getSearchController().search({
query:this._actionObject}
)
};
Com_Zimbra_Phone.prototype._contactListener=function(){
var e=new ZmContact(null);
e.initFromPhone(this._actionObject,this.getConfig("defaultContactField"));
AjxDispatcher.run("GetContactController").show(e)
};
Com_Zimbra_Phone.prototype._callListener=function(){
var e=Com_Zimbra_Phone.getCallToLink(this._actionObject.toString());
Com_Zimbra_Phone.unsetOnbeforeunload();
window.location=e
};
Com_Zimbra_Phone.resetOnbeforeunload=function(){
window.onbeforeunload=ZmZimbraMail._confirmExitMethod
};
Com_Zimbra_Phone.unsetOnbeforeunload=function(){
window.onbeforeunload=null;
this._timerObj=new AjxTimedAction(null,Com_Zimbra_Phone.resetOnbeforeunload);
AjxTimedAction.scheduleAction(this._timerObj,3000)
};
Com_Zimbra_Phone.getCallToLink=function(t){
if(!t){
return""
}
var e=AjxStringUtil.trim(t,true);
if(!/^(?:\+|00)/.test(e)){
if(this.countryCode==1){
e="+1"+e
}}
return"callto:"+e
};
Com_Zimbra_Phone.prototype.match=function(o,s){
var n=this.RE;
n.lastIndex=s;
var e=n.exec(o);
if(!e){
return e
}
var t=e[0];
if(t.length>10&&t[0]!="+"&&!(AjxUtil.arrayContains(t," "))&&!(AjxUtil.arrayContains(t,"."))&&!(AjxUtil.arrayContains(t,"-"))){
return null
}else{
e[0]=t;
return e
}};
AjxTemplate.register("com_zimbra_phone.templates.Phone#Tooltip",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<table cellpadding=2 cellspacing=0 border=0><tr valign='center'><td>";
e[o++]=AjxImg.getImageHtml("Telephone");
e[o++]="</td><td><b><div style='white-space:nowrap'>";
e[o++]=s.callStr;
e[o++]="</div></b></td><td><div style='white-space:nowrap'>";
e[o++]=AjxStringUtil.htmlEncode(s.contentObjText);
e[o++]="</div></td></tr></table>";
return n?e.length:e.join("")
}
,{
id:"Tooltip"}
,true);
AjxPackage.define("com_zimbra_phone.templates.Phone");
AjxTemplate.register("com_zimbra_phone.templates.Phone",AjxTemplate.getTemplate("com_zimbra_phone.templates.Phone#Tooltip"),AjxTemplate.getParams("com_zimbra_phone.templates.Phone#Tooltip"));
function Com_Zimbra_YMEmoticons(){
this.re=Com_Zimbra_YMEmoticons.REGEXP;
this.hash=Com_Zimbra_YMEmoticons.SMILEYS;
this._isEnabled=true
}
Com_Zimbra_YMEmoticons.prototype=new ZmZimletBase;
Com_Zimbra_YMEmoticons.prototype.constructor=Com_Zimbra_YMEmoticons;
Com_Zimbra_YMEmoticons.prototype.createComposeButton=function(t){
var o=t.parent;
var e=new YMEmoticonsPickerButton({
parent:t,className:"ZToolbarButton"}
,true);
e.dontStealFocus();
e.setToolTipContent(ZmMsg.emoticons);
e.setEmoticon(":)");
e.addSelectionListener(new AjxListener(this,this._composeToolbarSmileyListener,[o]))
};
Com_Zimbra_YMEmoticons.prototype.on_htmlEditor_createToolbar2=function(t,e){
this.createComposeButton(e)
};
Com_Zimbra_YMEmoticons.prototype.onFindMsgObjects=function(t,e){
if(!this.enableInMail){
this.enableInMail=Boolean(this.getUserProperty("yemoticons_enableInMail"))
}
if(t&&t.folderId==ZmOrganizer.ID_CHATS){
e.addHandler(this);
e.sortHandlers();
e.__hasSmileysHandler=true
}else{
if(!e.__hasSmileysHandler&&this._isEnabled&&this.enableInMail){
e.addHandler(this);
e.sortHandlers();
e.__hasSmileysHandler=true
}
if(e.__hasSmileysHandler&&(!this._isEnabled||!this.enableInMail)){
e.removeHandler(this);
e.sortHandlers();
e.__hasSmileysHandler=false
}}};
Com_Zimbra_YMEmoticons.prototype.match=function(t,n){
this.re.lastIndex=n;
var e=this.re.exec(t);
if(e){
e.context=this.hash[e[1].toLowerCase()];
var o=new Image();
o.src=e.context.src;
e.context.img=o
}
return e
};
Com_Zimbra_YMEmoticons.prototype.generateSpan=function(o,e,r,s,t){
var n=t.height/2;
if(AjxEnv.isIE){
n="0px"
}
o[e++]=["<span style='height:",t.height,";width:",t.width,";padding:",n,"px ",t.width,"px ",n,"px 0; background:url(",t.img.src,") no-repeat 0 50%;'",' title="',AjxStringUtil.xmlAttrEncode(t.text)," - ",AjxStringUtil.xmlAttrEncode(t.alt),'"','><span style="visibility:hidden">a</span></span>'].join("");
return e
};
Com_Zimbra_YMEmoticons.prototype.onNewChatWidget=function(n){
var o=n.getObjectManager();
o.addHandler(this);
o.sortHandlers();
var e=n.getEditor().getBasicToolBar();
var t=new YMEmoticonsPickerButton({
parent:e,className:"ZToolbarButton",index:0}
);
t.dontStealFocus();
t.setToolTipContent(ZmMsg.emoticons);
t.setData(ZmLiteHtmlEditor._VALUE,ZmLiteHtmlEditor.SMILEY);
t.setEmoticon(":)");
t.addSelectionListener(new AjxListener(this,this._smileyListener,[n]));
e.addSeparator(null,1)
};
Com_Zimbra_YMEmoticons.prototype._smileyListener=function(t,e){
this._composeToolbarSmileyListener(t.getEditor(),e)
};
Com_Zimbra_YMEmoticons.prototype._composeToolbarSmileyListener=function(e,o){
if(!e){
return
}
var t=o.item.getSelectedSmiley();
if(t){
e.insertText(t.text);
e.focus()
}};
Com_Zimbra_YMEmoticons.prototype.menuItemSelected=function(e){
switch(e){
case"YE_TEMP_DISABLE":this.temporarilyDisable();
break;
case"YE_PREFERENCES":this._showPreferenceDlg();
break
}};
Com_Zimbra_YMEmoticons.prototype.doubleClicked=function(){
this.singleClicked()
};
Com_Zimbra_YMEmoticons.prototype.singleClicked=function(){
this._showPreferenceDlg()
};
Com_Zimbra_YMEmoticons.prototype.temporarilyDisable=function(){
this._isEnabled=false;
var e=[ZmToast.FADE_IN,ZmToast.PAUSE,ZmToast.FADE_OUT];
appCtxt.getAppController().setStatusMsg("Emoticons Temporarily Disabled",ZmStatusView.LEVEL_INFO,null,e)
};
Com_Zimbra_YMEmoticons.prototype._showPreferenceDlg=function(){
if(this._preferenceDialog){
this._preferenceDialog.popup();
return
}
this._preferenceView=new DwtComposite(this.getShell());
this._preferenceView.getHtmlElement().style.overflow="auto";
this._preferenceView.getHtmlElement().innerHTML=this._createPrefView();
this._preferenceDialog=this._createDialog({
title:"Yahoo! Emoticons Preferences",view:this._preferenceView,standardButtons:[DwtDialog.OK_BUTTON]}
);
this._preferenceDialog.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._okPreferenceBtnListener));
if(!this.enableInMail){
this.enableInMail=Boolean(this.getUserProperty("yemoticons_enableInMail"))
}
document.getElementById("yemoticons_enableInMail_div").checked=this.enableInMail;
this._preferenceDialog.popup()
};
Com_Zimbra_YMEmoticons.prototype._createPrefView=function(){
return["<div class='ymemoticonsPrefDialog'>","<input id='yemoticons_enableInMail_div' type='checkbox'/>Enable Emoticons In Mail","</div>"].join("")
};
Com_Zimbra_YMEmoticons.prototype._okPreferenceBtnListener=function(){
this._preferenceDialog.popdown();
var t=document.getElementById("yemoticons_enableInMail_div").checked;
if(t!=this.enableInMail){
this.setUserProperty("yemoticons_enableInMail",t,true);
this.enableInMail=t;
var e=t?"Enabled":"Disabled";
var o=[ZmToast.FADE_IN,ZmToast.PAUSE,ZmToast.FADE_OUT];
appCtxt.getAppController().setStatusMsg(["Emoticons ",e," In Mail"].join(""),ZmStatusView.LEVEL_INFO,null,o)
}};
Com_Zimbra_YMEmoticons.REGEXP=/(>:D<|#:-S|O:-\)|<:-P|:-SS|<\):\)|:-\?\?|3:-O|:\(\|\)|@};-|\*\*==|\(~~\)|\*-:\)|\[-O<|:\)>-|\\:D\x2f|\^:\)\^|;;\)|:-\x2f|:\x22>|:-\*|=\(\(|:-O|B-\)|:-S|>:\)|:\(\(|:\)\)|\x2f:\)|=\)\)|:-B|:-c|:\)\]|~X\(|:-h|:-t|8->|I-\)|8-\||L-\)|:-&|:-\$|\[-\(|:O\)|8-}|\(:\||=P~|:-\?|#-o|=D>|@-\)|:\^o|:-w|:-<|>:P|:o3|%-\(|:@\)|~:>|%%-|~O\)|8-X|=:\)|>-\)|:-L|\$-\)|:-\x22|b-\(|\[-X|>:\x2f|;\)\)|:-@|:-j|\(\*\)|o->|o=>|o-\+|\(%\)|:\)|:\(|;\)|:D|:x|:P|X\(|:>|:\||=;)/ig;
Com_Zimbra_YMEmoticons.SMILEYS={
":)":{
width:18,alt:"happy",src:"/service/zimlet/com_zimbra_ymemoticons/img/1.gif",text:":)",regexp:":\\)",height:18}
,":(":{
width:18,alt:"sad",src:"/service/zimlet/com_zimbra_ymemoticons/img/2.gif",text:":(",regexp:":\\(",height:18}
,"(~~)":{
width:17,alt:"pumpkin",src:"/service/zimlet/com_zimbra_ymemoticons/img/56.gif",text:"(~~)",regexp:"\\(~~\\)",height:18}
,"~o)":{
width:18,alt:"coffee",src:"/service/zimlet/com_zimbra_ymemoticons/img/57.gif",text:"~O)",regexp:"~O\\)",height:18}
,':">':{
width:18,alt:"blushing",src:"/service/zimlet/com_zimbra_ymemoticons/img/9.gif",text:':">',regexp:":\\x22>",height:18}
,"[-(":{
width:18,alt:"not talking",src:"/service/zimlet/com_zimbra_ymemoticons/img/33.gif",text:"[-(",regexp:"\\[-\\(",height:18}
,">:d<":{
width:42,alt:"big hug",src:"/service/zimlet/com_zimbra_ymemoticons/img/6.gif",text:">:D<",regexp:">:D<",height:18}
,"#-o":{
width:24,alt:"d'oh",src:"/service/zimlet/com_zimbra_ymemoticons/img/40.gif",text:"#-o",regexp:"#-o",height:18}
,"[-x":{
width:22,alt:"shame on you",src:"/service/zimlet/com_zimbra_ymemoticons/img/68.gif",text:"[-X",regexp:"\\[-X",height:18}
,":-t":{
width:30,alt:"time out",src:"/service/zimlet/com_zimbra_ymemoticons/img/104.gif",text:":-t",regexp:":-t",height:18}
,":(|)":{
width:21,alt:"monkey",src:"/service/zimlet/com_zimbra_ymemoticons/img/51.gif",text:":(|)",regexp:":\\(\\|\\)",height:18}
,":o)":{
width:28,alt:"clown",src:"/service/zimlet/com_zimbra_ymemoticons/img/34.gif",text:":O)",regexp:":O\\)",height:18}
,"i-)":{
width:21,alt:"sleepy",src:"/service/zimlet/com_zimbra_ymemoticons/img/28.gif",text:"I-)",regexp:"I-\\)",height:18}
,";;)":{
width:18,alt:"batting eyelashes",src:"/service/zimlet/com_zimbra_ymemoticons/img/5.gif",text:";;)",regexp:";;\\)",height:18}
,":^o":{
width:18,alt:"liar",src:"/service/zimlet/com_zimbra_ymemoticons/img/44.gif",text:":^o",regexp:":\\^o",height:18}
,"<:-p":{
width:38,alt:"party",src:"/service/zimlet/com_zimbra_ymemoticons/img/36.gif",text:"<:-P",regexp:"<:-P",height:18}
,"x(":{
width:34,alt:"angry",src:"/service/zimlet/com_zimbra_ymemoticons/img/14.gif",text:"X(",regexp:"X\\(",height:18}
,":-/":{
width:20,alt:"confused",src:"/service/zimlet/com_zimbra_ymemoticons/img/7.gif",text:":-/",regexp:":-\\x2f",height:18}
,"#:-s":{
width:34,alt:"whew!",src:"/service/zimlet/com_zimbra_ymemoticons/img/18.gif",text:"#:-S",regexp:"#:-S",height:18}
,"8->":{
width:23,alt:"daydreaming",src:"/service/zimlet/com_zimbra_ymemoticons/img/105.gif",text:"8->",regexp:"8->",height:18}
,":d":{
width:18,alt:"big grin",src:"/service/zimlet/com_zimbra_ymemoticons/img/4.gif",text:":D",regexp:":D",height:18}
,"\\:d/":{
width:26,alt:"dancing",src:"/service/zimlet/com_zimbra_ymemoticons/img/69.gif",text:"\\:D/",regexp:"\\\\:D\\x2f",height:18}
,":-b":{
width:24,alt:"nerd",src:"/service/zimlet/com_zimbra_ymemoticons/img/26.gif",text:":-B",regexp:":-B",height:18}
,":-@":{
width:36,alt:"chatterbox",src:"/service/zimlet/com_zimbra_ymemoticons/img/76.gif",text:":-@",regexp:":-@",height:18}
,":-h":{
width:28,alt:"wave",src:"/service/zimlet/com_zimbra_ymemoticons/img/103.gif",text:":-h",regexp:":-h",height:18}
,":-c":{
width:28,alt:"call me",src:"/service/zimlet/com_zimbra_ymemoticons/img/101.gif",text:":-c",regexp:":-c",height:18}
,"=p~":{
width:18,alt:"drooling",src:"/service/zimlet/com_zimbra_ymemoticons/img/38.gif",text:"=P~",regexp:"=P~",height:18}
,"(:|":{
width:18,alt:"yawn",src:"/service/zimlet/com_zimbra_ymemoticons/img/37.gif",text:"(:|",regexp:"\\(:\\|",height:18}
,":-o":{
width:18,alt:"surprise",src:"/service/zimlet/com_zimbra_ymemoticons/img/13.gif",text:":-O",regexp:":-O",height:18}
,"o->":{
width:18,alt:"hiro",src:"/service/zimlet/com_zimbra_ymemoticons/img/72.gif",text:"o->",regexp:"o->",height:18}
,":))":{
width:18,alt:"laughing",src:"/service/zimlet/com_zimbra_ymemoticons/img/21.gif",text:":))",regexp:":\\)\\)",height:18}
,"/:)":{
width:18,alt:"raised eyebrow",src:"/service/zimlet/com_zimbra_ymemoticons/img/23.gif",text:"/:)",regexp:"\\x2f:\\)",height:18}
,"*-:)":{
width:30,alt:"idea",src:"/service/zimlet/com_zimbra_ymemoticons/img/58.gif",text:"*-:)",regexp:"\\*-:\\)",height:18}
,":)]":{
width:31,alt:"on the phone",src:"/service/zimlet/com_zimbra_ymemoticons/img/100.gif",text:":)]",regexp:":\\)\\]",height:18}
,":-ss":{
width:36,alt:"nailbiting",src:"/service/zimlet/com_zimbra_ymemoticons/img/42.gif",text:":-SS",regexp:":-SS",height:18}
,"(%)":{
width:18,alt:"yin yang",src:"/service/zimlet/com_zimbra_ymemoticons/img/75.gif",text:"(%)",regexp:"\\(%\\)",height:18}
,":-*":{
width:18,alt:"kiss",src:"/service/zimlet/com_zimbra_ymemoticons/img/11.gif",text:":-*",regexp:":-\\*",height:18}
,"~x(":{
width:44,alt:"at wits' end",src:"/service/zimlet/com_zimbra_ymemoticons/img/102.gif",text:"~X(",regexp:"~X\\(",height:18}
,"o=>":{
width:18,alt:"billy",src:"/service/zimlet/com_zimbra_ymemoticons/img/73.gif",text:"o=>",regexp:"o=>",height:18}
,":-??":{
width:40,alt:"I don't know",src:"/service/zimlet/com_zimbra_ymemoticons/img/106.gif",text:":-??",regexp:":-\\?\\?",height:18}
,"@-)":{
width:18,alt:"hypnotized",src:"/service/zimlet/com_zimbra_ymemoticons/img/43.gif",text:"@-)",regexp:"@-\\)",height:18}
,"3:-o":{
width:18,alt:"cow",src:"/service/zimlet/com_zimbra_ymemoticons/img/50.gif",text:"3:-O",regexp:"3:-O",height:18}
,"=d>":{
width:18,alt:"applause",src:"/service/zimlet/com_zimbra_ymemoticons/img/41.gif",text:"=D>",regexp:"=D>",height:18}
,":-w":{
width:23,alt:"waiting",src:"/service/zimlet/com_zimbra_ymemoticons/img/45.gif",text:":-w",regexp:":-w",height:18}
,":x":{
width:18,alt:"love struck",src:"/service/zimlet/com_zimbra_ymemoticons/img/8.gif",text:":x",regexp:":x",height:18}
,":-$":{
width:18,alt:"don't tell anyone",src:"/service/zimlet/com_zimbra_ymemoticons/img/32.gif",text:":-$",regexp:":-\\$",height:18}
,"~:>":{
width:18,alt:"chicken",src:"/service/zimlet/com_zimbra_ymemoticons/img/52.gif",text:"~:>",regexp:"~:>",height:18}
,"=:)":{
width:20,alt:"bug",src:"/service/zimlet/com_zimbra_ymemoticons/img/60.gif",text:"=:)",regexp:"=:\\)",height:18}
,"(*)":{
width:18,alt:"star",src:"/service/zimlet/com_zimbra_ymemoticons/img/79.gif",text:"(*)",regexp:"\\(\\*\\)",height:18}
,":|":{
width:18,alt:"straight face",src:"/service/zimlet/com_zimbra_ymemoticons/img/22.gif",text:":|",regexp:":\\|",height:18}
,":((":{
width:22,alt:"crying",src:"/service/zimlet/com_zimbra_ymemoticons/img/20.gif",text:":((",regexp:":\\(\\(",height:18}
,"8-x":{
width:18,alt:"skull",src:"/service/zimlet/com_zimbra_ymemoticons/img/59.gif",text:"8-X",regexp:"8-X",height:18}
,"o:-)":{
width:30,alt:"angel",src:"/service/zimlet/com_zimbra_ymemoticons/img/25.gif",text:"O:-)",regexp:"O:-\\)",height:18}
,">:p":{
width:18,alt:"phbbbbt",src:"/service/zimlet/com_zimbra_ymemoticons/img/47.gif",text:">:P",regexp:">:P",height:18}
,">-)":{
width:18,alt:"alien",src:"/service/zimlet/com_zimbra_ymemoticons/img/61.gif",text:">-)",regexp:">-\\)",height:18}
,"=((":{
width:18,alt:"broken heart",src:"/service/zimlet/com_zimbra_ymemoticons/img/12.gif",text:"=((",regexp:"=\\(\\(",height:18}
,"l-)":{
width:24,alt:"loser",src:"/service/zimlet/com_zimbra_ymemoticons/img/30.gif",text:"L-)",regexp:"L-\\)",height:18}
,":@)":{
width:18,alt:"pig",src:"/service/zimlet/com_zimbra_ymemoticons/img/49.gif",text:":@)",regexp:":@\\)",height:18}
,">:/":{
width:23,alt:"bring it on",src:"/service/zimlet/com_zimbra_ymemoticons/img/70.gif",text:">:/",regexp:">:\\x2f",height:18}
,"b-(":{
width:18,alt:"feeling beat up",src:"/service/zimlet/com_zimbra_ymemoticons/img/66.gif",text:"b-(",regexp:"b-\\(",height:18}
,"$-)":{
width:18,alt:"money eyes",src:"/service/zimlet/com_zimbra_ymemoticons/img/64.gif",text:"$-)",regexp:"\\$-\\)",height:18}
,":-?":{
width:18,alt:"thinking",src:"/service/zimlet/com_zimbra_ymemoticons/img/39.gif",text:":-?",regexp:":-\\?",height:18}
,":)>-":{
width:22,alt:"peace sign",src:"/service/zimlet/com_zimbra_ymemoticons/img/67.gif",text:":)>-",regexp:":\\)>-",height:18}
,":-j":{
width:26,alt:"oh go on",src:"/service/zimlet/com_zimbra_ymemoticons/img/78.gif",text:":-j",regexp:":-j",height:18}
,"%%-":{
width:18,alt:"good luck",src:"/service/zimlet/com_zimbra_ymemoticons/img/54.gif",text:"%%-",regexp:"%%-",height:18}
,"%-(":{
width:52,alt:"not listening",src:"/service/zimlet/com_zimbra_ymemoticons/img/107.gif",text:"%-(",regexp:"%-\\(",height:18}
,":p":{
width:18,alt:"tongue",src:"/service/zimlet/com_zimbra_ymemoticons/img/10.gif",text:":P",regexp:":P",height:18}
,"^:)^":{
width:32,alt:"not worthy",src:"/service/zimlet/com_zimbra_ymemoticons/img/77.gif",text:"^:)^",regexp:"\\^:\\)\\^",height:18}
,':-"':{
width:22,alt:"whistling",src:"/service/zimlet/com_zimbra_ymemoticons/img/65.gif",text:':-"',regexp:":-\\x22",height:18}
,":-<":{
width:24,alt:"sigh",src:"/service/zimlet/com_zimbra_ymemoticons/img/46.gif",text:":-<",regexp:":-<",height:18}
,":o3":{
width:31,alt:"puppy dog eyes",src:"/service/zimlet/com_zimbra_ymemoticons/img/108.gif",text:":o3",regexp:":o3",height:18}
,">:)":{
width:18,alt:"devil",src:"/service/zimlet/com_zimbra_ymemoticons/img/19.gif",text:">:)",regexp:">:\\)",height:18}
,"=;":{
width:18,alt:"talk to the hand",src:"/service/zimlet/com_zimbra_ymemoticons/img/27.gif",text:"=;",regexp:"=;",height:18}
,"8-|":{
width:18,alt:"rolling eyes",src:"/service/zimlet/com_zimbra_ymemoticons/img/29.gif",text:"8-|",regexp:"8-\\|",height:18}
,"**==":{
width:25,alt:"flag",src:"/service/zimlet/com_zimbra_ymemoticons/img/55.gif",text:"**==",regexp:"\\*\\*==",height:18}
,"o-+":{
width:18,alt:"april",src:"/service/zimlet/com_zimbra_ymemoticons/img/74.gif",text:"o-+",regexp:"o-+",height:18}
,"8-}":{
width:24,alt:"silly",src:"/service/zimlet/com_zimbra_ymemoticons/img/35.gif",text:"8-}",regexp:"8-}",height:18}
,"=))":{
width:30,alt:"rolling on the floor",src:"/service/zimlet/com_zimbra_ymemoticons/img/24.gif",text:"=))",regexp:"=\\)\\)",height:18}
,":-l":{
width:18,alt:"frustrated",src:"/service/zimlet/com_zimbra_ymemoticons/img/62.gif",text:":-L",regexp:":-L",height:18}
,"b-)":{
width:18,alt:"cool",src:"/service/zimlet/com_zimbra_ymemoticons/img/16.gif",text:"B-)",regexp:"B-\\)",height:18}
,";)":{
width:18,alt:"winking",src:"/service/zimlet/com_zimbra_ymemoticons/img/3.gif",text:";)",regexp:";\\)",height:18}
,":>":{
width:18,alt:"smug",src:"/service/zimlet/com_zimbra_ymemoticons/img/15.gif",text:":>",regexp:":>",height:18}
,":-&":{
width:18,alt:"sick",src:"/service/zimlet/com_zimbra_ymemoticons/img/31.gif",text:":-&",regexp:":-&",height:18}
,"<):)":{
width:18,alt:"cowboy",src:"/service/zimlet/com_zimbra_ymemoticons/img/48.gif",text:"<):)",regexp:"<\\):\\)",height:18}
,":-s":{
width:18,alt:"worried",src:"/service/zimlet/com_zimbra_ymemoticons/img/17.gif",text:":-S",regexp:":-S",height:18}
,";))":{
width:18,alt:"hee hee",src:"/service/zimlet/com_zimbra_ymemoticons/img/71.gif",text:";))",regexp:";\\)\\)",height:18}
,"[-o<":{
width:18,alt:"praying",src:"/service/zimlet/com_zimbra_ymemoticons/img/63.gif",text:"[-O<",regexp:"\\[-O<",height:18}
,"@};-":{
width:18,alt:"rose",src:"/service/zimlet/com_zimbra_ymemoticons/img/53.gif",text:"@};-",regexp:"@};-",height:18}};
YMEmoticonsPickerButton=function(t,e){
if(arguments.length==0){
return
}
t.actionTiming=DwtButton.ACTION_MOUSEUP;
DwtToolBarButton.call(this,t);
this.setEmoticon();
if(e&&e==true){
this.setMenu(new AjxCallback(this,this._createMenu),false,false,false)
}else{
this.setMenu(new AjxCallback(this,this._createMenu),false,false,true)
}};
YMEmoticonsPickerButton.prototype=new DwtToolBarButton;
YMEmoticonsPickerButton.prototype.constructor=YMEmoticonsPickerButton;
YMEmoticonsPickerButton.prototype._createMenu=function(){
var e=new DwtMenu({
parent:this,style:DwtMenu.GENERIC_WIDGET_STYLE}
);
this._picker=new YMEmoticonsPicker(e,null,null);
this._picker.addSelectionListener(new AjxListener(this,this._smileyPicked));
return e
};
YMEmoticonsPickerButton.prototype.setEmoticon=function(t){
var e=t?YMEmoticonsPicker.SMILEYS[t]:YMEmoticonsPicker.getDefaultSmiley();
if(e){
this._smileyButtonDiv.src=e.src;
this._smiley=e
}};
YMEmoticonsPickerButton.prototype._createHtmlFromTemplate=function(t,o){
DwtButton.prototype._createHtmlFromTemplate.call(this,t,o);
var n=Dwt.getNextId();
var e="<div unselectable><img width='18' src='' id='"+n+"_smiley'></div>";
this.setText(e);
this._smileyButtonDiv=document.getElementById(n+"_smiley");
delete n
};
YMEmoticonsPickerButton.prototype.getSmiley=function(e){
return this._picker.getSmiley(e)
};
YMEmoticonsPickerButton.prototype.getSelectedSmiley=function(){
return this._smiley
};
YMEmoticonsPickerButton.prototype._smileyPicked=function(e){
var o=e.detail;
this.setEmoticon(o);
if(this.isListenerRegistered(DwtEvent.SELECTION)){
var t=DwtShell.selectionEvent;
t.item=this;
this.notifyListeners(DwtEvent.SELECTION,t)
}};
YMEmoticonsPicker=function(o,t,e){
if(arguments.length==0){
return
}
t=t||"DwtColorPicker";
DwtControl.call(this,{
parent:o,className:t,posStyle:e}
);
this._createEmoticonsPicker(o)
};
YMEmoticonsPicker.prototype=new DwtControl;
YMEmoticonsPicker.prototype.constructor=YMEmoticonsPicker;
YMEmoticonsPicker.SMILEYS=Com_Zimbra_YMEmoticons.SMILEYS;
YMEmoticonsPicker.getDefaultSmiley=function(){
for(var e in YMEmoticonsPicker.SMILEYS){
return YMEmoticonsPicker.SMILEYS[e]
}
return null
};
YMEmoticonsPicker.prototype.getDefaultSmiley=YMEmoticonsPicker.getDefaultSmiley;
YMEmoticonsPicker.prototype._createEmoticonsPicker=function(e){
this._createEmoticonsTable();
this._registerHandlers()
};
YMEmoticonsPicker.prototype.addSelectionListener=function(e){
this.addListener(DwtEvent.SELECTION,e)
};
YMEmoticonsPicker.prototype.removeSelectionListener=function(e){
this.removeListener(DwtEvent.SELECTION,e)
};
YMEmoticonsPicker.prototype.dispose=function(){
if(this._disposed){
return
}
Dwt.disassociateElementFromObject(this.getHtmlElement().firstChild,this);
DwtControl.prototype.dispose.call(this)
};
YMEmoticonsPicker.prototype.getSmiley=function(e){
return YMEmoticonsPicker.SMILEYS[e]
};
YMEmoticonsPicker.EMOTICONS_PER_ROW=11;
YMEmoticonsPicker.prototype._createEmoticonsTable=function(){
var h=0;
var n=[];
var e=0;
var s=0;
var l=0;
var t=0;
var d=0;
for(var o in YMEmoticonsPicker.SMILEYS){
if(e!=0&&!(e%YMEmoticonsPicker.EMOTICONS_PER_ROW)){
n[h++]="</tr><tr>";
if(s>l){
l=s
}
s=0
}
t=YMEmoticonsPicker.SMILEYS[o].width;
d=YMEmoticonsPicker.SMILEYS[o].height;
n[h++]=['<td style=\'background-color:#FFFFFF;\' align="center" valign="middle" id=\'',o,"' >"].join("");
n[h++]=["<img  height='",d,"' width='",t,"' src='",YMEmoticonsPicker.SMILEYS[o].src,"'","  title='",YMEmoticonsPicker.SMILEYS[o].alt,"  ",YMEmoticonsPicker.SMILEYS[o].text,"'","  />"].join("");
n[h++]="</td>";
e++;
s=s+t
}
n[h++]="</table>";
var r=["<table  cellpadding='2' cellspacing='3' border='0' align='center' width='",l,"px'><tr>"].join("");
this.getHtmlElement().innerHTML=[r,n.join("")].join("");
if(AjxEnv.isFirefox1_5up&&!AjxEnv.isFirefox3up){
this.setSize("480px",Dwt.DEFAULT)
}};
YMEmoticonsPicker.prototype._registerHandlers=function(){
var r=this.getHtmlElement().firstChild;
Dwt.associateElementWithObject(r,this);
var h=r.rows;
var l=h.length;
for(var n=0;
n<l;
n++){
var o=h[n].cells;
var s=o.length;
for(var t=0;
t<s;
t++){
var e=o[t];
Dwt.setHandler(e,DwtEvent.ONMOUSEDOWN,YMEmoticonsPicker._mouseDownHdlr);
Dwt.setHandler(e,DwtEvent.ONMOUSEUP,YMEmoticonsPicker._mouseUpHdlr)
}}};
YMEmoticonsPicker._mouseDownHdlr=function(t){
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t,true);
var o=e.target;
if(o.nodeName.toLowerCase()=="img"){
o=o.parentNode
}
e.dwtObj._downTdId=o.id;
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
};
YMEmoticonsPicker._mouseUpHdlr=function(o){
var t=DwtShell.mouseEvent;
t.setFromDhtmlEvent(o,true);
var r=t.dwtObj;
var s=t.target;
if(s.nodeName.toLowerCase()=="img"){
s=s.parentNode
}
if(r._downTdId==s.id){
var e=YMEmoticonsPicker.SMILEYS[s.id];
if(e){
if(r.isListenerRegistered(DwtEvent.SELECTION)){
var n=DwtShell.selectionEvent;
DwtUiEvent.copy(n,t);
n.item=r;
n.detail=s.id;
r.notifyListeners(DwtEvent.SELECTION,n)
}}
if(r.parent instanceof DwtMenu){
DwtMenu.closeActiveMenu()
}}
t._stopPropagation=true;
t._returnValue=false;
t.setToDhtmlEvent(o);
return false
};
function com_zimbra_attachcontacts_HandlerObject(){}
com_zimbra_attachcontacts_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_attachcontacts_HandlerObject.prototype.constructor=com_zimbra_attachcontacts_HandlerObject;
var AttachContactsZimlet=com_zimbra_attachcontacts_HandlerObject;
AttachContactsZimlet.SEND_CONTACTS="SEND_CONTACTS_IN_EMAIL";
AttachContactsZimlet.prototype.init=function(){
this._op=ZmOperation.registerOp(AttachContactsZimlet.SEND_CONTACTS,{
image:"MsgStatusSent",text:this.getMessage("ACZ_Send"),tooltip:this.getMessage("ACZ_SendContactsAsAttachments")}
);
this._contactSendListener=new AjxListener(this,this._contactListSendListener);
this.overrideAPI(ZmListController.prototype,"_setContactText",this._setContactText);
this.setEmailActionMenu()
};
AttachContactsZimlet.prototype.initializeAttachPopup=function(o,e){
var t=e._createAttachMenuItem(o,ZmMsg.contacts,new AjxListener(this,this.showAttachmentDialog))
};
AttachContactsZimlet.prototype.removePrevAttDialogContent=function(t){
var e=t&&t.firstChild;
if(e&&e.className=="DwtComposite"){
t.removeChild(e)
}};
AttachContactsZimlet.prototype.showAttachmentDialog=function(){
var e=this._attachDialog=appCtxt.getAttachDialog();
e.setTitle(ZmMsg.attachContact);
this.removePrevAttDialogContent(e._getContentDiv().firstChild);
if(!this.AttachContactsView||!this.AttachContactsView.attachDialog){
this.AttachContactsView=new AttachContactsTabView(this._attachDialog,this)
}
this.AttachContactsView.reparentHtmlElement(e._getContentDiv().childNodes[0],0);
this.AttachContactsView.attachDialog=e;
e.setOkListener(new AjxCallback(this,this._okListener));
this.AttachContactsView.attachDialog.popup();
this.AttachContactsView.attachDialog.enableInlineOption(this._composeMode==DwtHtmlEditor.HTML);
this._addedToMainWindow=true
};
AttachContactsZimlet.prototype.onShowView=function(t){
var e=appCtxt.getViewTypeFromId(t);
if(e==ZmId.VIEW_CONTACT_SIMPLE){
this._addContactActionMenuItem()
}};
AttachContactsZimlet.prototype._okListener=function(){
this.AttachContactsView.uploadFiles();
this.AttachContactsView.setClosed(true);
this.AttachContactsView.attachDialog.popdown()
};
AttachContactsZimlet.prototype.addExtraMsgParts=function(o,e){
if(!e||!this._isDraftInitiatedByThisZimlet){
return
}
if(o&&o.m){
if(!o.m.attach){
o.m.attach={};
o.m.attach.cn=[]
}else{
if(!o.m.attach.cn){
o.m.attach.cn=[]
}}
var s=this.contactIdsToAttach;
if(s){
for(var t=0;
t<s.length;
t++){
var n=s[t];
if(appCtxt.multiAccounts&&s[t].indexOf(":")==-1){
n=[appCtxt.getActiveAccount().id,":",s[t]].join("")
}
o.m.attach.cn.push({
id:n}
)
}}}
this._isDraftInitiatedByThisZimlet=false
};
AttachContactsZimlet.prototype._initContactsReminderToolbar=function(n,e){
var s=AttachContactsZimlet.SEND_CONTACTS;
if(n.getButton(s)||!this._isOkayToAttach()){
return
}
var o=AjxUtil.hashCopy(ZmOperation.SETUP[s]);
o.text=this.getMessage("ACZ_Send");
var t=n.createZimletOp(s,o);
t.addSelectionListener(this._contactSendListener)
};
AttachContactsZimlet.prototype.resetToolbarOperations=function(t,e){
if(t.getOp(AttachContactsZimlet.SEND_CONTACTS)){
t.enable(AttachContactsZimlet.SEND_CONTACTS,e>0&&this._isOkayToAttach())
}};
AttachContactsZimlet.prototype._isOkayToAttach=function(){
this._getContactListIds();
return this.contactIdsToAttach&&this.contactIdsToAttach.length>0
};
AttachContactsZimlet.prototype._contactListSendListener=function(){
this._getContactListIds();
if(this.contactIdsToAttach&&this.contactIdsToAttach.length){
this._openCompose()
}};
AttachContactsZimlet.prototype._getContactListIds=function(){
var t=appCtxt.getApp(ZmApp.CONTACTS).getContactListController();
this.contactIdsToAttach=[];
var e=t.getListView();
if(e){
var o=e.getSelection();
for(var n=0;
n<o.length;
n++){
if(!o[n].isGroup()){
this.contactIdsToAttach.push(o[n].id)
}}}
return this.contactIdsToAttach
};
AttachContactsZimlet.prototype._openCompose=function(){
var t=ZmOperation.NEW_MESSAGE;
var o=new ZmMailMsg();
AjxDispatcher.run("Compose",{
action:t,inNewWindow:false,msg:o}
);
var e=appCtxt.getApp(ZmApp.MAIL).getComposeController(appCtxt.getApp(ZmApp.MAIL).getCurrentSessionId(ZmId.VIEW_COMPOSE));
this._isDraftInitiatedByThisZimlet=true;
e.saveDraft(ZmComposeController.DRAFT_TYPE_AUTO)
};
AttachContactsZimlet.prototype._setContactText=function(e){
if(this._participantActionMenu){
this._participantActionMenu.enable(AttachContactsZimlet.SEND_CONTACTS,e)
}
arguments.callee.func.apply(this,arguments)
};
AttachContactsZimlet.prototype.onParticipantActionMenuInitialized=function(e,t){
this.onActionMenuInitialized(e,t)
};
AttachContactsZimlet.prototype.onActionMenuInitialized=function(e,t){
this.addMenuButton(new AjxCallback(this,this._getContactFromController,[e]),t,ZmOperation.CONTACT)
};
AttachContactsZimlet.prototype._addContactActionMenuItem=function(){
var e=appCtxt.getApp(ZmApp.CONTACTS).getContactListController();
this.addMenuButton(new AjxCallback(this,this._getContactFromController,[e]),e.getActionMenu(),ZmOperation.CONTACT)
};
AttachContactsZimlet.prototype._getContactFromController=function(t){
if(t){
if(t instanceof ZmContactListController){
var e=t.getListView();
if(e){
var o=e.getSelection();
if(o&&o.length>1){
return o
}}}
return(t&&t._actionEv&&t._actionEv.contact)||null
}};
AttachContactsZimlet.prototype.addMenuButton=function(e,r,s){
if(e&&r&&!r.getMenuItem(AttachContactsZimlet.SEND_CONTACTS)){
var t=null;
if(AjxUtil.isString(s)){
var n=r.getMenuItem(s);
if(n){
for(t=0,c=r.getChildren();
t<c.length&&c[t]!==n;
t++){}}}else{
if(AjxUtil.isNumber(s)){
t=s
}}
if(!s||t!==null){
var h={
id:AttachContactsZimlet.SEND_CONTACTS,text:this.getMessage("ACZ_SendContact"),image:"MsgStatusSent"};
if(t!==null){
h.index=t+1
}
var o=ZmOperation.defineOperation(null,h);
r.addOp(AttachContactsZimlet.SEND_CONTACTS);
r.addSelectionListener(AttachContactsZimlet.SEND_CONTACTS,new AjxListener(this,this._contactActionMenuListener,e))
}}};
AttachContactsZimlet.prototype._contactActionMenuListener=function(t,n){
var e=t.run();
if(e){
var s=AjxUtil.toArray(e);
if(s.length){
this.contactIdsToAttach=[];
for(var o=0;
o<s.length;
o++){
if(!s[o].isGroup()){
this.contactIdsToAttach.push(s[o].id)
}}
if(this.contactIdsToAttach.length>0){
this._openCompose()
}}}};
AttachContactsZimlet.prototype.overrideAPI=function(o,t,n){
n=n||this[t];
if(n){
var e=o[t];
o[t]=function(){
n.func=e;
return n.apply(this,arguments)
};
o[t].func=e
}};
AttachContactsZimlet.prototype.setEmailActionMenu=function(){
if(window.com_zimbra_email_handlerObject){
this.overrideAPI(com_zimbra_email_handlerObject.prototype,"getActionMenu",AjxCallback.simpleClosure(AttachContactsZimlet._getEmailActionMenu,null,this))
}};
AttachContactsZimlet._getEmailActionMenu=function(t){
var n=Array.prototype.slice.call(arguments,1);
var s=this.getActionMenu.func.apply(this,n);
var o=new AjxCallback(this,this._getActionedContact,[false]);
var e=o.run();
if(e&&!e.isGal&&e.id){
t.addMenuButton(o,s,"NEWCONTACT")
}else{
if(s.getOp(AttachContactsZimlet.SEND_CONTACTS)){
s.enable(AttachContactsZimlet.SEND_CONTACTS,false)
}}
return s
};
ACZimletNavToolBar=function(t){
t.className=t.className||"ACZimletNavToolBar";
var e=(t.hasText!==false);
t.buttons=this._getButtons(e);
t.toolbarType=ZmId.TB_NAV;
t.posStyle=t.posStyle||DwtControl.STATIC_STYLE;
ZmButtonToolBar.call(this,t);
if(e){
this._textButton=this.getButton(ZmOperation.TEXT)
}};
ACZimletNavToolBar.prototype=new ZmButtonToolBar;
ACZimletNavToolBar.prototype.constructor=ACZimletNavToolBar;
ACZimletNavToolBar.prototype.toString=function(){
return"ACZimletNavToolBar"
};
ACZimletNavToolBar.prototype._getButtons=function(e){
var t=[];
t.push(ZmOperation.PAGE_BACK);
if(e){
t.push(ZmOperation.TEXT)
}
t.push(ZmOperation.PAGE_FORWARD);
return t
};
ACZimletNavToolBar.prototype.createOp=function(t,e){
e.textClassName="ZWidgetTitle ACZimletNavToolBarTitle";
return ZmButtonToolBar.prototype.createOp.apply(this,arguments)
};
ACZimletNavToolBar.prototype.setText=function(e){
if(!this._textButton){
return
}
this._textButton.setText(e)
};
AttachContactsTabView=function(o,e,t){
this.zimlet=e;
DwtComposite.call(this,o,t,Dwt.STATIC_STYLE);
this._createHtml1();
this.closed=true
};
AttachContactsTabView.prototype=new DwtComposite;
AttachContactsTabView.prototype.constructor=AttachContactsTabView;
AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD="attDlg_attContact_SearchField";
AttachContactsTabView.ELEMENT_ID_SEARCH_BUTTON="attDlg_attContact_SearchBtn";
AttachContactsTabView.ELEMENT_ID_NAV_BUTTON_CELL="attDlg_attContact_NavBtnCell";
AttachContactsTabView.DEFAULT_CONTACTS_FOLDER="7";
AttachContactsTabView.GROUP_CUTOFF=6;
AttachContactsTabView.prototype.toString=function(){
return"AttachContactsTabView"
};
AttachContactsTabView.prototype.showMe=function(){
DwtTabViewPage.prototype.showMe.call(this);
var e=appCtxt.multiAccounts?appCtxt.getAppViewMgr().getCurrentView().getFromAccount():appCtxt.getActiveAccount();
if(appCtxt.multiAccounts){
appCtxt.accountList.setActiveAccount(e)
}
if(this.prevAccount&&(e.id==this.prevAccount.id)){
this.reset();
this.setSize(Dwt.DEFAULT,"295");
return
}
this.prevAccount=e;
this._createHtml1();
Dwt.byId(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this)
};
AttachContactsTabView.prototype.setClosed=function(e){
this._closed=(e!==false)
};
AttachContactsTabView.prototype._resetQuery=function(e){
if(this._currentQuery==undefined){
return e
}
if(this._currentQuery!=e){
this._offset=0;
this._currentQuery=e
}
return e
};
AttachContactsTabView.prototype._getQueryFromFolder=function(e){
return this._resetQuery('inid:"'+e+'"')
};
AttachContactsTabView.prototype.hideMe=function(){
DwtTabViewPage.prototype.hideMe.call(this)
};
AttachContactsTabView.prototype._createHtml1=function(){
this._tableID=Dwt.getNextId();
this._folderTreeCellId=Dwt.getNextId();
this._folderListId=Dwt.getNextId();
var o=[];
o.push("<table class='AttachContacts_table' width='100%' style='margin-bottom:5px;'>","<TR><td><INPUT type='text' id='",AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD,"'></INPUT></td>","<td width='80%' style='padding:0 2px'><SPAN id='",AttachContactsTabView.ELEMENT_ID_SEARCH_BUTTON,"' /></td>","<td><SPAN id='",AttachContactsTabView.ELEMENT_ID_NAV_BUTTON_CELL,"' /></td></TR></table>","<table width='100%'><tr><td valign='top' id='",this._folderTreeCellId,"'></td>","<td  valign='top'><div  id='",this._folderListId,"' ></div>","</td></tr></table>");
this.setContent(o.join(""));
var t=new DwtButton({
parent:this}
);
var e=this.zimlet.getMessage("ACZ_tab_button_search");
t.setText(e);
t.setImage("Contact");
t.setSize("140");
t.addSelectionListener(new AjxListener(this,this._searchButtonListener));
Dwt.byId(AttachContactsTabView.ELEMENT_ID_SEARCH_BUTTON).appendChild(t.getHtmlElement());
this._navigationContainer=new DwtComposite(appCtxt.getShell());
this._navTB=new ACZimletNavToolBar({
parent:this._navigationContainer}
);
var n=new AjxListener(this,this._navBarListener);
this._navTB.addSelectionListener(ZmOperation.PAGE_BACK,n);
this._navTB.addSelectionListener(ZmOperation.PAGE_FORWARD,n);
Dwt.byId(AttachContactsTabView.ELEMENT_ID_NAV_BUTTON_CELL).appendChild(this._navTB.getHtmlElement());
this.showAttachContactsTreeView();
Dwt.byId(this._folderListId);
Dwt.byId(this._folderListId).onclick=AjxCallback.simpleClosure(this._handleItemSelect,this)
};
AttachContactsTabView.prototype._handleItemSelect=function(n){
if(AjxEnv.isIE){
n=window.event
}
var o=DwtShell.mouseEvent;
o.setFromDhtmlEvent(n);
var e=o.target;
var r=true;
if(e.className=="ImgCheckboxunChecked"||e.className=="ImgCheckboxChecked"){
r=false
}
while(e&&(e.id.indexOf("attachContactsZimlet_row_")==-1)){
e=e.parentNode
}
if(!e){
return
}
this._resetRowSelection(r);
var s=e.id.replace("attachContactsZimlet_row_","");
var t=document.getElementById("attachContactsZimlet_checkbox_"+s);
if(t&&!r){
if(t.className=="ImgCheckboxunChecked"){
this._setCheckBoxSelection(t,true)
}else{
if(t.className=="ImgCheckboxChecked"){
this._setCheckBoxSelection(t,false)
}}}
if(e){
if(e.className.indexOf("Row-selected")>=0){
if(t.className!="ImgCheckboxChecked"){
this._setRowSelection(e,false);
this._selectedItemIds[s]=false
}}else{
this._setRowSelection(e,true);
this._selectedItemIds[s]=true
}}};
AttachContactsTabView.prototype._resetRowSelection=function(n){
for(var o in this._selectedItemIds){
var t=document.getElementById("attachContactsZimlet_checkbox_"+o);
var e=document.getElementById("attachContactsZimlet_row_"+o);
if(!n&&t&&t.className=="ImgCheckboxChecked"){
continue
}
this._setRowSelection(e,false);
this._setCheckBoxSelection(t,false);
if(this._selectedItemIds&&this._selectedItemIds[o]){
this._selectedItemIds[o]=false
}}};
AttachContactsTabView.prototype._setCheckBoxSelection=function(t,e){
if(!t){
return
}
if(!e){
t.className="ImgCheckboxunChecked"
}else{
t.className="ImgCheckboxChecked"
}};
AttachContactsTabView.prototype._setRowSelection=function(e,t){
if(!e){
return
}
if(!t){
e.className=AjxStringUtil.trim(e.className.replace("Row-selected",""))
}else{
if(e.className.indexOf("Row-selected")==-1){
e.className=e.className+" Row-selected"
}}};
AttachContactsTabView.prototype._searchButtonListener=function(e){
this.treeView.deselectAll();
var o=Dwt.byId(AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD).value;
if(o==""){
return
}
var t=this._resetQuery(o);
this.executeQuery(t)
};
AttachContactsTabView.prototype._navBarListener=function(e){
var t=e.item.getData(ZmOperation.KEY_ID);
this._paginate(t==ZmOperation.PAGE_FORWARD)
};
AttachContactsTabView.prototype._paginate=function(e){
this.executeQuery(this._currentQuery,e)
};
AttachContactsTabView.prototype.showResultContents=function(n){
this._checkboxIdAndItemIdMap=[];
this._selectedItemIds={};
var t=[];
var e={};
if(n.response&&n.response.SearchResponse&&n.response.SearchResponse.cn){
e=n.response.SearchResponse;
t=e.cn
}
this._navTB.enable(ZmOperation.PAGE_BACK,e.offset>0);
this._navTB.enable(ZmOperation.PAGE_FORWARD,e.more);
var o=t.length;
if(o==0){
this._navTB.setText("")
}else{
this._navTB.setText((this._offset+1)+"-"+(this._offset+o))
}
this._setListView(t)
};
AttachContactsTabView.prototype._setListView=function(g){
var d=[];
var b=0;
if(g.length==0){
if(!this._noContactsFoundStr){
this._noContactsFoundStr=["<div padding=5px>",this.zimlet.getMessage("ACZ_NoContactsFound"),"</div>"].join("")
}
d[b++]=this._noContactsFoundStr
}else{
var u=[ZmContact.EMAIL_FIELDS,ZmContact.PHONE_FIELDS,ZmContact.IM_FIELDS];
var w=true;
for(var h=0;
h<g.length;
h++){
var v=g[h];
var f;
try{
f=ZmContact.createFromDom(v,{}
)
}
catch(p){
continue
}
if(!f){
continue
}
var l=(w)?"RowOdd AttachContactRow":"RowEven AttachContactRow";
w=!w;
var s=[f.getAttr(ZmContact.F_firstName),f.getAttr(ZmContact.F_middleName),f.getAttr(ZmContact.F_lastName),f.getAttr(ZmContact.F_company)?"("+f.getAttr(ZmContact.F_company)+")":null];
var t=AjxUtil.collapseList(s).join(" ")||ZmContact.computeFileAs(f);
var m;
if(!f.isGroup()){
m=[];
for(var r=0;
r<u.length;
r++){
var n=this._getFirstWorkingAttr(f.getAttrs(),u[r]);
if(n){
m.push(n)
}}
var y="attachContactsZimlet_checkbox_"+v.id;
var o="attachContactsZimlet_row_"+v.id;
d[b++]="<div  class='";
d[b++]=l;
d[b++]="' id='";
d[b++]=o;
d[b++]="'>";
d[b++]="<table width=100%>";
d[b++]="<tr>";
d[b++]="<td width='1px'><div  id='";
d[b++]=y;
d[b++]="' class='ImgCheckboxunChecked'></div></td>";
d[b++]="<td width='1px'>";
d[b++]=AjxImg.getImageHtml(f.getIcon());
d[b++]="</td>";
d[b++]="<td width='98%'><span style=\"font-weight:bold;\">";
d[b++]=AjxStringUtil.htmlEncode(t||ZmMsg.noName);
d[b++]="</span></td></tr>";
for(var r=0;
r<m.length;
r++){
d[b++]="<tr><td></td><td colspan=3>";
d[b++]=AjxStringUtil.htmlEncode(m[r]);
d[b++]="</td></tr>"
}
d[b++]="</table></div>"
}}}
Dwt.setInnerHtml(Dwt.byId(this._folderListId),d.join(""))
};
AttachContactsTabView.prototype._getFirstWorkingAttr=function(s,t){
var o=[];
if(AjxUtil.isArray(t)){
for(var n=0;
n<t.length;
n++){
var e=this._getFirstWorkingAttr(s,t[n]);
if(e){
return e
}}}else{
if(AjxUtil.isString(t)){
if(s[t]){
return s[t]
}}}};
AttachContactsTabView.prototype._handleKeys=function(t){
var e=DwtKeyEvent.getCharCode(t);
return(e!=DwtKeyEvent.KEY_ENTER&&e!=DwtKeyEvent.KEY_END_OF_TEXT)
};
AttachContactsTabView.prototype.gotAttachments=function(){
return false
};
AttachContactsTabView.prototype._getSelectedItems=function(){
var e=[];
for(var t in this._selectedItemIds){
if(this._selectedItemIds[t]){
e.push(t)
}}
return e
};
AttachContactsTabView.prototype.uploadFiles=function(){
var e=appCtxt.getApp(ZmApp.MAIL).getComposeController(appCtxt.getApp(ZmApp.MAIL).getCurrentSessionId(ZmId.VIEW_COMPOSE));
this.zimlet.contactIdsToAttach=this._getSelectedItems();
this.zimlet._isDrafInitiatedByThisZimlet=true;
e.saveDraft(ZmComposeController.DRAFT_TYPE_AUTO,null,null,null,this.zimlet.contactIdsToAttach)
};
AttachContactsTabView.prototype.showAttachContactsTreeView=function(){
var e=new AjxCallback(this,this._showTreeView);
AjxPackage.undefine("zimbraMail.abook.controller.ZmAddrBookTreeController");
AjxPackage.require({
name:["ContactsCore","Contacts"],forceReload:true,callback:e}
)
};
AttachContactsTabView.prototype.reset=function(){
Dwt.byId(AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD).value="";
var e=AttachContactsTabView.DEFAULT_CONTACTS_FOLDER;
this._currentQuery=this._getQueryFromFolder(e);
this.treeView.setSelected(e);
this._treeListener()
};
AttachContactsTabView.prototype._showTreeView=function(){
if(appCtxt.isChildWindow){
ZmOverviewController.CONTROLLER.ADDRBOOK="ZmAddrBookTreeController"
}
var o=appCtxt.getApp(ZmApp.CONTACTS);
o._createDeferredFolders();
var e=this.toString();
var t={
treeIds:["ADDRBOOK"],overviewId:(appCtxt.multiAccounts)?([e,this.prevAccount.name].join(":")):e,account:this.prevAccount};
this._setOverview(t);
this.setSize(Dwt.DEFAULT,"295");
this.reset()
};
AttachContactsTabView.prototype._setOverview=function(s){
var n=s.overviewId;
var r=appCtxt.getOverviewController();
var o=r.getOverview(n);
if(!o){
var e={
overviewId:n,overviewClass:"AttachContactsTabBox",headerClass:"DwtTreeItem",noTooltips:true,treeIds:s.treeIds};
o=r.createOverview(e);
o.account=this.prevAccount;
var t={};
t[ZmOrganizer.ID_DLS]=true;
o.set(s.treeIds,t)
}else{
if(s.account){
o.account=s.account
}}
this._overview=o;
Dwt.byId(this._folderTreeCellId).appendChild(o.getHtmlElement());
this.treeView=o.getTreeView("ADDRBOOK");
Dwt.byId(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this);
this._hideRoot(this.treeView)
};
AttachContactsTabView.prototype._treeListener=function(){
var e=this.treeView.getSelected();
if(e){
var t=this._getQueryFromFolder(e.id);
this.executeQuery(t)
}};
AttachContactsTabView.prototype._hideRoot=function(t){
var o=t.getTreeItemById(ZmOrganizer.ID_ROOT);
if(!o){
var e=ZmOrganizer.getSystemId(ZmOrganizer.ID_ROOT,this.prevAccount);
o=t.getTreeItemById(e)
}
o.showCheckBox(false);
o.setExpanded(true);
o.setVisible(false,true)
};
AttachContactsTabView.prototype.setSize=function(n,e){
DwtTabViewPage.prototype.setSize.call(this,n,e);
var o=this.getSize();
var h=o.x*0.35;
var r=o.x-h;
var t=e-55;
this._overview.setSize(h,t);
var s=Dwt.byId(this._folderListId);
s.style.width=(r-5)+"px";
s.style.height=t+"px";
s.style.overflow="auto";
s.style.background="white";
return this
};
AttachContactsTabView.prototype.executeQuery=function(t,e){
if(this._limit==undefined){
this._limit=50
}
if(this._offset==undefined){
this._offset=0
}
if(e!=undefined){
if(e){
this._offset=this._offset+50
}else{
this._offset=this._offset-50
}}
var o=new AjxCallback(this,this.showResultContents);
this._searchContacts({
query:this._currentQuery,offset:this._offset,limit:this._limit,callback:o}
)
};
AttachContactsTabView.prototype._searchContacts=function(e){
var t={
SearchRequest:{
_jsns:"urn:zimbraMail"}};
t.SearchRequest.query=e.query+" not #type:group";
t.SearchRequest.types="contact";
t.SearchRequest.limit=e.limit;
t.SearchRequest.offset=e.offset;
t.SearchRequest.fetch="1";
e.response=appCtxt.getAppController().sendRequest({
jsonObj:t,noBusyOverlay:false}
);
this.showResultContents(e)
};
function com_zimbra_webex_HandlerObject(){}
com_zimbra_webex_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_webex_HandlerObject.prototype.constructor=com_zimbra_webex_HandlerObject;
var WebExZimlet=com_zimbra_webex_HandlerObject;
WebExZimlet.PROP_USERNAME={
propId:"webexZimlet_username",label:"WebExZimlet_userName",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_PASSWORD={
propId:"webexZimlet_pwd",label:"WebExZimlet_password",defaultVal:"",extraLabel:"",objType:"password"};
WebExZimlet.PROP_COMPANY_ID={
propId:"webexZimlet_companyId",label:"WebExZimlet_companyId",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_ALT_HOSTS={
propId:"WebExZimlet_altHosts",label:"WebExZimlet_altHosts",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_ASSOCIATED_CALENDAR={
propId:"webexZimlet_AssociatedCalendar",label:"WebExZimlet_useThisAccountFor",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_MEETING_PASSWORD={
propId:"webexZimlet_meetingPwd",label:"WebExZimlet_meetingPwd",defaultVal:"",extraLabel:"WebExZimlet_optional"};
WebExZimlet.PROP_TOLL_FREE_PHONE_NUMBER={
propId:"webexZimlet_tollFreePH",label:"WebExZimlet_tollFreeNumber",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_TOLL_PHONE_NUMBER={
propId:"webexZimlet_tollPH",label:"WebExZimlet_tollNumber",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_OTHER_PHONE_NUMBERS={
propId:"webexZimlet_otherPH",label:"WebExZimlet_otherPhoneNumbers",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_PHONE_PASSCODE={
propId:"webexZimlet_phonePasscode",label:"WebExZimlet_phonePasscode",defaultVal:"",extraLabel:"WebExZimlet_digitsOnly"};
WebExZimlet.SINGLE_WEBEX_ACCNT_PROPS=[WebExZimlet.PROP_USERNAME,WebExZimlet.PROP_PASSWORD,WebExZimlet.PROP_COMPANY_ID,WebExZimlet.PROP_MEETING_PASSWORD,WebExZimlet.PROP_ALT_HOSTS];
WebExZimlet.WEBEX_TELECONF_PROPS=[WebExZimlet.PROP_TOLL_FREE_PHONE_NUMBER,WebExZimlet.PROP_TOLL_PHONE_NUMBER,WebExZimlet.PROP_OTHER_PHONE_NUMBERS,WebExZimlet.PROP_PHONE_PASSCODE];
WebExZimlet.ALL_ACCNT_PROPS=[WebExZimlet.PROP_USERNAME,WebExZimlet.PROP_PASSWORD,WebExZimlet.PROP_COMPANY_ID,WebExZimlet.PROP_MEETING_PASSWORD,WebExZimlet.PROP_ASSOCIATED_CALENDAR,WebExZimlet.PROP_TOLL_FREE_PHONE_NUMBER,WebExZimlet.PROP_TOLL_PHONE_NUMBER,WebExZimlet.PROP_OTHER_PHONE_NUMBERS,WebExZimlet.PROP_PHONE_PASSCODE,WebExZimlet.PROP_ALT_HOSTS];
WebExZimlet.PROP_APPEND_WEBEX_MEETING_PWD={
propId:"webexZimlet_appendWebexMeetingPassword",label:"WebExZimlet_appendMeetingPwd",defaultVal:"NONE",extraLabel:""};
WebExZimlet.PROP_APPEND_TOLL_FREE_PHONE_NUMBER={
propId:"webexZimlet_appendTollFreeConfNumber",label:"WebExZimlet_appendToolFreeNumber",defaultVal:"NONE",extraLabel:""};
WebExZimlet.PROP_APPEND_TOLL_PHONE_NUMBER={
propId:"webexZimlet_appendTollConfNumber",label:"WebExZimlet_appendTollConfNumber",defaultVal:"NONE",extraLabel:""};
WebExZimlet.PROP_APPEND_PHONE_PASSCODE={
propId:"webexZimlet_appendPhonePasscode",label:"WebExZimlet_appendPhonePasscode",defaultVal:"NONE",extraLabel:""};
WebExZimlet.APPEND_SUB_OPTIONS=[WebExZimlet.PROP_APPEND_WEBEX_MEETING_PWD,WebExZimlet.PROP_APPEND_TOLL_FREE_PHONE_NUMBER,WebExZimlet.PROP_APPEND_TOLL_PHONE_NUMBER,WebExZimlet.PROP_APPEND_PHONE_PASSCODE];
WebExZimlet.ALL_GENERAL_PROPS=[WebExZimlet.PROP_APPEND_WEBEX_MEETING_PWD,WebExZimlet.PROP_APPEND_TOLL_FREE_PHONE_NUMBER,WebExZimlet.PROP_APPEND_TOLL_PHONE_NUMBER,WebExZimlet.PROP_APPEND_PHONE_PASSCODE];
WebExZimlet.WebExToZimbraTZIDMap={
"Etc/GMT+12":"0","Pacific/Midway":"1","Pacific/Honolulu":"2","America/Anchorage":"3","America/Los_Angeles":"4","America/Tijuana":"4","America/Phoenix":"5","America/Chihuahua":"6","America/Denver":"6","America/Chicago":"7","America/Guatemala":"7","America/Mexico_City":"8","America/Regina":"9","America/Bogota":"10","America/New_York":"11","America/Indiana/Indianapolis":"12","America/Halifax":"13","America/Guyana":"13","America/La_Paz":"13","America/Manaus":"13","America/Santiago":"13","America/Caracas":"14","America/St_Johns":"15","America/Sao_Paulo":"16","America/Argentina/Buenos_Aires":"17","America/Godthab":"17","America/Montevideo":"17","Atlantic/South_Georgia":"18","Atlantic/Azores":"19","Atlantic/Cape_Verde":"19","Africa/Casablanca":"20","Africa/Monrovia":"20","Europe/London":"21","Africa/Algiers":"21","Africa/Windhoek":"22","Europe/Belgrade":"22","Europe/Warsaw":"22","Europe/Brussels":"23","Europe/Berlin":"25","Europe/Athens":"26","Africa/Cairo":"28","Africa/Harare":"29","Asia/Amman":"29","Asia/Beirut":"29","Europe/Helsinki":"30","Europe/Minsk":"30","Asia/Jerusalem":"31","Asia/Baghdad":"32","Europe/Moscow":"33","Africa/Nairobi":"34","Asia/Kuwait":"35","Asia/Tehran":"35","Asia/Muscat":"36","Asia/Baku":"37","Asia/Tbilisi":"37","Asia/Yerevan":"37","Asia/Kabul":"38","Asia/Tashkent":"39","Asia/Yekaterinburg":"39","Asia/Karachi":"40","Asia/Kolkata":"41","Asia/Colombo":"42","Asia/Dhaka":"42","Asia/Novosibirsk":"43","Asia/Rangoon":"43","Asia/Bangkok":"44","Asia/Krasnoyarsk":"44","Asia/Hong_Kong":"45","Asia/Irkutsk":"45","Australia/Perth":"46","Asia/Kuala_Lumpur":"47","Asia/Taipei":"48","Asia/Tokyo":"49","Asia/Seoul":"50","Asia/Yakutsk":"51","Australia/Adelaide":"52","Australia/Darwin":"53","Asia/Vladivostok":"54","Australia/Brisbane":"54","Australia/Sydney":"55","Pacific/Guam":"56","Australia/Hobart":"57","Asia/Magadan":"59","Pacific/Auckland":"60","Pacific/Fiji":"61","Pacific/Tongatapu":"61"};
WebExZimlet.WEEK_NAME_MAP={
MO:"MONDAY",TU:"TUESDAY",WE:"WEDNESDAY",TH:"THURSDAY",FR:"FRIDAY",SA:"SATURDAY",SU:"SUNDAY"};
WebExZimlet.prototype.init=function(){
this.metaData=appCtxt.getActiveAccount().metaData;
WebExZimlet.PROP_COMPANY_ID.defaultVal=this.getUserProperty("webexZimlet_companyId")
};
WebExZimlet.prototype.initializeToolbar=function(h,s,o,t){
var e=appCtxt.getViewTypeFromId(t);
if(e==ZmId.VIEW_APPOINTMENT){
this._initCalendarWebexToolbar(s,o)
}else{
if(e==ZmId.VIEW_CONVLIST||e==ZmId.VIEW_CONV||e==ZmId.VIEW_TRAD||e==ZmId.VIEW_CONTACT_SIMPLE||e==ZmId.VIEW_CAL_DAY){
var l=s.getOp(ZmId.OP_ACTIONS_MENU);
if(l){
var r=l.getMenu();
if(r){
if(r.getMenuItem("WEBEX_ZIMLET_START_QUICK_MEETING")){
return
}
var n=r.createMenuItem("WEBEX_ZIMLET_START_QUICK_MEETING",{
image:"WEBEX-panelIcon",text:this.getMessage("WebExZimlet_startQuickWebExMeeting")}
);
n.addSelectionListener(new AjxListener(this,this._handleQuickMeetingMenuClick,o))
}}}}};
WebExZimlet.prototype._handleQuickMeetingMenuClick=function(e){
var t=e.getSelection();
if(!t instanceof Array){
this._showOneClickDlg("");
return
}
var o=t[0].type;
var n;
var s=[];
if(o==ZmId.ITEM_CONV){
n=t[0].getFirstHotMsg();
s=n.getEmails().getArray()
}else{
if(o==ZmId.ITEM_MSG){
n=t[0];
s=n.getEmails().getArray()
}else{
if(o==ZmId.ITEM_CONTACT){
s=this._getEmailsFromContacts(t)
}}}
var s=s instanceof Array?s.join(";"):"";
this._showOneClickDlg(s)
};
WebExZimlet.prototype.onAppointmentDelete=function(o){
if(!(o instanceof ZmAppt)){
for(var t in o){
var e=o[t][0];
if(e){
o=e;
break
}}}
this._appt=o;
if(this._appt.id.indexOf(":")>0){
return
}
var n;
if(o.viewMode!=ZmCalItem.MODE_DELETE_INSTANCE){
n=new AjxCallback(this,this._doDeleteWebExAppt)
}else{
n=new AjxCallback(this,this._showDeleteWebExApptYesNoDlg)
}
this._getApptIdsHashMetaData(o.id,n)
};
WebExZimlet.prototype._showDeleteWebExApptYesNoDlg=function(e){
if(!e||!e.meetingKey){
return
}
var t=appCtxt.getYesNoMsgDialog();
t.registerCallback(DwtDialog.YES_BUTTON,this._deleteYesButtonClicked,this,[t,e]);
t.registerCallback(DwtDialog.NO_BUTTON,this._deleteNoButtonClicked,this,t);
t.setMessage(this.getMessage("WebExZimlet_entireSeriesWillBeDeleted"),DwtMessageDialog.WARNING_STYLE);
t.popup()
};
WebExZimlet.prototype._deleteYesButtonClicked=function(t,e){
t.popdown();
this._doDeleteWebExAppt(e)
};
WebExZimlet.prototype._doDeleteWebExAppt=function(s){
var t="";
if(!s||!s.meetingKey){
return
}
t=s.meetingKey;
if(this._appt.viewMode==ZmCalItem.MODE_DELETE||this._appt.viewMode==ZmCalItem.MODE_DELETE_INSTANCE){
if(s.exceptionMeetingKey){
t=s.exceptionMeetingKey
}}
var n=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.DelMeeting">',"<meetingKey>",t,"</meetingKey>","</bodyContent>"].join("");
var o=this.newWebExRequest(n,s);
var e=AjxRpc.invoke(o,this.postUri(s),{
"Content-Type":"text/xml"}
,null,false,false);
var r=this.xmlToObject(e);
if(!this._validateWebExResult(r,this.getMessage("WebExZimlet_unableToDeleteWebExAppt"))){
return
}
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_meetingWasDeleted"),ZmStatusView.LEVEL_INFO)
};
WebExZimlet.prototype._deleteNoButtonClicked=function(e){
e.popdown()
};
WebExZimlet.prototype._initCalendarWebexToolbar=function(n,e){
if(!n.getButton("SAVE_AS_WEBEX")){
ZmMsg.sforceAdd=this.getMessage("WebExZimlet_saveAsWebEx");
var s=n.opList.length+1;
var o=n.createOp("SAVE_AS_WEBEX",{
image:"WEBEX-panelIcon",text:"WebEx",tooltip:this.getMessage("WebExZimlet_savesThisApptAsWebEx"),index:s}
);
n.addOp("SAVE_AS_WEBEX",s);
this._composerCtrl=e;
this._composerCtrl._webexZimlet=this;
var r=new ZmPopupMenu(o);
o.setMenu(r);
o.noMenuBar=true;
o.removeAllListeners();
o.removeDropDownSelectionListener();
var t=r.createMenuItem(Dwt.getNextId(),{
image:"WEBEX-panelIcon",text:this.getMessage("WebExZimlet_insertWebExDetails")}
);
t.addSelectionListener(new AjxListener(this._composerCtrl,this._saveAsWebExHandler,true));
var t=r.createMenuItem(Dwt.getNextId(),{
image:"WEBEX-panelIcon",text:this.getMessage("WebExZimlet_insertWebExDetailsAndSendAppointment")}
);
t.addSelectionListener(new AjxListener(this._composerCtrl,this._saveAsWebExHandler,false))
}};
WebExZimlet.prototype._saveAsWebExHandler=function(o){
try{
if(this._composeView.isValid()){
var n=this._composeView.getAppt();
var t=n.viewMode;
var s={
apptController:this,apptComposeView:this._composeView,appt:n,dontSaveMeeting:o};
if(t!=ZmCalItem.MODE_EDIT_SINGLE_INSTANCE&&t!=ZmCalItem.MODE_EDIT&&t!=ZmCalItem.MODE_EDIT_SERIES){
this._webexZimlet._doSaveWebExAppt(s)
}else{
var r=new AjxCallback(this._webexZimlet,this._webexZimlet._checkIfItsWebExUpdate,s);
this._webexZimlet._getApptIdsHashMetaData(n.id,r)
}}}
catch(e){
this._webexZimlet._showErrorMessage(e);
return
}};
WebExZimlet.prototype._checkIfItsWebExUpdate=function(t,e){
if(!e){
this._doSaveWebExAppt(t)
}else{
if(e&&e.meetingKey){
t.webExKeyData=e;
this._showUpdateWebExApptYesNoDlg(t)
}}};
WebExZimlet.prototype._showUpdateWebExApptYesNoDlg=function(t){
var e=appCtxt.getYesNoMsgDialog();
e.registerCallback(DwtDialog.YES_BUTTON,this._updateYesButtonClicked,this,[e,t]);
e.registerCallback(DwtDialog.NO_BUTTON,this._updateNoButtonClicked,this,e);
e.setMessage(this.getMessage("WebExZimlet_modifyApptAvoidDuplicateInfoWarning"),DwtMessageDialog.WARNING_STYLE);
e.popup()
};
WebExZimlet.prototype._updateYesButtonClicked=function(t,e){
t.popdown();
this._doSaveWebExAppt(e)
};
WebExZimlet.prototype._updateNoButtonClicked=function(e){
e.popdown()
};
WebExZimlet.prototype._doSaveWebExAppt=function(e){
var t=new AjxCallback(this,this._doCreateOrUpdateMeeting,e);
this._showSelectAccountDlg({
postCallback:t,appt:e.appt,showOptions:true}
)
};
WebExZimlet.prototype._doCreateOrUpdateMeeting=function(t,e){
t.manuallySelectedAccount=e;
var o=new AjxCallback(this,this._createOrUpdateMeeting,t);
this._getGeneralPrefsMetaData(o)
};
WebExZimlet.prototype._createOrUpdateMeeting=function(s){
var h={};
var o=s.appt;
try{
if(s.manuallySelectedAccount){
this._setCurrentAccntInfoFromAccntNumber(s.manuallySelectedAccount)
}else{
this._setCurrentAccntInfoFromCalendar(o.folderId)
}}
catch(t){
this._showErrorMessage(t);
return
}
h.subject=o.name;
h.loc=AjxStringUtil.urlComponentEncode(o.location);
h.emails=s.emails=o.getAttendees(ZmCalBaseItem.PERSON);
h.duration=(o.endDate.getTime()-o.startDate.getTime())/60000;
h.timeZoneID=WebExZimlet.WebExToZimbraTZIDMap[o.timezone];
h.pwd=this._currentWebExAccount[WebExZimlet.PROP_MEETING_PASSWORD.propId];
h.recurrence=this._getRecurrenceString(o);
var e=o.startDate;
h.formattedStartDate=this._formatDate(e);
var n=null;
if(s.webExKeyData&&s.webExKeyData.meetingKey){
n=s.webExKeyData.meetingKey
}
if(o.viewMode!=ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){
h.meetingKey=n
}else{
if(n){
s.seriesMeetingKey=n
}}
var r=new AjxCallback(this,this._createOrUpdateMeetingResponseHdlr,s);
this._getCreateOrModifyMeetingRequest(h,r)
};
WebExZimlet.prototype._getRecurrenceString=function(t){
var l=t.getRecurrence();
var b=l.repeatType;
if(b=="NON"||t.viewMode==ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){
return""
}
var y=l.repeatEndCount;
var u=l.repeatEndDate;
var o="";
if(y>1){
o=["<afterMeetingNumber>",y,"</afterMeetingNumber>"].join("")
}else{
if(u){
u=[(u.getMonth()+1),"/",u.getDate(),"/",u.getFullYear()," 00:00:00"].join("");
o=["<expirationDate>",u,"</expirationDate>"].join("")
}}
var p="";
if(b=="WEE"){
var n=l.repeatWeeklyDays;
var g=this._getDayInWeekStr(n,t);
p=["<repeat><repeatType>WEEKLY</repeatType>",g,o,"</repeat>"].join("")
}else{
if(b=="MON"){
var f="";
var h="";
var g="";
var d=l.repeatCustomMonthDay?[l.repeatCustomMonthDay]:l.repeatMonthlyDayList;
var m="";
if(l.repeatBySetPos!="1"){
h=["<weekInMonth>",l.repeatBySetPos,"</weekInMonth>"].join("");
var n=l.repeatCustomDays?l.repeatCustomDays:l.repeatWeeklyDays;
g=this._getDayInWeekStr(n,t);
m=h+g
}else{
if(d.length>0){
f=["<dayInMonth>",d[0],"</dayInMonth>"].join("");
m=f
}}
var e=["<interval>",l.repeatCustomCount,"</interval>"].join("");
p=["<repeat><repeatType>MONTHLY</repeatType>",m,e,o,"</repeat>"].join("")
}else{
if(b=="YEA"){
var f="";
var m="";
var g="";
var r="";
var d=l.repeatCustomMonthDay?[l.repeatCustomMonthDay]:l.repeatMonthlyDayList;
if(l.repeatBySetPos!="1"){
r=["<weekInMonth>",l.repeatBySetPos,"</weekInMonth>"].join("");
var n=l.repeatCustomDays?l.repeatCustomDays:l.repeatWeeklyDays;
g=this._getDayInWeekStr(n,t);
var s=["<monthInYear>",l.repeatYearlyMonthsList,"</monthInYear>"].join("");
m=r+g+s
}else{
f=["<dayInMonth>",d[0],"</dayInMonth>"].join("");
var s=["<monthInYear>",l.repeatYearlyMonthsList,"</monthInYear>"].join("");
m=f+s
}
p=["<repeat><repeatType>YEARLY</repeatType>",m,o,"</repeat>"].join("")
}else{
if(b=="DAI"){
var m="";
if(!l.repeatWeekday){
var m=["<interval>",l.repeatCustomCount,"</interval>"].join("")
}else{
var n=["MO","TU","WE","TH","FR"];
m=this._getDayInWeekStr(n,t)
}
p=["<repeat><repeatType>DAILY</repeatType>",m,o,"</repeat>"].join("")
}}}}
return p
};
WebExZimlet.prototype._getDayInWeekStr=function(n,s){
var e=[];
e.push("<dayInWeek>");
if(n.length>0){
for(var o=0;
o<n.length;
o++){
e.push("<day>",WebExZimlet.WEEK_NAME_MAP[n[o]],"</day>")
}}else{
var t=ZmCalItem.SERVER_WEEK_DAYS[s.startDate.getDay()];
e.push("<day>",WebExZimlet.WEEK_NAME_MAP[t],"</day>")
}
e.push("</dayInWeek>");
return e.join("")
};
WebExZimlet.prototype._getCreateAttendeesRequest=function(t){
var h=t.emails;
var s=t.meetingKey;
var u=[];
var n=0;
for(var r=0;
r<h.length;
r++){
var m=h[r];
var l=m.getEmail?m.getEmail():(m.getAddress?m.getAddress():"");
if(l==""||l==undefined){
continue
}
var d=m.getFullName?m.getFullName():(m.getDispName?m.getDispName():"");
if(r!=0){
u[n++]="<attendees>"
}
u[n++]=["<person><email>",l,"</email>"].join("");
if(d!=""&&d!=undefined){
u[n++]=["<name>",d,"</name>"].join("")
}
u[n++]="</person>";
u[n++]="<joinStatus>INVITE</joinStatus>";
u[n++]=["<sessionKey>",s,"</sessionKey>"].join("");
if(r!=0){
u[n++]="</attendees>"
}}
var o=['<bodyContent xsi:type="java:com.webex.service.binding.attendee.CreateMeetingAttendee">',u.join(""),"</bodyContent>"].join("");
return this.newWebExRequest(o)
};
WebExZimlet.prototype._getCreateOrModifyMeetingRequest=function(O,s){
var p=O.emails;
var W=O.meetingKey;
var l=O.pwd;
var r=O.subject;
var f=O.loc;
var n=O.formattedStartDate;
var t=O.duration;
var g=O.timeZoneID;
var m=O.recurrence?O.recurrence:"";
var b=O.sendWebExEmail;
var w=[];
if(b){
var x=0;
for(var q=0;
q<p.length;
q++){
var A=p[q];
var T=A.getEmail?A.getEmail():(A.getAddress?A.getAddress():"");
if(T==""||T==undefined){
continue
}
var u=A.getFullName?A.getFullName():(A.getDispName?A.getDispName():"");
w[x++]=["<attendee><person><email>",T,"</email>"].join("");
if(u!=""&&u!=undefined){
w[x++]=["<name>",u,"</name>"].join("")
}
w[x++]="</person></attendee>"
}}
var d=this._currentWebExAccount.WebExZimlet_altHosts;
if(this._showSelectAccntsDlg){
if(document.getElementById(this._showSelectAccntsDlg._altHostFieldId)&&this._showSelectAccntsDlg._showOptions){
d=document.getElementById(this._showSelectAccntsDlg._altHostFieldId).value
}
if(document.getElementById(this._showSelectAccntsDlg._mPwdFieldId)){
l=document.getElementById(this._showSelectAccntsDlg._mPwdFieldId).value
}}
if(d!=""&&d!="N/A"&&d.indexOf(";")>0){
d=d.split(";")
}else{
if(d!=""&&d!="N/A"&&d.indexOf(",")>0){
d=d.split(",")
}else{
if(d!=""&&d.indexOf("@")>0){
d=[d]
}}}
var y=[];
if(d instanceof Array){
for(var q=0;
q<d.length;
q++){
var T=d[q];
y.push("<attendee><person><email>",T,"</email></person><role>HOST</role></attendee>")
}}
var v,z;
if(W){
v="java:com.webex.service.binding.meeting.SetMeeting";
z=["<meetingkey>",W,"</meetingkey>"].join("")
}else{
v="java:com.webex.service.binding.meeting.CreateMeeting";
z=""
}
if(!l||l==""||l=="N/A"||l=="null"){
var o=""
}else{
var o=["<accessControl><meetingPassword>",l,"</meetingPassword></accessControl>"].join("")
}
var k="";
k="<attendeeOptions><emailInvitations>TRUE</emailInvitations></attendeeOptions>";
var h=['<bodyContent xsi:type="',v,'">',o,"<metaData><sessionTemplate><default>true</default></sessionTemplate><confName>",AjxStringUtil.xmlEncode(r),"</confName>","<location>",f,"</location></metaData>","<participants><attendees>",w.join(""),y.join(""),"</attendees></participants>","<schedule>","<startDate>",n,"</startDate>","<duration>",t,"</duration>","<timeZoneID>",g,"</timeZoneID></schedule>","<telephony><telephonySupport>@callintype@</telephonySupport>","<enableTSP>@tspEnabled@</enableTSP>","@tspAccountIndex@","<extTelephonyDescription>",this._getWebExBodyString(null,"FIELD",true,true),"</extTelephonyDescription></telephony>",k,z,m,"</bodyContent>"].join("");
this._getTspAccount(h,s)
};
WebExZimlet.prototype._getTspAccount=function(t,n){
var e='<bodyContent xsi:type="java:com.webex.service.binding.user.GetUser"><webExId>'+this._currentWebExAccount[WebExZimlet.PROP_USERNAME.propId]+"</webExId></bodyContent>";
var o=this.newWebExRequest(e);
AjxRpc.invoke(o,this.postUri(),{
"Content-Type":"text/xml"}
,new AjxCallback(this,this._handleTspAccountEnabled,[t,n]),false,false)
};
WebExZimlet.prototype._handleTspAccountEnabled=function(s,l,d){
var r=false;
var o=1;
var t=this.xmlToObject(d);
if(AjxUtil.get(t,"header","response","result")=="SUCCESS"){
var n=AjxUtil.get(t,"body","bodyContent","tspAccount","tspAccount","accountIndex");
if(n){
r=true;
o=parseInt(n.toString())
}}
var h=r?"CALLIN":"OTHER";
var e=r?"<tspAccountIndex>"+o+"</tspAccountIndex>":"";
s=s.replace("@callintype@",h);
s=s.replace("@tspAccountIndex@",e);
s=s.replace("@tspEnabled@",r);
s=this.newWebExRequest(s);
AjxRpc.invoke(s,this.postUri(),{
"Content-Type":"text/xml"}
,l,false,false)
};
WebExZimlet.prototype._createOrUpdateMeetingResponseHdlr=function(r,e){
var l=this.xmlToObject(e);
if(!this._validateWebExResult(l,this.getMessage("WebExZimlet_unableToCreateOrModifyMeeting"))){
return
}
var s;
if(l.body.bodyContent.meetingkey){
s=l.body.bodyContent.meetingkey.toString()
}else{
if(r.webExKeyData&&r.webExKeyData.meetingKey){
s=r.webExKeyData.meetingKey
}}
if(!s){
this.displayErrorMessage(this.getMessage("WebExZimlet_webExDidntReturnMeetingKey"),this.getMessage("WebExZimlet_webExError"));
return
}
var h=r.emails;
if(h&&(h instanceof Array)&&h.length>0){
var o=this._getCreateAttendeesRequest({
emails:r.emails,meetingKey:s}
);
var e=AjxRpc.invoke(o,this.postUri(),{
"Content-Type":"text/xml"}
,null,false,false);
var l=this.xmlToObject(e);
if(!this._validateWebExResult(l,this.getMessage("WebExZimlet_couldNotRegisterAttendees"))){
return
}}
var n=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.GetjoinurlMeeting">',"<meetingKey>",s,"</meetingKey>","</bodyContent>"].join("");
var o=this.newWebExRequest(n);
var e=AjxRpc.invoke(o,this.postUri(),{
"Content-Type":"text/xml"}
,null,false,false);
var l=this.xmlToObject(e);
if(!this._validateWebExResult(l,this.getMessage("WebExZimlet_couldNotGetJoinMeetingUrl"))){
return
}
var t=l.body.bodyContent.joinMeetingURL.toString();
r.joinMeetingUrl=t;
r.meetingKey=s;
this._params=r;
this._appt=r.appt;
this._updateMeetingBodyAndSave(r)
};
WebExZimlet.prototype.onSaveApptSuccess=function(o,t,e){
if(!this._params){
return
}
var n=t.name.indexOf(this._appt.name);
if(this._appt.name!=t.name&&(n==-1||n>0)){
return
}
this._saveApptIdsHashToServer(e.apptId,this._params.meetingKey,this._params.seriesMeetingKey);
this._params=null
};
WebExZimlet.prototype._updateMeetingBodyAndSave=function(n){
var h=n.apptComposeView;
var t="HTML";
if(h.getComposeMode()!="text/html"){
t="PLAIN_TEXT"
}
var l=this._getWebExBodyString(n.joinMeetingUrl,t);
var d=h.getHtmlEditor().getContent();
if(t=="HTML"){
var s=d.lastIndexOf("</body></html>");
var r=d.substr(0,s);
var u=[r,l,"</body></html>"].join("")
}else{
var u=[d,l].join("")
}
if(this._appendToSubjectOrLocation("SUBJECT")){
var m=this._getAddionalStringToAppend("SUBJECT");
if(m!=""){
var e=h._apptEditView._subjectField;
var o=[e.getValue()," [",m,"]"].join("");
e.setValue(o)
}}
if(this._appendToSubjectOrLocation("LOCATION")){
var m=this._getAddionalStringToAppend("LOCATION");
if(m!=""){
var f=h._apptEditView._attInputField[ZmCalBaseItem.LOCATION];
var o=[f.getValue()," [",m,"]"].join("");
f.setValue(o)
}}
h.getHtmlEditor().setContent(u);
if(!n.dontSaveMeeting){
setTimeout(AjxCallback.simpleClosure(this._saveAppt,this,n.apptController),500)
}else{
this._showModifyAlertDialog()
}};
WebExZimlet.prototype._showModifyAlertDialog=function(){
if(!this._modifyAlertDlg){
this._modifyAlertDlg=new DwtMessageDialog({
parent:this.getShell(),buttons:[DwtDialog.OK_BUTTON]}
);
this._modifyAlertDlg.setMessage(this.getMessage("modifyAlertNotice"))
}
this._modifyAlertDlg.popup()
};
WebExZimlet.prototype._saveAppt=function(e){
if(e._sendListener){
e._sendListener()
}else{
if(e._saveListener){
e._saveListener()
}}
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_successfullyCreatedWebEx"),ZmStatusView.LEVEL_INFO);
this._showModifyAlertDialog()
};
WebExZimlet.prototype._appendToSubjectOrLocation=function(t){
if(!this._webexZimletGeneralPreferences){
false
}
for(var e in this._webexZimletGeneralPreferences){
if(this._webexZimletGeneralPreferences[e]=="BOTH"||this._webexZimletGeneralPreferences[e]==t){
return true
}}
return false
};
WebExZimlet.prototype._getAddionalStringToAppend=function(t){
if(this._webexZimletGeneralPreferences==undefined){
return""
}
var n=[];
var e=this._webexZimletGeneralPreferences[WebExZimlet.PROP_APPEND_WEBEX_MEETING_PWD.propId];
var o=this._currentWebExAccount[WebExZimlet.PROP_MEETING_PASSWORD.propId];
if((o!=""&&o!="N/A")&&(e=="BOTH"||e==t)){
n.push([this.getMessage("WebExZimlet_meetingPwd")," ",o].join(""))
}
e=this._webexZimletGeneralPreferences[WebExZimlet.PROP_APPEND_TOLL_FREE_PHONE_NUMBER.propId];
o=this._currentWebExAccount[WebExZimlet.PROP_TOLL_FREE_PHONE_NUMBER.propId];
if((o!=""&&o!="N/A")&&(e=="BOTH"||e==t)){
n.push([this.getMessage("WebExZimlet_tollFreeNumber")," ",o].join(""))
}
e=this._webexZimletGeneralPreferences[WebExZimlet.PROP_APPEND_TOLL_PHONE_NUMBER.propId];
o=this._currentWebExAccount[WebExZimlet.PROP_TOLL_PHONE_NUMBER.propId];
if((o!=""&&o!="N/A")&&(e=="BOTH"||e==t)){
n.push([this.getMessage("WebExZimlet_tollNumber")," ",o].join(""))
}
e=this._webexZimletGeneralPreferences[WebExZimlet.PROP_APPEND_PHONE_PASSCODE.propId];
o=this._currentWebExAccount[WebExZimlet.PROP_PHONE_PASSCODE.propId];
if((o!=""&&o!="N/A")&&(e=="BOTH"||e==t)){
n.push([this.getMessage("WebExZimlet_phonePasscode")," ",o].join(""))
}
return n.join(", ")
};
WebExZimlet.prototype._getWebExBodyString=function(m,e,d,o){
var l=[];
l.push(o?"":this._getMeetingDetailshdr(this.getMessage("WebExZimlet_teleconferenceDetails"),e));
if(e=="HTML"){
l.push("<table width='94%' align='center'><tr><td>");
l.push("<div style='border-bottom:1px solid #6E6E6E; border-right:1px solid #6E6E6E; border-left:1px solid #CECECE;'>");
l.push("<table width='100%' class='ZPropertySheet' cellspacing='6'>")
}
var p=true;
var t=false;
for(var h=0;
h<WebExZimlet.WEBEX_TELECONF_PROPS.length;
h++){
var r=WebExZimlet.WEBEX_TELECONF_PROPS[h];
var n=this._currentWebExAccount[r.propId];
if(n==""||n=="N/A"){
continue
}
if(h==WebExZimlet.WEBEX_TELECONF_PROPS.length-1){
l.push(this._getMeetingDetailsRow(this.getMessage(r.label),n,e,true,p))
}else{
l.push(this._getMeetingDetailsRow(this.getMessage(r.label),n,e,false,p))
}
p=!p;
t=true
}
if(e=="HTML"){
l.push("</table>");
l.push("</div>");
l.push("</td></tr></table>")
}
var s=t?l.join(""):"";
if(d){
return s
}
var u=this._currentWebExAccount[WebExZimlet.PROP_MEETING_PASSWORD.propId];
if(u==""||u=="N/A"){
u=this.getMessage("WebExZimlet_passwordNotRequired")
}
var l=[];
l.push(o?"":this._getMeetingDetailshdr(this.getMessage("WebExZimlet_webExDetails"),e));
if(e=="HTML"){
l.push("<table width='94%' align='center'><tr><td>");
l.push("<div style='border-bottom:1px solid #6E6E6E; border-right:1px solid #6E6E6E; border-left:1px solid #CECECE;'>");
l.push("<table width='100%' class='ZPropertySheet' cellspacing='6'>")
}
l.push(this._getMeetingDetailsRow(this.getMessage("WebExZimlet_webExUrl"),m,e,false,true));
l.push(this._getMeetingDetailsRow(this.getMessage("WebExZimlet_userName"),this.getMessage("WebExZimlet_enterYourName"),e,false,false));
l.push(this._getMeetingDetailsRow(this.getMessage("WebExZimlet_email"),this.getMessage("WebExZimlet_enterYourEmail"),e,false,true));
l.push(this._getMeetingDetailsRow(this.getMessage("WebExZimlet_meetingPwd"),u,e,true,false));
if(e=="HTML"){
l.push("</table>");
l.push("</div>");
l.push("</td></tr></table>")
}
var f=l.join("");
return f+s
};
WebExZimlet.prototype._getMeetingDetailsRow=function(t,r,e,n,h){
if(r==""||r=="N/A"){
return
}
var o="";
if(e=="PLAIN_TEXT"){
o="\n"
}else{
if(e=="FIELD"){
o=" | "
}}
if(e=="HTML"){
r=r.replace(/\n/g,"<br/>");
var s=!h?" style='background-color:#FBF9F4' ":" style='background-color:#FEFDFC' ";
return["<tr ",s,"><td width='20%'><b>",t,"</b> </td><td> ",r,"</td></tr>"].join("")
}else{
if(n){
return[t,r].join("")
}else{
r=r.replace(/\n/g,o);
return[t," ",r,o].join("")
}}};
WebExZimlet.prototype._getMeetingDetailshdr=function(t,e){
if(e=="HTML"){
return["<br/>","<table width='94%' align='center'><tr><td>","<div style='background:#808080;border-bottom:1px solid #6E6E6E;border-right:1px solid #6E6E6E;font-weight:bold;color:white;padding:2px;'>","<b>",t,"</b>","</div>","</tr></td></table>"].join("")
}else{
return["\n--------------------------------------------------------------------",,"\n",t,"\n--------------------------------------------------------------------\n"].join("")
}};
WebExZimlet.prototype._formatDate=function(t){
t.setMinutes((Math.ceil(t.getMinutes()/15)*15)%60);
t.setSeconds(0);
t.setMilliseconds(0);
var e=new AjxDateFormat("MM/dd/yyyy HH:mm:ss");
return e.format(t)
};
WebExZimlet.prototype.postUri=function(e){
var t=e?e.companyId:this._currentWebExAccount[WebExZimlet.PROP_COMPANY_ID.propId];
return ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(["https://",t,".webex.com/WBXService/XMLService"].join(""))
};
WebExZimlet.prototype.singleClicked=function(){
this._displayGeneralPrefsDlg()
};
WebExZimlet.prototype.doubleClicked=function(){
this.singleClicked()
};
WebExZimlet.prototype.menuItemSelected=function(e){
switch(e){
case"ACCOUNT_PREFERENCES":this._displayAccntPrefsDialog();
break;
case"GENERAL_PREFERENCES":this._displayGeneralPrefsDlg();
break;
case"START_JOIN_MEETING":var t=new AjxCallback(this,this._showAppointmentsList);
this._showSelectAccountDlg({
postCallback:t,appt:null,showOptions:false}
);
break;
case"START_QUICK_MEETING":this._showOneClickDlg();
break
}};
WebExZimlet.prototype.xmlToObject=function(t){
var n=null;
try{
var e=null;
if(t.xml&&t.xml.childNodes.length>0){
e=new AjxXmlDoc.createFromDom(t.xml)
}else{
e=new AjxXmlDoc.createFromXml(t.text)
}
n=e.toJSObject(true,false)
}
catch(o){
this.displayErrorMessage(this.getMessage("WebExZimlet_errorInWebExXml"),t.text,this.getMessage("WebExZimlet_webExError"));
return null
}
if(t.text&&t.text.length>5&&t.text.substring(0,6).toLowerCase()=="<html>"){
n=null;
this.displayErrorMessage(this.getMessage("WebExZimlet_errorInWebExXml"),t.text,this.getMessage("WebExZimlet_webExError"))
}
return n
};
WebExZimlet.prototype.newWebExRequest=function(t,e){
return['<?xml version="1.0" encoding="UTF-8"?>','<serv:message xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ','xmlns:serv="http://www.webex.com/schemas/2002/06/service" ','xmlns:schemaLocation="http://www.webex.com/schemas/2002/06/service http://www.webex.com/schemas/2002/06/service/service.xsd">',"<header>",this.newSecurityContext(e),"</header>","<body>",t,"</body>","</serv:message>"].join("")
};
WebExZimlet.prototype.newSecurityContext=function(e){
var o=e?e.hostName:this._currentWebExAccount[WebExZimlet.PROP_USERNAME.propId];
var n=e?e.hostPwd:this._currentWebExAccount[WebExZimlet.PROP_PASSWORD.propId];
var t=e?e.companyId:this._currentWebExAccount[WebExZimlet.PROP_COMPANY_ID.propId];
return["<securityContext>","<webExID>",o,"</webExID>","<password>",AjxStringUtil.htmlEncode(n),"</password>","<siteName>",t,"</siteName>","</securityContext>"].join("")
};
WebExZimlet.prototype.getCompanyId=function(e){
return e?e.companyId:this._currentWebExAccount[WebExZimlet.PROP_COMPANY_ID.propId]
};
WebExZimlet.prototype._displayAccntPrefsDialog=function(){
if(this.accPrefsDlg){
this.accPrefsDlg.popup();
this._addAccntPrefsTabControl();
return
}
this._accPrefsDlgView=new DwtComposite(this.getShell());
this._accPrefsDlgView.setSize("530","400");
this._accPrefsDlgView.getHtmlElement().style.overflow="auto";
this._accPrefsDlgView.getHtmlElement().innerHTML=this._createAccPrefsView();
this.accPrefsDlg=new ZmDialog({
parent:this.getShell(),title:this.getMessage("WebExZimlet_manageAccounts"),view:this._accPrefsDlgView,standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]}
);
this.accPrefsDlg.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._accPrefsOkBtnListner));
this._addTestAccountButtons();
this._addHelpLinkListeners();
var e=new AjxCallback(this,this._setDataToAccPrefsDlg);
this._getAccPrefsMetaData(e)
};
WebExZimlet.prototype._addAccntPrefsTabControl=function(){
this.accPrefsDlg._tabGroup.removeAllMembers();
for(var e=0;
e<this._accntPrefsObjsHash.length;
e++){
var t=document.getElementById(this._accntPrefsObjsHash[e]);
if(t){
this.accPrefsDlg._tabGroup.addMember(t)
}}
document.getElementById(this._accntPrefsObjsHash[0]).focus()
};
WebExZimlet.prototype._addHelpLinkListeners=function(){
for(var e=0;
e<this._accntPrefsHelpObjsHash.length;
e++){
var t=this._accntPrefsHelpObjsHash[e];
document.getElementById(t.helpLinkId).onclick=AjxCallback.simpleClosure(this._accPrefsShowHelpdialog,this,t.propId)
}};
WebExZimlet.prototype._accPrefsShowHelpdialog=function(e){
var o="";
if(e==WebExZimlet.PROP_ALT_HOSTS.propId){
var o=this.getMessage("WebExZimlet_setupAlternateHost")
}else{
if(e==WebExZimlet.PROP_COMPANY_ID.propId){
var o=this.getMessage("WebExZimlet_companyIdExample")
}}
var t=appCtxt.getMsgDialog();
t.reset();
t.setMessage(o,DwtMessageDialog.INFO_STYLE);
t.popup()
};
WebExZimlet.prototype._addTestAccountButtons=function(){
for(var t=1;
t<6;
t++){
var e=new DwtButton({
parent:this.getShell()}
);
e.setText(AjxMessageFormat.format(this.getMessage("WebExZimlet_validateWebExAccntNumber"),t));
e.setImage("WEBEX-panelIcon");
e.addSelectionListener(new AjxListener(this,this._testWebExAccount,[t]));
document.getElementById("webExZimlet_TestAccountBtn"+t).appendChild(e.getHtmlElement())
}};
WebExZimlet.prototype._getAccPrefsMetaData=function(e){
setTimeout(AjxCallback.simpleClosure(this._doGetAccPrefsMetaData,this,e),500)
};
WebExZimlet.prototype._doGetAccPrefsMetaData=function(e){
this.metaData.get("webexZimletAccountPreferences",null,new AjxCallback(this,this._handleGetAccPrefsMetaData,e))
};
WebExZimlet.prototype._handleGetAccPrefsMetaData=function(o,e){
this._webexZimletAccountPreferences=null;
try{
this._webexZimletAccountPreferences=e.getResponse().BatchResponse.GetMailboxMetadataResponse[0].meta[0]._attrs;
if(o){
o.run(this)
}else{
return this._webexZimletAccountPreferences
}}
catch(t){
this._showErrorMessage(t)
}};
WebExZimlet.prototype._setCurrentAccntInfoFromCalendar=function(n){
var o=this._getAccountNumberFromFolderId(n);
this._currentWebExAccount=[];
for(var e=0;
e<WebExZimlet.ALL_ACCNT_PROPS.length;
e++){
var t=WebExZimlet.ALL_ACCNT_PROPS[e].propId;
this._currentWebExAccount[t]=this._webexZimletAccountPreferences[t+o]
}
this._currentWebExAccountNumber=o;
this._validateCurrentAccount(o)
};
WebExZimlet.prototype._getAccountNumberFromFolderId=function(o){
this._isAtLeastOneAccountConfigured();
var t=1;
for(var e=1;
e<6;
e++){
if(this._webexZimletAccountPreferences[WebExZimlet.PROP_ASSOCIATED_CALENDAR.propId+e]==o){
t=e;
break
}}
return t
};
WebExZimlet.prototype._isAtLeastOneAccountConfigured=function(){
if(this._webexZimletAccountPreferences==undefined){
throw new AjxException(this.getMessage("WebExZimlet_noWebExAccount"),AjxException.INTERNAL_ERROR,this.getMessage("WebExZimlet_label"))
}
for(var e=1;
e<6;
e++){
if(this._isAccountConfigured(e)){
return true
}}
throw new AjxException(this.getMessage("WebExZimlet_noWebExAccount"),AjxException.INTERNAL_ERROR,this.getMessage("WebExZimlet_label"))
};
WebExZimlet.prototype._isAccountConfigured=function(e){
if(!this._webexZimletAccountPreferences){
return false
}
if(this._webexZimletAccountPreferences[WebExZimlet.PROP_USERNAME.propId+e]!=""&&this._webexZimletAccountPreferences[WebExZimlet.PROP_USERNAME.propId+e]!="N/A"&&this._webexZimletAccountPreferences[WebExZimlet.PROP_PASSWORD.propId+e]!=""&&this._webexZimletAccountPreferences[WebExZimlet.PROP_PASSWORD.propId+e]!="N/A"&&this._webexZimletAccountPreferences[WebExZimlet.PROP_COMPANY_ID.propId+e]!=""&&this._webexZimletAccountPreferences[WebExZimlet.PROP_COMPANY_ID.propId+e]!="N/A"){
return true
}
return false
};
WebExZimlet.prototype._setCurrentAccntInfoFromAccntNumber=function(o){
this._isAtLeastOneAccountConfigured();
this._currentWebExAccount=[];
for(var e=0;
e<WebExZimlet.ALL_ACCNT_PROPS.length;
e++){
var t=WebExZimlet.ALL_ACCNT_PROPS[e].propId;
this._currentWebExAccount[t]=this._webexZimletAccountPreferences[t+o]
}
this._validateCurrentAccount(o);
this._currentWebExAccountNumber=o
};
WebExZimlet.prototype._validateCurrentAccount=function(s){
var o=this._currentWebExAccount[WebExZimlet.PROP_USERNAME.propId];
var n=this._currentWebExAccount[WebExZimlet.PROP_PASSWORD.propId];
var e=this._currentWebExAccount[WebExZimlet.PROP_COMPANY_ID.propId];
if(o==""||o=="N/A"||n==""||n=="N/A"||e==""||e=="N/A"){
var t=this.getMessage("WebExZimlet_accountNumberNotSetup").replace("{0}",s);
throw new AjxException(t,AjxException.INTERNAL_ERROR,"_validateCurrentAccount")
}};
WebExZimlet.prototype._setDataToAccPrefsDlg=function(){
try{
for(var s=1;
s<6;
s++){
var r=true;
if(this._isAccountConfigured(s)){
r=false
}
for(var n=0;
n<WebExZimlet.ALL_ACCNT_PROPS.length;
n++){
var o=WebExZimlet.ALL_ACCNT_PROPS[n].propId;
var t=o+s;
var h;
if(r){
h=WebExZimlet.ALL_ACCNT_PROPS[n].defaultVal
}else{
h=this._webexZimletAccountPreferences[t]
}
if(h=="N/A"||h==""||h==undefined||h=="undefined"){
continue
}
if(o.indexOf(WebExZimlet.PROP_ASSOCIATED_CALENDAR.propId)==-1){
document.getElementById(t).value=h
}else{
this._setMenuValue(t,h)
}}}
this.accPrefsDlg.popup();
this._addAccntPrefsTabControl()
}
catch(e){
this._showErrorMessage(e);
return
}};
WebExZimlet.prototype._setMenuValue=function(n,o){
var e=document.getElementById(n).options;
for(var t=0;
t<e.length;
t++){
if(e[t].value==o){
e[t].selected=true;
break
}}};
WebExZimlet.prototype._createAccPrefsView=function(){
this._accntPrefsObjsHash=[];
this._accntPrefsHelpObjsHash=[];
var t=[];
if(!AjxEnv.isIE){
t.push("<table width='96%' align='center'><tr><td>")
}
for(var o=1;
o<6;
o++){
if(o==1){
var e=this.getMessage("WebExZimlet_account1UsedAsDefaultForUnAssociatedCal")
}else{
var e=""
}
t.push(this._getAccountPrefsHtml(o,e))
}
if(!AjxEnv.isIE){
t.push("</td></tr></table>")
}
return t.join("")
};
WebExZimlet.prototype._getAccountPrefsHtml=function(r,h){
var s=[];
var t=0;
var l=this.getMessage("WebExZimlet_accountNumber").replace("{0}",r);
s.push("<div class='webExZimlet_YellowBold'>");
s.push("<div class='webExZimlet_grayAccntHdr'>",l,"</div>");
s.push("<div class='webExZimlet_lightGray'>",this.getMessage("WebExZimlet_accountSettings"),"</div>");
s.push("<table class='webExZimlet_table ZPropertySheet' cellspacing='6'>");
for(var n=0;
n<WebExZimlet.SINGLE_WEBEX_ACCNT_PROPS.length;
n++){
var o=WebExZimlet.SINGLE_WEBEX_ACCNT_PROPS[n];
var d=o.objType?o.objType:"text";
var e=[o.propId,r].join("");
this._accntPrefsObjsHash.push(e);
if(o.propId==WebExZimlet.PROP_COMPANY_ID.propId||o.propId==WebExZimlet.PROP_ALT_HOSTS.propId){
var u=Dwt.getNextId();
this._accntPrefsHelpObjsHash.push({
helpLinkId:u,propId:o.propId}
);
s.push("<tr><td>",this.getMessage(o.label),"</td><td><input id='",e,"'  type='",d,"'/>","&nbsp; <a href='javascript:void(0)' id='",u,"'>",this.getMessage("WebExZimlet_help"),"</a></td></tr>")
}else{
s.push("<tr><td>",this.getMessage(o.label),"</td><td><input id='",e,"'  type='",d,"'/>","<label style='color:gray;'>",this.getMessage(o.extraLabel),"</label></td></tr>")
}}
s.push("<tr><td></td><td id='webExZimlet_TestAccountBtn",r,"' ></td></tr>");
s.push("</table>");
s.push("<br/><div class='webExZimlet_lightGray'>",this.getMessage("WebExZimlet_teleConfSettings"),"</div>");
s.push("<table class='webExZimlet_table ZPropertySheet' cellspacing='6'>");
for(var n=0;
n<WebExZimlet.WEBEX_TELECONF_PROPS.length;
n++){
var o=WebExZimlet.WEBEX_TELECONF_PROPS[n];
var e=[o.propId,r].join("");
this._accntPrefsObjsHash.push(e);
if(o.propId!=WebExZimlet.PROP_OTHER_PHONE_NUMBERS.propId){
s.push("<tr><td>",this.getMessage(o.label),"</td><td><input id='",e,"'  type='text'/>","<label style='color:gray;'>",this.getMessage(o.extraLabel),"</label></td></tr>")
}else{
s.push("<tr><td>",this.getMessage(o.label),"</td><td><textarea id='",e,"' rows='5' cols='20'></textarea>","<label style='color:gray;'>",this.getMessage(o.extraLabel),"</label></td></tr>")
}}
s.push("</table>");
s.push("<br/><div class='webExZimlet_lightGray'>",this.getMessage("WebExZimlet_associateCalendarHdr"),"</div>");
var o=WebExZimlet.PROP_ASSOCIATED_CALENDAR;
s.push("<div style='padding:5px'><label style='color:blue;font-weight:bold'>",this.getMessage(o.label),"</label><label style='color:gray;'>",this._getCalendarFoldersList(r),"<label style='color:gray;'>",this.getMessage(o.extraLabel),"</label></div></div><br/><br/>");
return s.join("")
};
WebExZimlet.prototype._testWebExAccount=function(n){
var r=document.getElementById(WebExZimlet.PROP_USERNAME.propId+n).value;
var h=document.getElementById(WebExZimlet.PROP_PASSWORD.propId+n).value;
var t=document.getElementById(WebExZimlet.PROP_COMPANY_ID.propId+n).value;
var l={
hostName:r,hostPwd:h,companyId:t};
if(r.length==0||h.length==0||t.length==0){
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_userPwdCIdRequired"),ZmStatusView.LEVEL_WARNING);
return
}
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_pleaseWait"),ZmStatusView.LEVEL_INFO);
var s='<bodyContent xsi:type="java:com.webex.service.binding.user.GetUser"><webExId>'+r+"</webExId></bodyContent>";
var o=this.newWebExRequest(s,l);
var e=AjxRpc.invoke(o,this.postUri(l),{
"Content-Type":"text/xml"}
,new AjxCallback(this,this._handleTestWebExAccount),false,false)
};
WebExZimlet.prototype._handleTestWebExAccount=function(e){
var o=this.xmlToObject(e);
if(!this._validateWebExResult(o,this.getMessage("WebExZimlet_testFailed"))){
return
}
var t=appCtxt.getMsgDialog();
t.reset();
t.setMessage(this.getMessage("WebExZimlet_testPassed"));
t.popup()
};
WebExZimlet.prototype._accPrefsOkBtnListner=function(){
var e=[];
for(var n=1;
n<6;
n++){
for(var o=0;
o<WebExZimlet.ALL_ACCNT_PROPS.length;
o++){
var t=WebExZimlet.ALL_ACCNT_PROPS[o].propId+n;
var s=document.getElementById(t).value;
s=s==""?"N/A":s;
e[t]=s
}}
this.metaData.set("webexZimletAccountPreferences",e,null,new AjxCallback(this,this._saveAccPrefsHandler),null,true)
};
WebExZimlet.prototype._saveAccPrefsHandler=function(){
this._webexZimletAccountPreferences=null;
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_PrefSaved"),ZmStatusView.LEVEL_INFO);
this.accPrefsDlg.popdown()
};
WebExZimlet.prototype._getCalendarFoldersList=function(o){
var n=[WebExZimlet.PROP_ASSOCIATED_CALENDAR.propId,o].join("");
this._accntPrefsObjsHash.push(n);
var e=0;
var t=new Array();
t[e++]=["<SELECT id='",n,"'>"].join("");
t[e++]=this._getCalendarsOptionsHtml();
t[e++]="</SELECT>";
return t.join("")
};
WebExZimlet.prototype._getCalendarsOptionsHtml=function(){
if(this._calendarOptionsHtml){
return this._calendarOptionsHtml
}
var r=0;
var d=new Array();
var p=AjxSoapDoc.create("GetFolderRequest","urn:zimbraMail");
var l=p.set("folder");
l.setAttribute("l",appCtxt.getFolderTree().root.id);
var o=new ZmCsfeCommand();
var m=o.invoke({
soapDoc:p,noAuthToken:true}
).Body.GetFolderResponse.folder[0];
var s=m.folder?m.folder:[];
var n=m.link?m.link:[];
var t=s.concat(n);
if(t){
d[r++]=["<option value='ALL'>",this.getMessage("WebExZimlet_allCalendars"),"</option>"].join("");
for(var h=0;
h<t.length;
h++){
var u=t[h];
if(u&&u.view=="appointment"){
var e=u.id;
if(u.zid&&u.rid){
e=[u.zid,":",u.rid].join("")
}
d[r++]=["<option value='",e,"'>",u.name,"</option>"].join("")
}}}
this._calendarOptionsHtml=d.join("");
return this._calendarOptionsHtml
};
WebExZimlet.prototype._displayGeneralPrefsDlg=function(){
if(this.generalPrefsDlg){
this.generalPrefsDlg.popup();
return
}
var e=new DwtComposite(this.getShell());
e.getHtmlElement().style.overflow="auto";
e.getHtmlElement().innerHTML=this._createGeneralPrefsView();
this.generalPrefsDlg=new ZmDialog({
parent:this.getShell(),title:this.getMessage("WebExZimlet_preferences"),view:e,standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]}
);
this.generalPrefsDlg.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._generalPrefsOkBtnListner));
var t=new AjxCallback(this,this._setDataToGeneralPrefsDlg);
this._getGeneralPrefsMetaData(t)
};
WebExZimlet.prototype._getGeneralPrefsMetaData=function(e){
this.metaData.get("webexZimletGeneralPreferences",null,new AjxCallback(this,this._handleGetGeneralPrefsMetaData,e))
};
WebExZimlet.prototype._setDefaultGeneralPreferences=function(){
this._webexZimletGeneralPreferences={};
for(var e=0;
e<WebExZimlet.ALL_GENERAL_PROPS.length;
e++){
var t=WebExZimlet.ALL_GENERAL_PROPS[e];
this._webexZimletGeneralPreferences[t.propId]=t.defaultVal
}};
WebExZimlet.prototype._handleGetGeneralPrefsMetaData=function(n,e){
try{
this._webexZimletGeneralPreferences=null;
var t=e.getResponse().BatchResponse.GetMailboxMetadataResponse[0];
if(t.meta&&t.meta[0]){
this._webexZimletGeneralPreferences=t.meta[0]._attrs
}
if(this._webexZimletGeneralPreferences==undefined){
this._setDefaultGeneralPreferences()
}
if(n){
n.run(this)
}else{
return this._webexZimletGeneralPreferences
}}
catch(o){
this._showErrorMessage(o);
return
}};
WebExZimlet.prototype._setDataToGeneralPrefsDlg=function(){
try{
var r=false;
if(this._webexZimletGeneralPreferences==undefined){
var r=true
}
for(var s=0;
s<WebExZimlet.ALL_GENERAL_PROPS.length;
s++){
var o=WebExZimlet.ALL_GENERAL_PROPS[s].propId;
var h;
if(r){
h=WebExZimlet.ALL_GENERAL_PROPS[s].defaultVal
}else{
h=this._webexZimletGeneralPreferences[o]
}
if(h=="N/A"){
continue
}
var e=document.getElementById(o).options;
for(var l=0;
l<e.length;
l++){
if(e[l].value==h||e[l].text==h){
e[l].selected=true;
break
}}}
this.generalPrefsDlg.popup()
}
catch(t){
this._showErrorMessage(t)
}};
WebExZimlet.prototype._createGeneralPrefsView=function(){
var t=[];
t.push("<div class='webExZimlet_YellowBold '>");
t.push("<div class='webExZimlet_gray'>",this.getMessage("WebExZimlet_appendMeetingInfoToSubOrLoc"),"</div>");
t.push("<table class='ZPropertySheet' cellspacing='6'>");
for(var e=0;
e<WebExZimlet.APPEND_SUB_OPTIONS.length;
e++){
var o=WebExZimlet.APPEND_SUB_OPTIONS[e];
t.push("<tr><td class='ZmFieldLabelRight'>",this.getMessage(o.label),"</td><td>",this._getAppendSelectListMenuHtml(o.propId),"</td></tr>")
}
t.push("</table>");
t.push("<br/>");
return t.join("")
};
WebExZimlet.prototype._getAppendSelectListMenuHtml=function(t){
var e=[];
e.push("<select id='",t,"'>");
e.push("<option value='NONE'>",this.getMessage("WebExZimlet_none"),"</option>");
e.push("<option value='SUBJECT'>",this.getMessage("WebExZimlet_subject"),"</option>");
e.push("<option value='LOCATION'>",this.getMessage("WebExZimlet_location"),"</option>");
e.push("<option value='BOTH'>",this.getMessage("WebExZimlet_subjectAndLocation"),"</option>");
e.push("</select>");
return e.join("")
};
WebExZimlet.prototype._generalPrefsOkBtnListner=function(){
var t=[];
try{
for(var s=0;
s<WebExZimlet.ALL_GENERAL_PROPS.length;
s++){
var n=WebExZimlet.ALL_GENERAL_PROPS[s].propId;
var e=document.getElementById(n);
var r=e.options[e.selectedIndex].value;
r=r==""?"N/A":r;
t[n]=r
}
this.metaData.set("webexZimletGeneralPreferences",t,null,new AjxCallback(this,this._saveGeneralPrefsHandler),null,true)
}
catch(o){
this._showErrorMessage(o)
}};
WebExZimlet.prototype._saveGeneralPrefsHandler=function(){
this._webexZimletGeneralPreferences=null;
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_PrefSaved"),ZmStatusView.LEVEL_INFO);
this.generalPrefsDlg.popdown()
};
WebExZimlet.prototype._getApptIdsHashMetaData=function(e,t){
this._currentMetaData=new ZmMetaData(appCtxt.getActiveAccount(),e);
this._currentMetaData.get("webexZimletApptIdsHash",null,new AjxCallback(this,this._handleGetApptIdsHashMetaData,t))
};
WebExZimlet.prototype._handleGetApptIdsHashMetaData=function(n,e){
this._apptIdsMetaData=null;
var t=e.getResponse();
if(t&&t.BatchResponse&&t.BatchResponse.GetCustomMetadataResponse){
t=t.BatchResponse.GetCustomMetadataResponse
}else{
return
}
try{
if(t.meta&&t.meta[0]){
this._apptIdsMetaData=t.meta[0]._attrs
}
if(n){
n.run(this._apptIdsMetaData)
}else{
return this._apptIdsMetaData
}}
catch(o){
this._showErrorMessage(o);
return
}};
WebExZimlet.prototype._saveApptIdsHashToServer=function(n,t,o){
this._currentMetaData=new ZmMetaData(appCtxt.getActiveAccount(),n);
var e=[];
if(this._appt.viewMode==ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){
e.exceptionMeetingKey=t;
if(o&&o!=""){
e.meetingKey=o
}}else{
e.meetingKey=t
}
e.hostName=this._currentWebExAccount[WebExZimlet.PROP_USERNAME.propId];
e.hostPwd=this._currentWebExAccount[WebExZimlet.PROP_PASSWORD.propId];
e.companyId=this._currentWebExAccount[WebExZimlet.PROP_COMPANY_ID.propId];
this._currentMetaData.set("webexZimletApptIdsHash",e,null,null,null,true)
};
WebExZimlet.prototype._showSelectAccountDlg=function(e){
var t=new AjxCallback(this,this._doShowSelectAccountDlg,e);
this._getAccPrefsMetaData(t)
};
WebExZimlet.prototype._doShowSelectAccountDlg=function(r){
var h=r.postCallback;
var n=r.appt;
var o=r.showOptions?true:false;
var s=1;
if(n&&n.folderId){
s=this._getAccountNumberFromFolderId(n.folderId)
}
if(this._showSelectAccntsDlg){
this._showSelectAccntsDlg._postCallback=h;
if(s){
this._setMenuValue("webExZimlet_accountsToSelectList",s)
}
this._showSelectAccntsDlg._showOptions=o;
this._setSelectAccntDlgData(s);
this._setSelectAccntListeners();
this._setSelectAccntOptions();
this._showSelectAccntsDlg.popup();
return
}
try{
var e=this._getAccountsSelectListMenuHtml("webExZimlet_accountsToSelectList")
}
catch(t){
this._showErrorMessage(t);
return
}
this._showSelectAccntsDlg=new ZmDialog({
parent:this.getShell(),title:this.getMessage("WebExZimlet_selectAccntToUse"),standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]}
);
this._showSelectAccntsDlg._showOptions=o;
this._showSelectAccntDlgView=new DwtComposite(this.getShell());
this._showSelectAccntDlgView.getHtmlElement().style.overflow="auto";
this._showSelectAccntDlgView.getHtmlElement().innerHTML=this._createShowSelectAccntView(e);
this._showSelectAccntsDlg.setView(this._showSelectAccntDlgView);
this._showSelectAccntsDlg._postCallback=h;
this._showSelectAccntsDlg.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._showSelectAccntDlgOkBtnListner));
if(s){
this._setMenuValue("webExZimlet_accountsToSelectList",s)
}
this._setSelectAccntDlgData(s);
this._setSelectAccntListeners();
this._setSelectAccntOptions();
this._showSelectAccntsDlg.popup()
};
WebExZimlet.prototype._setSelectAccntDlgData=function(o){
try{
this._setCurrentAccntInfoFromAccntNumber(o)
}
catch(e){
this._showErrorMessage(e);
return
}
var n=this._currentWebExAccount[WebExZimlet.PROP_ALT_HOSTS.propId];
var t=this._currentWebExAccount[WebExZimlet.PROP_MEETING_PASSWORD.propId];
document.getElementById(this._showSelectAccntsDlg._altHostFieldId).value=n=="N/A"?"":n;
document.getElementById(this._showSelectAccntsDlg._mPwdFieldId).value=t=="N/A"?"":t
};
WebExZimlet.prototype._setSelectAccntOptions=function(){
var e=this._showSelectAccntsDlg._showOptions?"block":"none";
document.getElementById("webexZimlet_showSelectAccnts_OptionsDiv").style.display=e
};
WebExZimlet.prototype._setSelectAccntListeners=function(){
document.getElementById(this._showSelectAccntsDlg._altHelpLinkId).onclick=AjxCallback.simpleClosure(this._accPrefsShowHelpdialog,this,WebExZimlet.PROP_ALT_HOSTS.propId);
document.getElementById("webExZimlet_accountsToSelectList").onchange=AjxCallback.simpleClosure(this._setNewAccountData,this)
};
WebExZimlet.prototype._setNewAccountData=function(){
var t=document.getElementById("webExZimlet_accountsToSelectList").value;
try{
this._setCurrentAccntInfoFromAccntNumber(t)
}
catch(e){
this._showErrorMessage(e);
return
}
this._setSelectAccntDlgData(t)
};
WebExZimlet.prototype._createShowSelectAccntView=function(e){
try{
var o=[];
this._showSelectAccntsDlg._altHostFieldId="WebExZimlet_showSelectAccntsDlg_altHostFieldId";
this._showSelectAccntsDlg._altHelpLinkId="WebExZimlet_showSelectAccntsDlg_altHelpLinkId";
this._showSelectAccntsDlg._mPwdFieldId="WebExZimlet_showSelectAccntsDlg_mPwdFieldId";
o.push("<div style='padding:5px;'>",this.getMessage("WebExZimlet_webExAccntToUse")," <span>",e,"</span></div>");
o.push("<br/>");
o.push("<div id='webexZimlet_showSelectAccnts_OptionsDiv' >");
o.push("<div><b>",this.getMessage("WebExZimlet_getAccounts"),"</b></div>");
o.push("<table class='webExZimlet_table ZPropertySheet' cellspacing='6'>");
o.push("<tr><td>",this.getMessage(WebExZimlet.PROP_ALT_HOSTS.label),"</td><td><input  id='",this._showSelectAccntsDlg._altHostFieldId,"'  type='text'/>","&nbsp; <a href='javascript:void(0)' id='",this._showSelectAccntsDlg._altHelpLinkId,"'>",this.getMessage("WebExZimlet_help"),"</a></td></tr>");
o.push("<tr><td>",this.getMessage(WebExZimlet.PROP_MEETING_PASSWORD.label),"</td><td><input id='",this._showSelectAccntsDlg._mPwdFieldId,"'  type='text'/>","<label style='color:gray;'>",this.getMessage(WebExZimlet.PROP_MEETING_PASSWORD.extraLabel),"</label></td></tr>");
o.push("</table>");
o.push("</div>");
return o.join("")
}
catch(t){
this._showErrorMessage(t)
}};
WebExZimlet.prototype._showSelectAccntDlgOkBtnListner=function(){
try{
this._validateCurrentAccount(document.getElementById("webExZimlet_accountsToSelectList").value)
}
catch(e){
this._showErrorMessage(e);
return
}
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_pleaseWait"),ZmStatusView.LEVEL_INFO);
this._showSelectAccntsDlg.popdown();
this._showSelectAccntsDlg._postCallback.run(document.getElementById("webExZimlet_accountsToSelectList").value)
};
WebExZimlet.prototype._showAppointmentsList=function(e){
if(!this._webexZimletAccountPreferences){
var t=new AjxCallback(this,this._showMeetingListDlg,[e,"NOW_ON"]);
this._getAccPrefsMetaData(t)
}else{
this._showMeetingListDlg(e,"NOW_ON")
}};
WebExZimlet.prototype._getMeetingsList=function(h,p){
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_pleaseWait"),ZmStatusView.LEVEL_INFO);
try{
this._setCurrentAccntInfoFromAccntNumber(h)
}
catch(u){
this._showErrorMessage(u);
return
}
var f=new Date();
var s=new Date(f.getTime()+(1*24*3600*1000));
var y=new Date(f.getTime()+(7*24*3600*1000));
if(p=="TODAY"){
var g=0;
var l=f
}else{
if(p=="TOMORROW"){
var g=0;
var l=s
}else{
if(p=="NEXT_7_DAYS"){
var g=0;
var l=f
}else{
var g=f.getHours()-1;
var l=f
}}}
g=g<10?"0"+g:g;
var t=l.getMonth()+1;
t=t<10?"0"+t:t;
var d=l.getDate();
d=d<10?"0"+d:d;
var m=["<startDateStart>",t,"/",d,"/",l.getFullYear()," ",g,":00:00","</startDateStart>"].join("");
var b="";
if(p=="TODAY"||p=="TOMORROW"){
b=["<startDateEnd>",t,"/",d,"/",l.getFullYear()," ","23:00:00","</startDateEnd>"].join("")
}else{
if(p=="NEXT_7_DAYS"){
var r=y.getDate();
r=r<10?"0"+r:r;
var e=y.getMonth()+1;
e=e<10?"0"+e:e;
b=["<startDateEnd>",e,"/",r,"/",y.getFullYear()," ","23:00:00","</startDateEnd>"].join("")
}}
var n=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.LstsummaryMeeting" ','xmlns:meet="http://www.webex.com/schemas/2002/06/service/meeting">',"<listControl><startFrom>1</startFrom><maximumNum>20</maximumNum></listControl>","<order><orderBy>STARTTIME</orderBy><orderAD>ASC</orderAD></order>","<dateScope>",m,b,"</dateScope></bodyContent>"].join("");
var o=this.newWebExRequest(n);
AjxRpc.invoke(o,this.postUri(),{
"Content-Type":"text/xml"}
,new AjxCallback(this,this._handleGetMeetingsList,[p]),false,false)
};
WebExZimlet.prototype._handleGetMeetingsList=function(t,e){
var o=this.xmlToObject(e);
if(!this._validateWebExResult(o,this.getMessage("WebExZimlet_unableToGetMeetingInfo"))){
return
}
this._setMeetingListView(o,t);
this._addShowMeetingListListeners()
};
WebExZimlet.prototype._showMeetingListDlg=function(t,e){
if(this._meetingLstDlg){
this._meetingListDlgView.getHtmlElement().innerHTML=["<label style='font-weight:bold;font-size:12px;color:blue;'>",this.getMessage("WebExZimlet_pleaseWait"),"</div>"].join("");
this._meetingLstDlg.popup();
this._getMeetingsList(t,e);
return
}
this._meetingListDlgView=new DwtComposite(this.getShell());
this._meetingListDlgView.setSize("570","200");
this._meetingListDlgView.getHtmlElement().style.background="white";
this._meetingListDlgView.getHtmlElement().style.overflow="auto";
this._meetingListDlgView.getHtmlElement().innerHTML=["<label style='font-weight:bold;font-size:12px;color:blue;'>",this.getMessage("WebExZimlet_pleaseWait"),"</div>"].join("");
this._meetingLstDlg=new ZmDialog({
parent:this.getShell(),title:this.getMessage("WebExZimlet_startOrJoinWebExMeeting"),view:this._meetingListDlgView,standardButtons:[DwtDialog.CANCEL_BUTTON]}
);
this._meetingLstDlg.popup();
this._getMeetingsList(t,e)
};
WebExZimlet.prototype._addShowMeetingListListeners=function(){
for(var t in this._startMeetingStartLinkIdMap){
document.getElementById(t).onclick=AjxCallback.simpleClosure(this._onStartLinkClicked,this,this._startMeetingStartLinkIdMap[t])
}
var e=AjxCallback.simpleClosure(this._meetingListTypesMenuHandler,this);
document.getElementById("webExZimlet_meetingsListTypesMenu").onchange=e
};
WebExZimlet.prototype._meetingListTypesMenuHandler=function(){
var e=document.getElementById("webExZimlet_meetingsListTypesMenu").value;
this._getMeetingsList(this._currentWebExAccountNumber,e)
};
WebExZimlet.prototype._onStartLinkClicked=function(r){
var s=false;
if(r.hostWebExId==this._currentWebExAccount.webexZimlet_username){
s=true;
var n=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.GethosturlMeeting">',"<meetingKey>",r.meetingKey,"</meetingKey>","</bodyContent>"].join("")
}else{
var n=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.GetjoinurlMeeting">',"<meetingKey>",r.meetingKey,"</meetingKey>","</bodyContent>"].join("")
}
var o=this.newWebExRequest(n);
var e=AjxRpc.invoke(o,this.postUri(),{
"Content-Type":"text/xml"}
,null,false,false);
var h=this.xmlToObject(e);
if(!this._validateWebExResult(h,this.getMessage("WebExZimlet_unableToGetJoinOrHostURL"))){
return
}
var t="";
if(s){
t=h.body.bodyContent.hostMeetingURL.toString()
}else{
t=h.body.bodyContent.joinMeetingURL.toString()
}
window.open(t)
};
WebExZimlet.prototype._setMeetingListView=function(t,s){
var l=t.body.bodyContent.meeting;
if(!l){
l=[]
}else{
if(!(l instanceof Array)){
l=[l]
}}
this._startMeetingStartLinkIdMap={};
var n=[];
n.push("<div class='webExZimlet_lightGray'>","Show meetings: ",this._getMeetingListTypesMenu(s),"</div>");
n.push("<table class='webex_hoverTable' cellspacing=0px width=100%>");
n.push("<tr align=left><th>",this.getMessage("WebExZimlet_host"),"</th><th width=50%>",this.getMessage("WebExZimlet_meetingName"),"</th><th>",this.getMessage("WebExZimlet_startTime"),"</th><th>",this.getMessage("WebExZimlet_action"),"</th></tr>");
var h=true;
for(var o=0;
o<l.length;
o++){
var d="RowEven";
var r=l[o];
var e=Dwt.getNextId();
this._startMeetingStartLinkIdMap[e]={
meetingKey:r.meetingKey.toString(),hostWebExId:r.hostWebExID.toString()};
if(!h){
d="RowOdd"
}
n.push("<tr class='",d,"'>","<td>",r.hostWebExID,"</td>","<td>",AjxStringUtil.urlComponentDecode(r.confName),"</td>","<td>",r.startDate,"<br/><label style='color:gray;font-size:10px'>",this._getTimeZoneName(r.timeZone.toString()),"</label></td>","<td><a href='javascript:void(0)' id='",e,"' >",this.getMessage("WebExZimlet_startJoin"),"</a></td>","</tr>");
h=!h
}
n.push("</table>");
this._meetingListDlgView.getHtmlElement().innerHTML=n.join("")
};
WebExZimlet.prototype._getMeetingListTypesMenu=function(s){
if(!s){
s="NOW_ON"
}
var e={
NOW_ON:this.getMessage("WebExZimlet_fromNowOn"),TODAY:this.getMessage("WebExZimlet_today"),TOMORROW:this.getMessage("WebExZimlet_tomorrow"),NEXT_7_DAYS:this.getMessage("WebExZimlet_next7days")};
var t=[];
t.push("<select id='webExZimlet_meetingsListTypesMenu'>");
for(var n in e){
var o=n==s?" selected ":"";
t.push("<option value='",n,"' ",o," >",e[n],"</option>")
}
t.push("</select>");
return t.join("")
};
WebExZimlet.prototype._getTimeZoneName=function(e){
var o=e.split(",");
var n=[];
for(var t=1;
t<o.length;
t++){
n.push(o[t])
}
return n.join(",")
};
WebExZimlet.prototype._showOneClickDlg=function(e){
if(!e){
e=""
}
if(this._oneClickDlg){
this._setAttendeesToOneClickDlg(e);
this._oneClickDlg.popup();
return
}
var t=new AjxCallback(this,this._doShowOneClickDlg,e);
this._getAccPrefsMetaData(t)
};
WebExZimlet.prototype._doShowOneClickDlg=function(o){
try{
var e=this._getAccountsSelectListMenuHtml("webExZimlet_oneClickAccountSelect")
}
catch(t){
this._showErrorMessage(t);
return
}
this._oneClickDlgView=new DwtComposite(this.getShell());
this._oneClickDlgView.getHtmlElement().style.overflow="auto";
this._oneClickDlgView.getHtmlElement().innerHTML=this._createOneClickMeetingView(e);
this._oneClickDlg=new ZmDialog({
parent:this.getShell(),title:this.getMessage("WebExZimlet_startQuickWebExMeeting"),view:this._oneClickDlgView,standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]}
);
this._oneClickDlg.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._oneClickDlgOkBtnListner));
this._addAutoCompleteHandler();
this._addToButton();
this._setAttendeesToOneClickDlg(o);
this._oneClickDlg.popup()
};
WebExZimlet.prototype._addToButton=function(t){
var e=new DwtButton({
parent:this.getShell()}
);
e.setText(ZmMsg.to);
e.addSelectionListener(new AjxListener(this,this._handleToButton));
document.getElementById("webexZimlet__oneClickMeeting_toButton").appendChild(e.getHtmlElement())
};
WebExZimlet.prototype._handleToButton=function(t){
if(!this._contactPicker){
AjxDispatcher.require("ContactsCore");
var e=[{
id:AjxEmailAddress.TO,label:ZmMsg[AjxEmailAddress.TYPE_STRING[AjxEmailAddress.TO]]}
];
this._contactPicker=new ZmContactPicker(e);
this._contactPicker.registerCallback(DwtDialog.OK_BUTTON,this._contactPickerOkCallback,this)
}
this._contactPicker.popup()
};
WebExZimlet.prototype._contactPickerOkCallback=function(e){
var f=false;
used={};
var s=[];
var n=e&&e.getArray();
if(n&&n.length){
for(var o=0,r=n.length;
o<r;
o++){
var u=n[o];
var d=u.isAjxEmailAddress?u&&u.getAddress():u;
if(!d){
continue
}
d=d.toLowerCase();
if(!used[d]){
s.push(u.address);
used[d]=true;
f=true
}}
var m=document.getElementById("webExZimlet_oneClickAttendeesField");
var l=AjxEmailAddress.parseEmailString(m.value).good.getArray();
var t=[];
var r=l.length;
for(var o=0;
o<r;
o++){
t.push(l[o].address)
}
s=t.concat(s);
var h=s.join(AjxEmailAddress.SEPARATOR);
m.value=h
}
this._contactPicker.popdown()
};
WebExZimlet.prototype._setAttendeesToOneClickDlg=function(e){
if(!e||e==""){
e=""
}
document.getElementById("webExZimlet_oneClickAttendeesField").value=e
};
WebExZimlet.prototype._addAutoCompleteHandler=function(){
if(appCtxt.get(ZmSetting.CONTACTS_ENABLED)||appCtxt.get(ZmSetting.GAL_ENABLED)){
var e={
dataClass:appCtxt.getAutocompleter(),matchValue:ZmAutocomplete.AC_VALUE_EMAIL,keyUpCallback:this._acKeyUpListener.bind(this),contextId:this.name};
this._acAddrSelectList=new ZmAutocompleteListView(e);
this._acAddrSelectList.handle(document.getElementById("webExZimlet_oneClickAttendeesField"))
}};
WebExZimlet.prototype._acKeyUpListener=function(o,t,e){};
WebExZimlet.prototype._createOneClickMeetingView=function(e){
var t=[];
t.push("<table width='100%' class='webExZimlet_table ZPropertySheet' cellspacing='6'>");
t.push("<tr><td colspan='2' class='ZmFieldLabelRight'>",this.getMessage("WebExZimlet_webExAccntToUse")," </td><td>",e,"</td></tr>");
t.push("<tr>","<td width='30'></td><td width='15' id='webexZimlet__oneClickMeeting_toButton'></td>","<td><input  style='width:400px;' type='text' id='webExZimlet_oneClickAttendeesField'> </input></td></tr>");
t.push("</table>");
return t.join("")
};
WebExZimlet.prototype._oneClickDlgOkBtnListner=function(){
var s=document.getElementById("webExZimlet_oneClickAccountSelect").value;
var e=this._getValidEmailsAsString("webExZimlet_oneClickAttendeesField");
if(e==""){
return
}
var o={
accntNumber:s,attendees:e};
var t=new AjxCallback(this,this._createOneClickMeetingAndLaunch,o);
var n=new AjxCallback(this,this._getGeneralPrefsMetaData,t);
this._getAccPrefsMetaData(n);
this._oneClickDlg.popdown()
};
WebExZimlet.prototype._createOneClickMeetingAndLaunch=function(t){
try{
this._setCurrentAccntInfoFromAccntNumber(t.accntNumber)
}
catch(l){
this._showErrorMessage(l);
return
}
var s={};
s.subject=this.getMessage("WebExZimlet_quickMeetingSubject");
s.loc=this.getMessage("WebExZimlet_quickMeetingLocation");
if(t.attendees&&t.attendees!=""){
s.emails=AjxEmailAddress.parseEmailString(t.attendees).good.getArray()
}else{
s.emails=[]
}
s.duration=60;
var n="";
try{
n=appCtxt.getActiveAccount().settings.getInfoResponse.prefs._attrs.zimbraPrefTimeZoneId
}
catch(r){
n="America/Los_Angeles"
}
s.timeZoneID=WebExZimlet.WebExToZimbraTZIDMap[n];
s.pwd=this._currentWebExAccount[WebExZimlet.PROP_MEETING_PASSWORD.propId];
var h=new Date();
var u=h.getTime()+(h.getTimezoneOffset()*60000);
var o=new Date(u);
s.formattedStartDate=this._formatDate(new Date());
s.meetingKey=null;
s.sendWebExEmail=true;
var m=new AjxCallback(this,this._createOneClickMeetingHdlr);
this._getCreateOrModifyMeetingRequest(s,m)
};
WebExZimlet.prototype._createOneClickMeetingHdlr=function(e){
var r=this.xmlToObject(e);
if(!this._validateWebExResult(r,"Unable to create meeting")){
return
}
var n=null;
if(r.body.bodyContent.meetingkey){
n=r.body.bodyContent.meetingkey.toString()
}
if(!n){
this.displayErrorMessage("WebEx did not return meeting key, perhaps, meeting didn't get created on the WebEx server.","WebEx Error");
return
}
var o=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.GethosturlMeeting">',"<meetingKey>",n,"</meetingKey>","</bodyContent>"].join("");
var t=this.newWebExRequest(o);
var e=AjxRpc.invoke(t,this.postUri(),{
"Content-Type":"text/xml"}
,null,false,false);
var r=this.xmlToObject(e);
if(!this._validateWebExResult(r,this.getMessage("WebExZimlet_unableToCreateMeeting"))){
return
}
var s=r.body.bodyContent.hostMeetingURL.toString();
window.open(s)
};
WebExZimlet.prototype._validateWebExResult=function(s,o){
var e=false;
if(!o){
o=""
}
if(!s){
e=true
}else{
if(!s.header||!s.header.response||!s.header.response.result||s.header.response.result!="SUCCESS"){
e=true
}}
if(e){
var n=[];
n.push(o);
if(s&&s.header&&s.header.response&&s.header.response.reason){
var t="";
if(s.header.response.exceptionID&&s.header.response.exceptionID.toString()=="040007"){
t=this.getMessage("WebExZimlet_invalidAlternateHost")
}
n.push("<br/><b>",this.getMessage("WebExZimlet_failureReason")," </b><label style='color:red;font:bold'>",s.header.response.reason,"<br/>",t,"</label>")
}
this._showErrorMessage(n.join(""));
return false
}
return true
};
WebExZimlet.prototype._showErrorMessage=function(o){
var t="";
if(o instanceof AjxException){
t=o.msg
}else{
t=o
}
var e=appCtxt.getMsgDialog();
e.reset();
e.setMessage(t,DwtMessageDialog.WARNING_STYLE);
e.popup()
};
WebExZimlet.prototype._getAccountsSelectListMenuHtml=function(s){
this._isAtLeastOneAccountConfigured();
var o=[];
o.push("<select id='",s,"'>");
for(var t=1;
t<6;
t++){
var n=this._webexZimletAccountPreferences["webexZimlet_username"+t];
if(n==""||n=="N/A"){
n=this.getMessage("WebExZimlet_notConfigured")
}
var e=AjxMessageFormat.format(this.getMessage("WebExZimlet_accntNumberAndName"),[t,n]);
o.push("<option value='",t,"'>",e,"</option>")
}
o.push("</select>");
return o.join("")
};
WebExZimlet.prototype.doDrop=function(e){
switch(e.TYPE){
case"ZmContact":this.contactDropped(e);
break;
case"ZmAppt":this.apptDropped(e);
break;
case"ZmConv":case"ZmMailMsg":this.mailDropped(e);
break
}};
WebExZimlet.prototype.apptDropped=function(o){
var t=o.srcObj.getAttendees(ZmCalBaseItem.PERSON);
var n=[];
for(var e=0;
e<t.length;
e++){
n.push(t[e].getEmail())
}
this._showOneClickDlg(n.join(";"))
};
WebExZimlet.prototype.mailDropped=function(e){
if(e instanceof Array){
e=e[0]
}
this.srcMsgObj=e.srcObj;
if(this.srcMsgObj.type=="CONV"){
this.srcMsgObj=this.srcMsgObj.getFirstHotMsg()
}
var t=this.srcMsgObj.getEmails().getArray().join(";");
this._showOneClickDlg(t)
};
WebExZimlet.prototype.contactDropped=function(e){
var t=this._getEmailsFromContacts(e);
this._showOneClickDlg(t.join(";"))
};
WebExZimlet.prototype._getEmailsFromContacts=function(t){
if(!(t instanceof Array)){
t=[t]
}
var r=[];
for(var o=0;
o<t.length;
o++){
var s=t[o];
s=s.attr||s._attr?(s.attr?s.attr:s._attr):s;
var n=s.email?s.email:(s.email2?s.email2:(s.email3?s.email3:""));
if(n!=""&&n!=undefined&&n!="undefined"){
r.push(n)
}}
return r
};
WebExZimlet.prototype._getValidEmailsAsString=function(t){
var o=document.getElementById(t);
if(o){
var r=o.value;
if(r!=""){
var e=AjxEmailAddress.parseEmailString(r);
var n=e.bad.getArray().toString();
if(n!=""){
this._showErrorMessage(this.getMessage("cannotContinueInvalidEmails")+"<br>"+n);
return""
}
var s=e.good.size()?e.good.getArray():e.all.getArray()
}}
return s.join(";")
};
function com_zimbra_srchhltr_HandlerObject(){}
com_zimbra_srchhltr_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_srchhltr_HandlerObject.prototype.constructor=com_zimbra_srchhltr_HandlerObject;
var SearchHighlighterZimlet=com_zimbra_srchhltr_HandlerObject;
SearchHighlighterZimlet.prototype.init=function(){
this._searchController=appCtxt.getSearchController();
this._skipKeys=["in:","attachment:","has:","is:","before:","after:","date:","larger:","smaller:","from:","to:","cc:","bcc:","and","or","not"];
this._skipKeysLen=this._skipKeys.length;
this._spanIds=[]
};
SearchHighlighterZimlet.prototype.match=function(o,h){
this._setRegExps();
if(this._regexps.length==0){
return
}
var t=this._regexps;
var n=null;
for(var s=0;
s<t.length;
++s){
var r=t[s];
r.lastIndex=h;
var e=r.exec(o);
if(e&&e[0]!=""){
if(!n||e.index<n.index){
n=e;
n.matchLength=e[0].length;
return n
}}}
return n
};
SearchHighlighterZimlet.prototype.generateSpan=function(o,e,s,n,t){
var r=Dwt.getNextId();
this._spanIds.push(r);
o[e++]=["<span id= '",r,"'class='ZmSearchResult'>",AjxStringUtil.htmlEncode(s),"</span>"].join("");
return e
};
SearchHighlighterZimlet.prototype._getSearchWords=function(t){
if(!t){
return[]
}
t=t.toLowerCase().replace(/in:\"(\w?[^a-zA-Z0-9_\"]?)+\"|in:(\w?[^a-zA-Z0-9_\"\s]?)+/g,"");
t=AjxStringUtil.trim(t);
if(t==""){
return[]
}
var o=t.split(" ");
var s=[];
for(var l=0;
l<o.length;
l++){
var m=AjxStringUtil.trim(o[l]);
if(m==""){
continue
}
var f=false;
for(var h=0;
h<this._skipKeysLen;
h++){
var r=this._skipKeys[h];
if(m.indexOf(r)==0||m.indexOf("("+r)==0||m.indexOf("(("+r)==0){
f=true;
break
}}
if(!f){
m=m.replace("subject:","").replace("content:","");
s.push(m)
}}
var n=[];
for(var r=0;
r<s.length;
r++){
var e=s[r];
e=e.replace(/\(/g,"").replace(/\)/g,"");
if(e==""){
continue
}
var u=e.length;
if((e.indexOf('"')==0)||(e.lastIndexOf('"')==u-1)){
e=e.replace(/\"/g,"")
}
if((e.indexOf("|")==0)||(e.lastIndexOf("|")==u-1)){
e=e.replace(/\|/g,"")
}
if(e!=""){
n.push(e)
}}
return searchWordHighlighter_unique(n)
};
function searchWordHighlighter_unique(e){
var o=[],n,t=e.length;
for(n=0;
n<t;
n++){
if(!searchWordHighlighter_arrayHasEl(o,e[n])){
o.push(e[n])
}}
return o
}
function searchWordHighlighter_arrayHasEl(o,t){
for(var e=0;
e<o.length;
e++){
if(o[e]==t){
return true
}}
return false
}
SearchHighlighterZimlet.prototype._setRegExps=function(){
this._currentSearchQuery=(this._searchController.currentSearch)?this._searchController.currentSearch.query:null;
if(!this._oldSearchQuery||this._currentSearchQuery!=this._oldSearchQuery){
var n=this._getSearchWords(this._currentSearchQuery);
this._regexps=[];
try{
for(var t=0;
t<n.length;
t++){
this._regexps.push(new RegExp(n[t],"ig"))
}}
catch(o){
appCtxt.getAppController().setStatusMsg([this.getMessage("SearchHighlighterZimlet_ZimletError")," ",o].join(""),ZmStatusView.LEVEL_WARNING);
this._regexps=[]
}
this._oldSearchQuery=this._currentSearchQuery
}};
SearchHighlighterZimlet.prototype.onParticipantActionMenuInitialized=function(e,t){
this.onActionMenuInitialized(e,t)
};
SearchHighlighterZimlet.prototype.onActionMenuInitialized=function(e,t){
this.addMenuButton(e,t)
};
SearchHighlighterZimlet.prototype.addMenuButton=function(t,s){
var e="COM_ZIMBRA_SEARCH_WORD_HIGHLIGHTER_ZIMLET";
var n=this.getMessage("SearchHighlighterZimlet_MenuLabel");
if(!s.getMenuItem(e)){
var r={
id:e,text:n,image:"search"};
var o=ZmOperation.defineOperation(null,r);
s.addOp(e,1000);
s.addSelectionListener(e,new AjxListener(this,this._clearSearchWordHighlights,t))
}};
SearchHighlighterZimlet.prototype._clearSearchWordHighlights=function(s){
var h=appCtxt.getAppViewMgr().getCurrentView();
var l;
if(h.getItemView){
l=h.getItemView()
}else{
if(h.getMsgView){
l=h.getMsgView()
}}
if(!l){
return
}
var e=l.getDocument();
if(!e){
var t=l.getHTMLElId();
if(t){
var d=document.getElementById(t+"_body__iframe");
if(!AjxEnv.isIE){
if(d){
e=d.contentDocument
}}else{
if(d){
e=d.contentWindow.document
}}}}
for(var n=0;
n<this._spanIds.length;
n++){
var o=document.getElementById(this._spanIds[n]);
var r;
if(e!=undefined||e!=null){
r=e.getElementById(this._spanIds[n])
}
if((o!=undefined)&&(o.className!=undefined)){
o.className=""
}
if((r!=undefined)&&(r.className!=undefined)){
r.className=""
}}
this._spanIds=[]
};
function com_zimbra_attachmail_HandlerObject(){}
com_zimbra_attachmail_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_attachmail_HandlerObject.prototype.constructor=com_zimbra_attachmail_HandlerObject;
var AttachMailZimlet=com_zimbra_attachmail_HandlerObject;
AttachMailZimlet.prototype.initializeAttachPopup=function(o,e){
var t=e._createAttachMenuItem(o,ZmMsg.mail,new AjxListener(this,this.showAttachmentDialog))
};
AttachMailZimlet.prototype.removePrevAttDialogContent=function(t){
var e=t&&t.firstChild;
if(e&&e.className=="DwtComposite"){
t.removeChild(e)
}};
AttachMailZimlet.prototype.showAttachmentDialog=function(){
var t=this._attachDialog=appCtxt.getAttachDialog();
t.setTitle(ZmMsg.attachMail);
this.removePrevAttDialogContent(t._getContentDiv().firstChild);
if(!this.AttachContactsView||!this.AttachContactsView.attachDialog){
this.AMV=new AttachMailTabView(this._attachDialog,this)
}
this.AMV.reparentHtmlElement(t._getContentDiv().childNodes[0],0);
this.AMV.attachDialog=t;
t.setOkListener(new AjxCallback(this.AMV,this.AMV.uploadFiles));
var e=appCtxt.getCurrentView();
var o=new AjxCallback(e,e._attsDoneCallback,[true]);
t.setUploadCallback(o);
this.AMV.attachDialog.popup();
this._addedToMainWindow=true
};
AttachMailZimlet.prototype.doubleClicked=function(){
this.singleClicked()
};
AttachMailZimlet.prototype.singleClicked=function(){};
AttachMailTabView=function(o,e,t){
this.zimlet=e;
DwtComposite.call(this,o,t,Dwt.STATIC_STYLE);
var n=appCtxt.multiAccounts?appCtxt.getAppViewMgr().getCurrentView().getFromAccount():appCtxt.getActiveAccount();
if(this.prevAccount&&(n.id==this.prevAccount.id)){
this.setSize(Dwt.DEFAULT,"275");
return
}
this.prevAccount=n;
this._createHtml1();
document.getElementById(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this)
};
AttachMailTabView.prototype=new DwtComposite;
AttachMailTabView.prototype.constructor=AttachMailTabView;
AttachMailTabView.ELEMENT_ID_SEARCH_FIELD="attDlg_attMsg_SearchField";
AttachMailTabView.ELEMENT_ID_SEARCH_BUTTON="attDlg_attMsg_SearchBtn";
AttachMailTabView.ELEMENT_ID_VIEW_MESSAGE_BUTTON="attDlg_attMsg_ViewMsgBtn";
AttachMailTabView.ELEMENT_ID_NAV_BUTTON_CELL="attDlg_attMsg_NavBtnCell";
AttachMailTabView.prototype.toString=function(){
return"AttachMailTabView"
};
AttachMailTabView.prototype.showMe=function(){
DwtTabViewPage.prototype.showMe.call(this);
var e=appCtxt.multiAccounts?appCtxt.getAppViewMgr().getCurrentView().getFromAccount():appCtxt.getActiveAccount();
if(this.prevAccount&&(e.id==this.prevAccount.id)){
this.setSize(Dwt.DEFAULT,"275");
return
}
this.prevAccount=e;
this._createHtml1();
document.getElementById(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this)
};
AttachMailTabView.prototype._resetQuery=function(e){
if(this._currentQuery==undefined){
this._currentQuery=e;
return e
}
if(this._currentQuery!=e){
this._offset=0;
this._currentQuery=e
}
return e
};
AttachMailTabView.prototype._getQueryFromFolder=function(e){
return this._resetQuery('inid:"'+e+'"')
};
AttachMailTabView.prototype.hideMe=function(){
DwtTabViewPage.prototype.hideMe.call(this)
};
AttachMailTabView.prototype._createHtml1=function(){
this._tableID=Dwt.getNextId();
this._folderTreeCellId=Dwt.getNextId();
this._folderListId=Dwt.getNextId();
var o=[];
var d=0;
o[d++]='<table width="100%" style="margin-bottom:5px">';
o[d++]='<TR><td width="20%"><INPUT type="text" id="';
o[d++]=AttachMailTabView.ELEMENT_ID_SEARCH_FIELD;
o[d++]='" style="padding:4px"></INPUT></td>';
o[d++]='<td width="10%"><div id="';
o[d++]=AttachMailTabView.ELEMENT_ID_SEARCH_BUTTON;
o[d++]='" style="margin: 0 2px" />';
o[d++]='<td width="10%"><div id="';
o[d++]=AttachMailTabView.ELEMENT_ID_VIEW_MESSAGE_BUTTON;
o[d++]='" style="margin: 0 2px" /></td>';
o[d++]='<td align="right" width="60%"><SPAN id="';
o[d++]=AttachMailTabView.ELEMENT_ID_NAV_BUTTON_CELL;
o[d++]='" /></td></TR></table>';
o[d++]='<table width="100%">';
o[d++]="<tr>";
o[d++]='<td valign="top" id="'+this._folderTreeCellId+'">';
o[d++]="</td>";
o[d++]='<td  valign="top"  id="'+this._folderListId+'">';
o[d++]="</td>";
o[d++]="</tr>";
o[d++]="</table>";
this.setContent(o.join(""));
var h=new DwtButton({
parent:this}
);
var e=this.zimlet.getMessage("AttachMailZimlet_tab_button_search");
h.setText(e);
h.addSelectionListener(new AjxListener(this,this._searchButtonListener));
document.getElementById(AttachMailTabView.ELEMENT_ID_SEARCH_BUTTON).appendChild(h.getHtmlElement());
var r=new DwtButton({
parent:this}
);
var l=this.zimlet.getMessage("AttachMailZimlet_tab_button_view");
r.setText(l);
r.addSelectionListener(new AjxListener(this,this._viewMsgButtonListener));
document.getElementById(AttachMailTabView.ELEMENT_ID_VIEW_MESSAGE_BUTTON).appendChild(r.getHtmlElement());
this._navigationContainer=new DwtComposite(appCtxt.getShell());
this._navTB=new AMZimletNavToolBar({
parent:this._navigationContainer}
);
var s=new AjxListener(this,this._navBarListener);
this._navTB.addSelectionListener(ZmOperation.PAGE_BACK,s);
this._navTB.addSelectionListener(ZmOperation.PAGE_FORWARD,s);
document.getElementById(AttachMailTabView.ELEMENT_ID_NAV_BUTTON_CELL).appendChild(this._navTB.getHtmlElement());
var t={
parent:appCtxt.getShell(),className:"AttachMailTabBox AttachMailList",posStyle:DwtControl.ABSOLUTE_STYLE,view:ZmId.VIEW_BRIEFCASE_ICON,type:ZmItem.ATT};
var n=this._tabAttachMailView=new ZmAttachMailListView(t);
this.showAttachMailTreeView();
n.reparentHtmlElement(this._folderListId);
n.addSelectionListener(new AjxListener(this,this._listSelectionListener));
Dwt.setPosition(n.getHtmlElement(),Dwt.RELATIVE_STYLE)
};
AttachMailTabView.prototype._searchButtonListener=function(e){
this.treeView.deselectAll();
var o=document.getElementById(AttachMailTabView.ELEMENT_ID_SEARCH_FIELD).value;
if(o==""){
return
}
var t=this._resetQuery(o);
this.executeQuery(t)
};
AttachMailTabView.prototype._viewMsgButtonListener=function(o){
var e=this.getSelectedMsgs();
for(var t=0;
t<e.length;
t++){
e[t].load({}
);
ZmMailMsgView.detachMsgInNewWindow(e[t])
}};
AttachMailTabView.prototype._navBarListener=function(e){
var t=e.item.getData(ZmOperation.KEY_ID);
this._paginate(t==ZmOperation.PAGE_FORWARD)
};
AttachMailTabView.prototype._paginate=function(e){
this.executeQuery(this._currentQuery,e)
};
AttachMailTabView.prototype.searchFolder=function(t){
var e=AjxSoapDoc.create("SearchRequest","urn:zimbraMail");
e.setMethodAttribute("types","message");
e.setMethodAttribute("limit",t.limit);
e.setMethodAttribute("offset",t.offset);
e.set("query",t.query);
t.response=appCtxt.getAppController().sendRequest({
soapDoc:e,noBusyOverlay:false}
);
this.handleSearchResponse(t)
};
AttachMailTabView.prototype.handleSearchResponse=function(t){
var e=t.response;
if(e&&(e.SearchResponse||e._data.SearchResponse)){
t.searchResponse=e.SearchResponse||e._data.SearchResponse;
t.items=this.processDocsResponse(t)
}
if(t.callback){
t.callback.run(t)
}};
AttachMailTabView.prototype.processDocsResponse=function(s){
var o=s.searchResponse.m;
var e=new ZmMailList(ZmItem.MSG,this._currentSearch);
e.setHasMore(s.searchResponse.more);
if(o==undefined){
return e
}
for(var t=0;
t<o.length;
t++){
var n=o[t];
e.addFromDom(n)
}
return e
};
AttachMailTabView.prototype.showResultContents=function(n){
var t=n.items;
this._navTB.enable(ZmOperation.PAGE_BACK,n.offset>0);
this._navTB.enable(ZmOperation.PAGE_FORWARD,t.hasMore());
var o=t.size();
if(o==0){
this._navTB.setText("")
}else{
this._navTB.setText((this._offset+1)+"-"+(this._offset+t.size()))
}
if(t){
this._list=t
}else{
this._list=new ZmList(ZmItem.BRIEFCASE_ITEM)
}
var e=this._tabAttachMailView;
e.set(this._list)
};
AttachMailTabView.prototype._handleKeys=function(t){
var e=DwtKeyEvent.getCharCode(t);
return(e!=DwtKeyEvent.KEY_ENTER&&e!=DwtKeyEvent.KEY_END_OF_TEXT)
};
AttachMailTabView.prototype.gotAttachments=function(){
return false
};
AttachMailTabView.prototype.getSelectedMsgs=function(){
var e=this._tabAttachMailView;
return e.getSelection()
};
AttachMailTabView.prototype.uploadFiles=function(o,e){
if(!e){
e=[];
var t=this.getSelectedMsgs();
if(!t||(t.length==0)){
return
}
for(var n in t){
e.push(t[n].id)
}}
if(o==undefined){
o=this.attachDialog
}
if(o._uploadCallback){
o._uploadCallback.run(AjxPost.SC_OK,null,null,e)
}
o.popdown()
};
AttachMailTabView.prototype.showAttachMailTreeView=function(){
var e=new AjxCallback(this,this._showTreeView);
AjxPackage.undefine("zimbraMail.mail.controller.ZmMailFolderTreeController");
AjxPackage.require({
name:"MailCore",forceReload:true,callback:e}
)
};
AttachMailTabView.prototype._showTreeView=function(){
if(appCtxt.isChildWindow){
ZmOverviewController.CONTROLLER.FOLDER="ZmMailFolderTreeController"
}
var o=appCtxt.getApp(ZmApp.MAIL);
o._createDeferredFolders();
var e=this.toString();
var t={
treeIds:["FOLDER"],fieldId:this._folderTreeCellId,overviewId:(appCtxt.multiAccounts)?([e,this.prevAccount.name].join(":")):e,account:this.prevAccount};
this._setOverview(t);
this.setSize(Dwt.DEFAULT,"275");
this._currentQuery=this._getQueryFromFolder("2");
setTimeout(AjxCallback.simpleClosure(this.treeView.setSelected,this.treeView,2),100)
};
AttachMailTabView.prototype._setOverview=function(n){
var o=n.overviewId;
var s=appCtxt.getOverviewController();
var t=s.getOverview(o);
if(!t){
var e={
overviewId:o,overviewClass:"AttachMailTabBox",headerClass:"DwtTreeItem",noTooltips:true,treeIds:n.treeIds};
t=s.createOverview(e);
t.account=this.prevAccount;
t.set(n.treeIds)
}else{
if(n.account){
t.account=n.account
}}
t.setSelected(this.prevAccount.id+":"+ZmFolder.ID_INBOX,"FOLDER");
this._overview=t;
document.getElementById(n.fieldId).appendChild(t.getHtmlElement());
this.treeView=t.getTreeView("FOLDER");
this.treeView.addSelectionListener(new AjxListener(this,this._treeListener));
this._hideRoot(this.treeView)
};
AttachMailTabView.prototype._treeListener=function(o,e){
o=o||window.event;
if(e||o.detail==DwtTree.ITEM_SELECTED){
var t=this.treeView.getSelected();
document.getElementById(AttachMailTabView.ELEMENT_ID_SEARCH_FIELD).value=['in:"',t.getSearchPath(),'"'].join("");
var n=this._getQueryFromFolder(t.id);
this.executeQuery(n);
this._tabAttachMailView.focus()
}};
AttachMailTabView.prototype._hideRoot=function(t){
var o=t.getTreeItemById(ZmOrganizer.ID_ROOT);
if(!o){
var e=ZmOrganizer.getSystemId(ZmOrganizer.ID_ROOT,this.prevAccount);
o=t.getTreeItemById(e)
}
o.showCheckBox(false);
o.setExpanded(true);
o.setVisible(false,true)
};
AttachMailTabView.prototype.setSize=function(n,e){
DwtTabViewPage.prototype.setSize.call(this,n,e);
var o=this.getSize();
var r=o.x*0.35;
var s=o.x-r;
var t=e-55;
this._overview.setSize(r,t);
this._tabAttachMailView.setSize(s-5,t);
return this
};
AttachMailTabView.prototype.executeQuery=function(t,e){
if(this._limit==undefined){
this._limit=50
}
if(this._offset==undefined){
this._offset=0
}
if(e!=undefined){
if(e){
this._offset=this._offset+50
}else{
this._offset=this._offset-50
}}
var o=new AjxCallback(this,this.showResultContents);
this.searchFolder({
query:t,offset:this._offset,limit:this._limit,callback:o}
)
};
ZmAttachMailController=function(e,t){
if(arguments.length==0){
return
}};
ZmAttachMailController.prototype=new ZmListController;
ZmAttachMailController.prototype.constructor=ZmAttachMailController;
ZmAttachMailController.prototype._resetToolbarOperations=function(){};
ZmAttachMailListView=function(e){
this._showCheckboxColSpan=appCtxt.get(ZmSetting.SHOW_SELECTION_CHECKBOX)?1:0;
ZmListView.call(this,e);
this._controller=new ZmAttachMailController()
};
ZmAttachMailListView.prototype=new ZmListView;
ZmAttachMailListView.prototype.constructor=ZmAttachMailListView;
ZmAttachMailListView.prototype._getDivClass=function(t,e,o){
return""
};
ZmAttachMailListView.prototype._getCellContents=function(u,d,m,h,t,e){
var n=m.fragment?AjxStringUtil.htmlEncode(m.fragment.slice(0,80)):"";
var l=m.getAddress("FROM");
if(l.name!=""){
l=l.name
}else{
l=l.address
}
var o="";
var r=2;
if(m.hasAttach){
o="<td width='16px'><div class='ImgAttachment'/></td>";
r=3
}
u[d++]="<div class='AttachMailRowDiv'>";
u[d++]="<table width='100%'>";
var s=m.subject?AjxStringUtil.htmlEncode(m.subject.slice(0,32)):ZmMsg.noSubject;
u[d++]="<tr>";
if(this._showCheckboxColSpan==1){
u[d++]="<td rowspan=3 style='vertical-align:middle;' width='20'><center>";
d=this._getImageHtml(u,d,"CheckboxUnchecked",this._getFieldId(m,ZmItem.F_SELECTION));
u[d++]="</center></td>"
}
u[d++]=o;
u[d++]="<td align='left' width='80%'><span class='AttachMailSubject'> "+s+"</span></td>";
u[d++]="<td width='20%' align='right'>";
u[d++]=AjxDateUtil.computeDateStr(e.now||new Date(),m.date);
u[d++]="</td></tr>";
u[d++]="<tr><td align='left' colspan='"+r+"'><span class='AttachMailFrom'> ";
u[d++]=l;
u[d++]="</span></td></tr>";
if(n!=""){
u[d++]="<tr><td align=left colspan="+r+"><span class='AttachMailFrag'>"+n+"</span></td></tr>"
}
u[d++]="</table></div>";
return d
};
AMZimletNavToolBar=function(t){
t.className=t.className||"AMZimletNavToolBar";
var e=(t.hasText!==false);
t.buttons=this._getButtons(e);
t.toolbarType=ZmId.TB_NAV;
t.posStyle=t.posStyle||DwtControl.STATIC_STYLE;
ZmButtonToolBar.call(this,t);
if(e){
this._textButton=this.getButton(ZmOperation.TEXT)
}};
AMZimletNavToolBar.prototype=new ZmButtonToolBar;
AMZimletNavToolBar.prototype.constructor=AMZimletNavToolBar;
AMZimletNavToolBar.prototype.toString=function(){
return"AMZimletNavToolBar"
};
AMZimletNavToolBar.prototype._getButtons=function(e){
var t=[];
t.push(ZmOperation.PAGE_BACK);
if(e){
t.push(ZmOperation.TEXT)
}
t.push(ZmOperation.PAGE_FORWARD);
return t
};
AMZimletNavToolBar.prototype.createOp=function(t,e){
e.textClassName="ZWidgetTitle AMZimletNavToolBarTitle";
return ZmButtonToolBar.prototype.createOp.apply(this,arguments)
};
AMZimletNavToolBar.prototype.setText=function(e){
if(!this._textButton){
return
}
this._textButton.setText(e)
};